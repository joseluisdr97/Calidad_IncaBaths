Ç
vC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\App_Start\BundleConfig.cs
	namespace 	
PROYECTO_INCABATHS
 
{ 
public 

class 
BundleConfig 
{ 
public		 
static		 
void		 
RegisterBundles		 *
(		* +
BundleCollection		+ ;
bundles		< C
)		C D
{

 	
bundles 
. 
Add 
( 
new 
ScriptBundle (
(( )
$str) ;
); <
.< =
Include= D
(D E
$str 7
)7 8
)8 9
;9 :
bundles 
. 
Add 
( 
new 
ScriptBundle (
(( )
$str) >
)> ?
.? @
Include@ G
(G H
$str 4
)4 5
)5 6
;6 7
bundles 
. 
Add 
( 
new 
ScriptBundle (
(( )
$str) >
)> ?
.? @
Include@ G
(G H
$str /
)/ 0
)0 1
;1 2
bundles 
. 
Add 
( 
new 
ScriptBundle (
(( )
$str) >
)> ?
.? @
Include@ G
(G H
$str .
,. /
$str ,
), -
)- .
;. /
bundles 
. 
Add 
( 
new 
StyleBundle '
(' (
$str( 7
)7 8
.8 9
Include9 @
(@ A
$str /
,/ 0
$str *
)* +
)+ ,
;, -
} 	
} 
} ´
vC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\App_Start\FilterConfig.cs
	namespace 	
PROYECTO_INCABATHS
 
{ 
public 

class 
FilterConfig 
{ 
public 
static 
void !
RegisterGlobalFilters 0
(0 1"
GlobalFilterCollection1 G
filtersH O
)O P
{		 	
filters

 
.

 
Add

 
(

 
new

  
HandleErrorAttribute

 0
(

0 1
)

1 2
)

2 3
;

3 4
} 	
} 
} â	
uC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\App_Start\RouteConfig.cs
	namespace 	
PROYECTO_INCABATHS
 
{		 
public

 

class

 
RouteConfig

 
{ 
public 
static 
void 
RegisterRoutes )
() *
RouteCollection* 9
routes: @
)@ A
{ 	
routes 
. 
IgnoreRoute 
( 
$str ;
); <
;< =
routes 
. 
MapRoute 
( 
name 
: 
$str 
,  
url 
: 
$str 1
,1 2
defaults 
: 
new 
{ 

controller  *
=+ ,
$str- 4
,4 5
action6 <
== >
$str? G
,G H
idI K
=L M
UrlParameterN Z
.Z [
Optional[ c
}d e
) 
; 
} 	
} 
} á
uC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\App_Start\UnityConfig.cs
	namespace 	
PROYECTO_INCABATHS
 
{ 
public 

static 
class 
UnityConfig #
{ 
private 
static 
Lazy 
< 
IUnityContainer +
>+ ,
	container- 6
=7 8
new
 
Lazy 
< 
IUnityContainer "
>" #
(# $
($ %
)% &
=>' )
{
 
var 
	container 
= 
new !
UnityContainer" 0
(0 1
)1 2
;2 3
RegisterTypes 
( 
	container %
)% &
;& '
return 
	container 
; 
}
 
) 
; 
public 
static 
IUnityContainer %
	Container& /
=>0 2
	container3 <
.< =
Value= B
;B C
public'' 
static'' 
void'' 
RegisterTypes'' (
(''( )
IUnityContainer'') 8
	container''9 B
)''B C
{(( 	
	container// 
.// 
RegisterType// "
<//" #
IServicioService//# 3
,//3 4
ServicioService//5 D
>//D E
(//E F
)//F G
;//G H
	container00 
.00 
RegisterType00 "
<00" #
ITurnoService00# 0
,000 1
TurnoService002 >
>00? @
(00A B
)00B C
;00C D
	container11 
.11 
RegisterType11 "
<11" #
IUsuarioService11# 2
,112 3
UsuarioService114 B
>11B C
(11C D
)11D E
;11E F
	container22 
.22 
RegisterType22 "
<22" #
IAdminService22# 0
,220 1
AdminService222 >
>22> ?
(22? @
)22@ A
;22A B
	container33 
.33 
RegisterType33 "
<33" #
IServiceSession33# 2
,332 3
ServiceSession334 B
>33B C
(33C D
)33D E
;33E F
	container44 
.44 
RegisterType44 "
<44" #
IAuthService44# /
,44/ 0
AuthService441 <
>44< =
(44= >
)44> ?
;44? @
	container55 
.55 
RegisterType55 "
<55" #
IReservaService55# 2
,552 3
ReservaService554 B
>55B C
(55C D
)55D E
;55E F
}66 	
}77 
}88 ú
{C:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\App_Start\UnityMvcActivator.cs
[ 
assembly 	
:	 

WebActivatorEx 
. %
PreApplicationStartMethod 3
(3 4
typeof4 :
(: ;
PROYECTO_INCABATHS; M
.M N
UnityMvcActivatorN _
)_ `
,` a
nameofb h
(h i
PROYECTO_INCABATHSi {
.{ |
UnityMvcActivator	| ç
.
ç é
Start
é ì
)
ì î
)
î ï
]
ï ñ
[ 
assembly 	
:	 

WebActivatorEx 
. %
ApplicationShutdownMethod 3
(3 4
typeof4 :
(: ;
PROYECTO_INCABATHS; M
.M N
UnityMvcActivatorN _
)_ `
,` a
nameofb h
(h i
PROYECTO_INCABATHSi {
.{ |
UnityMvcActivator	| ç
.
ç é
Shutdown
é ñ
)
ñ ó
)
ó ò
]
ò ô
	namespace		 	
PROYECTO_INCABATHS		
 
{

 
public 

static 
class 
UnityMvcActivator )
{ 
public 
static 
void 
Start  
(  !
)! "
{ 	
FilterProviders 
. 
	Providers %
.% &
Remove& ,
(, -
FilterProviders- <
.< =
	Providers= F
.F G
OfTypeG M
<M N)
FilterAttributeFilterProviderN k
>k l
(l m
)m n
.n o
Firsto t
(t u
)u v
)v w
;w x
FilterProviders 
. 
	Providers %
.% &
Add& )
() *
new* -.
"UnityFilterAttributeFilterProvider. P
(P Q
UnityConfigQ \
.\ ]
	Container] f
)f g
)g h
;h i
DependencyResolver 
. 
SetResolver *
(* +
new+ .#
UnityDependencyResolver/ F
(F G
UnityConfigG R
.R S
	ContainerS \
)\ ]
)] ^
;^ _
} 	
public!! 
static!! 
void!! 
Shutdown!! #
(!!# $
)!!$ %
{"" 	
UnityConfig## 
.## 
	Container## !
.##! "
Dispose##" )
(##) *
)##* +
;##+ ,
}$$ 	
}%% 
}&& ¸
uC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Clases\DetalleReserva.cs
	namespace 	
PROYECTO_INCABATHS
 
. 
Clases #
{ 
public 

class 
DetalleReserva 
{		 
public

 
int

 
IdDetalleReserva

 #
{

$ %
get

& )
;

) *
set

+ .
;

. /
}

0 1
public 
int 
	IdReserva 
{ 
get "
;" #
set$ '
;' (
}) *
public 
int 

IdServicio 
{ 
get  #
;# $
set% (
;( )
}* +
public 
int 
Cantidad 
{ 
get !
;! "
set# &
;& '
}( )
public 
decimal 
SubTotal 
{  !
get" %
;% &
set' *
;* +
}, -
public 
int 
IdTurno 
{ 
get  
;  !
set" %
;% &
}' (
public 
bool 
Activo_Inactivo #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
DateTime 
Fecha 
{ 
get  #
;# $
set% (
;( )
}* +
public 
Reserva 
Reserva 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
Servicio 
Servicio  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
Turno 
Turno 
{ 
get  
;  !
set" %
;% &
}' (
} 
} Û
oC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Clases\ModoPago.cs
	namespace 	
PROYECTO_INCABATHS
 
. 
Clases #
{ 
public 

class 
ModoPago 
{		 
public

 
int

 

IdModoPago

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
public 
string 
Nombre 
{ 
get "
;" #
set$ '
;' (
}) *
} 
} Û
nC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Clases\Reserva.cs
	namespace 	
PROYECTO_INCABATHS
 
. 
Clases #
{ 
public 

class 
Reserva 
{		 
public

 
Reserva

 
(

 
)

 
{ 	
DetalleReservas 
= 
new !
List" &
<& '
DetalleReserva' 5
>5 6
(6 7
)7 8
;8 9
} 	
public 
int 
	IdReserva 
{ 
get "
;" #
set$ '
;' (
}) *
public 
DateTime 
Fecha 
{ 
get  #
;# $
set% (
;( )
}* +
public 
int 
	IdUsuario 
{ 
get "
;" #
set$ '
;' (
}) *
public 
int 

IdModoPago 
{ 
get  #
;# $
set% (
;( )
}* +
public 
decimal 
Total 
{ 
get "
;" #
set$ '
;' (
}) *
public 
bool 
Activo_Inactivo #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
List 
< 
DetalleReserva "
>" #
DetalleReservas$ 3
{4 5
get6 9
;9 :
set; >
;> ?
}@ A
public 
Usuario 
Usuario 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} Í
oC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Clases\Servicio.cs
	namespace 	
PROYECTO_INCABATHS
 
. 
Clases #
{ 
public 

class 
Servicio 
{		 
public

 
int

 

IdServicio

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
public 
string 
Nombre 
{ 
get "
;" #
set$ '
;' (
}) *
public 
decimal 
Precio 
{ 
get  #
;# $
set% (
;( )
}* +
public 
int 
Aforo 
{ 
get 
; 
set  #
;# $
}% &
public 
bool 
Activo_Inactivo #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
List 
< 
Turno 
> 
Turnos !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
List 
< 
DetalleReserva "
>" #
DetallesReservas$ 4
{5 6
get7 :
;: ;
set< ?
;? @
}A B
} 
} …
rC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Clases\TipoUsuario.cs
	namespace 	
PROYECTO_INCABATHS
 
. 
Clases #
{ 
public 

class 
TipoUsuario 
{		 
public

 
int

 
IdTipoUsuario

  
{

! "
get

# &
;

& '
set

( +
;

+ ,
}

- .
public 
string 
Nombre 
{ 
get "
;" #
set$ '
;' (
}) *
public 
List 
< 
Usuario 
> 
Usuarios %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
} 
} ›
lC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Clases\Turno.cs
	namespace 	
PROYECTO_INCABATHS
 
. 
Clases #
{ 
public 

class 
Turno 
{		 
public

 
int

 
IdTurno

 
{

 
get

  
;

  !
set

" %
;

% &
}

' (
public 
int 

IdServicio 
{ 
get  #
;# $
set% (
;( )
}* +
public 
TimeSpan 

HoraInicio "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
TimeSpan 
HoraFin 
{  !
get" %
;% &
set' *
;* +
}, -
public 
DateTime 
Fecha 
{ 
get  #
;# $
set% (
;( )
}* +
public 
bool 
Activo_Inactivo #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
Servicio 
Servicio  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
List 
< 
DetalleReserva "
>" #
DetalleReservas$ 3
{4 5
get6 9
;9 :
set; >
;> ?
}@ A
} 
} €
nC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Clases\Usuario.cs
	namespace 	
PROYECTO_INCABATHS
 
. 
Clases #
{ 
public 

class 
Usuario 
{		 
public

 
int

 
	IdUsuario

 
{

 
get

 "
;

" #
set

$ '
;

' (
}

) *
public 
int 
IdTipoUsuario  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
string 
Nombre 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
Apellido 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
DNI 
{ 
get 
;  
set! $
;$ %
}& '
public 
string 
Celular 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
	Direccion 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
Correo 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Perfil 
{ 
get "
;" #
set$ '
;' (
}) *
public 
bool 
Activo_Inactivo #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
TipoUsuario 
TipoUsuario &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
List 
< 
Reserva 
> 
Reservas %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
} 
} €è
{C:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Controllers\AdminController.cs
	namespace 	
PROYECTO_INCABATHS
 
. 
Controllers (
{ 
public 

class 
AdminController  
:! "

Controller# -
{ 
private 
const 
string 

RutaImagen '
=( )
$str* 6
;6 7
private 
const 
string 
RutaI "
=# $
$str% 1
;1 2
private 
readonly 
IAdminService &
service' .
;. /
private 
readonly 
IServiceSession (
sessionService) 7
;7 8
public 
AdminController 
( 
IAdminService ,
service- 4
,4 5
IServiceSession6 E
sessionServiceF T
)T U
{ 	
this 
. 
service 
= 
service "
;" #
this 
. 
sessionService 
=  !
sessionService" 0
;0 1
} 	
[ 	
	Authorize	 
] 
public 
ActionResult 
Index !
(! "
)" #
{ 	
if 
( 
sessionService 
. &
BuscarNombreUsuarioSession 9
(9 :
): ;
==< >
null? C
||D F
sessionServiceG U
.U V&
BuscarNombreUsuarioSessionV p
(p q
)q r
==s u
$strv x
)x y
{z {
return	| Ç
RedirectToAction
É ì
(
ì î
$str
î õ
,
õ ú
$str
ù §
)
§ •
;
• ¶
}
ß ®
if 
( 
! 
sessionService 
.  )
EstaLogueadoComoAdministrador  =
(= >
)> ?
)? @
{A B
returnC I
RedirectToActionJ Z
(Z [
$str[ b
,b c
$strd k
)k l
;l m
}n o
int!! 
	idUsuario!! 
=!! 
sessionService!! *
.!!* +"
BuscarIdUsuarioSession!!+ A
(!!A B
)!!B C
;!!C D
var"" 
usuario"" 
="" 
service"" !
.""! " 
ObtenerListaUsuarios""" 6
(""6 7
)""7 8
.""8 9
First""9 >
(""> ?
u""? @
=>""A C
u""D E
.""E F
	IdUsuario""F O
==""P R
	idUsuario""S \
)""\ ]
;""] ^
sessionService## 
.## '
GuardarDatosUsuarioLogueado## 6
(##6 7
usuario##7 >
)##> ?
;##? @
var%% 
fecha%% 
=%% 
DateTime%%  
.%%  !
Now%%! $
.%%$ %
Date%%% )
;%%) *
var&& 
beginDateTime&& !
=&&" #
fecha&&$ )
.&&) *
Date&&* .
;&&. /
var'' 
endDateTime'' 
=''  !
fecha''" '
.''' (
Date''( ,
.'', -
AddDays''- 4
(''4 5
$num''5 6
)''6 7
;''7 8
decimal)) 
suma)) 
=)) 
$num))  
;))  !
var++ 
ContGanancias++ !
=++" #
service++$ +
.+++ ,
ObtenerListReservas++, ?
(++? @
)++@ A
.++A B
Count++B G
(++G H
a++H I
=>++J L
a++M N
.++N O
Fecha++O T
>=++U W
beginDateTime++X e
&&++f h
a++i j
.++j k
Fecha++k p
<++q r
endDateTime++s ~
&&	++ Å
a
++Ç É
.
++É Ñ
Activo_Inactivo
++Ñ ì
)
++ì î
;
++î ï
if,, 
(,, 
ContGanancias,, !
>,," #
$num,,$ %
),,% &
{-- 
var.. 
	Ganancias.. !
=.." #
service..$ +
...+ ,
ObtenerListReservas.., ?
(..? @
)..@ A
...A B
Where..B G
(..G H
a..H I
=>..J L
a..M N
...N O
Fecha..O T
>=..U W
beginDateTime..X e
&&..f h
a..i j
...j k
Fecha..k p
<..q r
endDateTime..s ~
&&	.. Å
a
..Ç É
.
..É Ñ
Activo_Inactivo
..Ñ ì
)
..ì î
.
..î ï
ToList
..ï õ
(
..õ ú
)
..ú ù
;
..ù û
for// 
(// 
int// 
i// 
=//  
$num//! "
;//" #
i//$ %
<//& '
ContGanancias//( 5
;//5 6
i//7 8
++//8 :
)//: ;
{00 
suma11 
=11 
suma11 #
+11$ %
	Ganancias11& /
[11/ 0
i110 1
]111 2
.112 3
Total113 8
;118 9
}22 
ViewBag33 
.33 
GanaciasDelDia33 *
=33+ ,
suma33- 1
;331 2
}44 
else55 
{66 
ViewBag77 
.77 
GanaciasDelDia77 *
=77+ ,
$num77- .
;77. /
}88 
return99 
View99 
(99 
)99 
;99 
};; 	
[<< 	
	Authorize<<	 
]<< 
public== 
decimal== 
CalcularGanancia== '
(==' (
DateTime==( 0
fecha1==1 7
,==7 8
DateTime==9 A
fecha2==B H
)==H I
{>> 	
var?? 
fechainicio?? 
=?? 
fecha1?? $
.??$ %
Date??% )
;??) *
var@@ 

fechafinal@@ 
=@@ 
fecha2@@ #
.@@# $
Date@@$ (
.@@( )
AddDays@@) 0
(@@0 1
$num@@1 2
)@@2 3
;@@3 4
decimalAA 
sumaAA 
=AA 
$numAA 
;AA 
varBB 
ContGananciasBB 
=BB 
serviceBB  '
.BB' (
ObtenerListReservasBB( ;
(BB; <
)BB< =
.BB= >
CountBB> C
(BBC D
aBBD E
=>BBF H
aBBI J
.BBJ K
FechaBBK P
>=BBQ S
fechainicioBBT _
&&BB` b
aBBc d
.BBd e
FechaBBe j
<BBk l

fechafinalBBm w
)BBw x
;BBx y
ifCC 
(CC 
ContGananciasCC 
>CC 
$numCC  !
)CC! "
{DD 
varEE 
	GananciasEE 
=EE 
serviceEE  '
.EE' (
ObtenerListReservasEE( ;
(EE; <
)EE< =
.EE= >
WhereEE> C
(EEC D
aEED E
=>EEF H
aEEI J
.EEJ K
FechaEEK P
>=EEQ S
fechainicioEET _
&&EE` b
aEEc d
.EEd e
FechaEEe j
<EEk l

fechafinalEEm w
)EEw x
.EEx y
ToListEEy 
(	EE Ä
)
EEÄ Å
;
EEÅ Ç
forFF 
(FF 
intFF 
iFF 
=FF 
$numFF 
;FF 
iFF  !
<FF" #
ContGananciasFF$ 1
;FF1 2
iFF3 4
++FF4 6
)FF6 7
{GG 
sumaHH 
=HH 
sumaHH 
+HH  !
	GananciasHH" +
[HH+ ,
iHH, -
]HH- .
.HH. /
TotalHH/ 4
;HH4 5
}II 
ViewBagJJ 
.JJ !
GanaciasDeFechaAfechaJJ -
=JJ. /
sumaJJ0 4
;JJ4 5
}KK 
returnLL 
sumaLL 
;LL 
}MM 	
publicNN 
ActionResultNN 
PruebaNN "
(NN" #
)NN# $
{OO 	
varPP 
nombrePP 
=PP 
sessionServicePP '
.PP' (&
BuscarNombreUsuarioSessionPP( B
(PPB C
)PPC D
;PPD E
ifQQ 
(QQ 
nombreQQ 
!=QQ 
nullQQ 
&&QQ !
nombreQQ" (
!=QQ( *
$strQQ* ,
)QQ- .
{RR 
intSS 
	idUsuarioSS 
=SS 
sessionServiceSS  .
.SS. /"
BuscarIdUsuarioSessionSS/ E
(SSE F
)SSF G
;SSG H
varTT 
usuarioTT 
=TT 
serviceTT %
.TT% & 
ObtenerListaUsuariosTT& :
(TT: ;
)TT; <
.TT< =
FirstTT= B
(TTB C
uTTC D
=>TTE G
uTTH I
.TTI J
	IdUsuarioTTJ S
==TTT V
	idUsuarioTTW `
)TT` a
;TTa b
sessionServiceUU 
.UU '
GuardarDatosUsuarioLogueadoUU :
(UU: ;
usuarioUU; B
)UUB C
;UUC D
returnVV 
ViewVV 
(VV 
trueVV  
)VV  !
;VV! "
}WW 
returnXX 
ViewXX 
(XX 
falseXX 
)XX 
;XX 
}YY 	
[[[ 	
HttpGet[[	 
][[ 
public\\ 
ActionResult\\ 
Crear\\ !
(\\! "
)\\" #
{]] 	
ViewBag^^ 
.^^ 
TipoUsuarios^^  
=^^! "
service^^# *
.^^* +$
ObtenerListaTipoUsuarios^^+ C
(^^C D
)^^D E
.^^E F
ToList^^F L
(^^L M
)^^M N
;^^N O
return__ 
View__ 
(__ 
new__ 
Usuario__ #
(__# $
)__$ %
)__% &
;__& '
}`` 	
[aa 	
HttpGetaa	 
]aa 
publiccc 
ActionResultcc 
Serviciocc $
(cc$ %
)cc% &
{dd 	
ViewBagee 
.ee 
	Serviciosee 
=ee 
serviceee  '
.ee' (!
ObtenerListaServiciosee( =
(ee= >
)ee> ?
.ee? @
Whereee@ E
(eeE F
aeeF G
=>eeG I
aeeI J
.eeJ K
Activo_InactivoeeK Z
)eeZ [
.ee[ \
ToListee\ b
(eeb c
)eec d
;eed e
returnff 
Viewff 
(ff 
)ff 
;ff 
}gg 	
[ii 	
HttpGetii	 
]ii 
publicjj 
ActionResultjj 
BuscarServiciojj *
(jj* +
intjj+ .
?jj. /
idjj0 2
,jj2 3
DateTimejj3 ;
fechajj< A
)jjA B
{kk 	
ifll 
(ll 
idll 
==ll 
nullll 
||ll 
idll  
==ll! #
$numll$ %
)ll% &
{ll' (
returnll) /
RedirectToActionll0 @
(ll@ A
$strllA H
,llH I
$strllJ Q
)llQ R
;llR S
}llT U
varmm 
datosmm 
=mm 
servicemm 
.mm  
ObtenerListaTurnosmm  2
(mm2 3
)mm3 4
.mm4 5
Wheremm5 :
(mm: ;
smm; <
=>mm= ?
smm@ A
.mmA B

IdServiciommB L
==mmM O
idmmP R
&&mmS U
smmV W
.mmW X
FechammX ]
==mm] _
fechamm_ d
&&mme g
smmh i
.mmi j
Activo_Inactivommj y
)mmy z
.mmz {
ToList	mm{ Å
(
mmÅ Ç
)
mmÇ É
;
mmÉ Ñ
returnoo 
Viewoo 
(oo 
datosoo 
)oo 
;oo 
}pp 	
publicrr 
decimalrr !
ObtenerPrecioServiciorr ,
(rr, -
intrr- 0
?rr0 1
idrr2 4
)rr4 5
{ss 	
iftt 
(tt 
idtt 
==tt 
nulltt 
||tt 
idtt  
==tt! #
$numtt$ %
)tt% &
returntt' -
$numtt. /
;tt/ 0
varuu 
Dbpreciouu 
=uu 
serviceuu "
.uu" #!
ObtenerListaServiciosuu# 8
(uu8 9
)uu9 :
.uu: ;
Firstuu; @
(uu@ A
puuA B
=>uuC E
puuF G
.uuG H

IdServiciouuH R
==uuS U
iduuV X
)uuX Y
;uuY Z
varvv 
preciovv 
=vv 
Dbpreciovv !
.vv! "
Preciovv" (
;vv( )
returnww 
precioww 
;ww 
}xx 	
publicyy 
stringyy !
ObtenerNombreServicioyy +
(yy+ ,
intyy, /
?yy/ 0
idyy1 3
)yy3 4
{zz 	
if{{ 
({{ 
id{{ 
=={{ 
null{{ 
||{{ 
id{{  
=={{! #
$num{{$ %
){{% &
return{{' -
$str{{. 0
;{{0 1
var|| 
Dbprecio|| 
=|| 
service|| "
.||" #!
ObtenerListaServicios||# 8
(||8 9
)||9 :
.||: ;
First||; @
(||@ A
p||A B
=>||C E
p||F G
.||G H

IdServicio||H R
==||S U
id||V X
)||X Y
;||Y Z
var}} 
nombre}} 
=}} 
Dbprecio}} !
.}}! "
Nombre}}" (
;}}( )
return~~ 
nombre~~ 
;~~ 
} 	
public
ÄÄ 
int
ÄÄ #
ConsultarAforoDeTurno
ÄÄ (
(
ÄÄ( )
DateTime
ÄÄ) 1
Fecha
ÄÄ2 7
,
ÄÄ7 8
int
ÄÄ8 ;
?
ÄÄ; <

idServicio
ÄÄ= G
,
ÄÄG H
TimeSpan
ÄÄH P

horaInicio
ÄÄQ [
,
ÄÄ[ \
TimeSpan
ÄÄ] e
horaFin
ÄÄf m
)
ÄÄm n
{
ÅÅ 	
if
ÇÇ 
(
ÇÇ 

idServicio
ÇÇ 
==
ÇÇ 
null
ÇÇ "
||
ÇÇ# %

idServicio
ÇÇ& 0
==
ÇÇ1 3
$num
ÇÇ4 5
)
ÇÇ5 6
return
ÇÇ7 =
$num
ÇÇ> ?
;
ÇÇ? @
var
ÉÉ 

DBServicio
ÉÉ 
=
ÉÉ 
service
ÉÉ $
.
ÉÉ$ %#
ObtenerListaServicios
ÉÉ% :
(
ÉÉ: ;
)
ÉÉ; <
.
ÉÉ< =
First
ÉÉ= B
(
ÉÉB C
a
ÉÉC D
=>
ÉÉE G
a
ÉÉH I
.
ÉÉI J

IdServicio
ÉÉJ T
==
ÉÉU W

idServicio
ÉÉX b
)
ÉÉb c
;
ÉÉc d
var
ÑÑ 
DbTurnosOcupados
ÑÑ  
=
ÑÑ! "
service
ÑÑ# *
.
ÑÑ* + 
ObtenerListaTurnos
ÑÑ+ =
(
ÑÑ= >
)
ÑÑ> ?
.
ÑÑ? @
Count
ÑÑ@ E
(
ÑÑE F
t
ÑÑF G
=>
ÑÑH J
t
ÑÑK L
.
ÑÑL M
Fecha
ÑÑM R
==
ÑÑS U
Fecha
ÑÑV [
&&
ÑÑ\ ^
t
ÑÑ_ `
.
ÑÑ` a

IdServicio
ÑÑa k
==
ÑÑl n

idServicio
ÑÑo y
&&
ÑÑz |
t
ÑÑ} ~
.
ÑÑ~ 

HoraInicioÑÑ â
==ÑÑâ ã

horaInicioÑÑã ï
&&ÑÑñ ò
tÑÑô ö
.ÑÑö õ
HoraFinÑÑõ ¢
==ÑÑ£ •
horaFinÑÑ¶ ≠
)ÑÑ≠ Æ
;ÑÑÆ Ø
var
ÖÖ 
calcular
ÖÖ 
=
ÖÖ 

DBServicio
ÖÖ %
.
ÖÖ% &
Aforo
ÖÖ& +
-
ÖÖ, -
DbTurnosOcupados
ÖÖ. >
;
ÖÖ> ?
return
ÜÜ 
calcular
ÜÜ 
;
ÜÜ 
}
áá 	
[
ââ 	
HttpPost
ââ	 
]
ââ 
public
ää 
ActionResult
ää 
Crear
ää !
(
ää! "
Usuario
ää" )
usuario
ää* 1
,
ää1 2
string
ää3 9
RepitaPassword
ää: H
,
ääH I 
HttpPostedFileBase
ääJ \
file
ää] a
)
ääa b
{
ãã 	
if
åå 
(
åå 
!
åå 
sessionService
åå 
.
åå  +
EstaLogueadoComoAdministrador
åå  =
(
åå= >
)
åå> ?
)
åå? @
{
ååA B
return
ååC I
RedirectToAction
ååJ Z
(
ååZ [
$str
åå[ b
,
ååb c
$str
ååd k
)
ååk l
;
åål m
}
åån o
if
çç 
(
çç 
file
çç 
!=
çç 
null
çç 
&&
çç 
file
çç  $
.
çç$ %
ContentLength
çç% 2
>
çç3 4
$num
çç5 6
)
çç6 7
{
éé 
string
èè 
ruta
èè 
=
èè 
Path
èè "
.
èè" #
Combine
èè# *
(
èè* +
Server
èè+ 1
.
èè1 2
MapPath
èè2 9
(
èè9 :

RutaImagen
èè: D
)
èèD E
,
èèE F
Path
èèG K
.
èèK L
GetFileName
èèL W
(
èèW X
file
èèX \
.
èè\ ]
FileName
èè] e
)
èèe f
)
èèf g
;
èèg h
file
êê 
.
êê 
SaveAs
êê 
(
êê 
ruta
êê  
)
êê  !
;
êê! "
usuario
ëë 
.
ëë 
Perfil
ëë 
=
ëë  
RutaI
ëë! &
+
ëë' (
Path
ëë) -
.
ëë- .
GetFileName
ëë. 9
(
ëë9 :
file
ëë: >
.
ëë> ?
FileName
ëë? G
)
ëëG H
;
ëëH I
}
íí 
usuario
ìì 
.
ìì 
IdTipoUsuario
ìì !
=
ìì" #
$num
ìì$ %
;
ìì% &
validar
îî 
(
îî 
usuario
îî 
,
îî 
RepitaPassword
îî +
)
îî+ ,
;
îî, -
validar1
ïï 
(
ïï 
usuario
ïï 
,
ïï 
RepitaPassword
ïï ,
)
ïï, -
;
ïï- .
validar2
ññ 
(
ññ 
usuario
ññ 
,
ññ 
RepitaPassword
ññ ,
)
ññ, -
;
ññ- .
validar3
óó 
(
óó 
usuario
óó 
,
óó 
RepitaPassword
óó ,
)
óó, -
;
óó- .
if
òò 
(
òò 

ModelState
òò 
.
òò 
IsValid
òò "
)
òò" #
{
ôô 
service
öö 
.
öö 
CrearUsuario
öö $
(
öö$ %
usuario
öö% ,
)
öö, -
;
öö- .
int
õõ 
valor
õõ 
=
õõ 
$num
õõ 
;
õõ 
return
úú 
RedirectToAction
úú '
(
úú' (
$str
úú( /
,
úú/ 0
$str
úú0 6
,
úú6 7
new
úú8 ;
{
úú< =
msg
úú> A
=
úúB C
valor
úúD I
}
úúJ K
)
úúK L
;
úúL M
}
ùù 
ViewBag
ûû 
.
ûû 
TipoUsuarios
ûû  
=
ûû! "
service
ûû# *
.
ûû* +&
ObtenerListaTipoUsuarios
ûû+ C
(
ûûC D
)
ûûD E
.
ûûE F
ToList
ûûF L
(
ûûL M
)
ûûM N
;
ûûN O
return
üü 
View
üü 
(
üü 
usuario
üü 
)
üü  
;
üü  !
}
†† 	
private
¢¢ 
readonly
¢¢ 
AppConexionDB
¢¢ &
conexion
¢¢' /
=
¢¢0 1
new
¢¢2 5
AppConexionDB
¢¢6 C
(
¢¢C D
)
¢¢D E
;
¢¢E F
public
££ 
void
££ 
validar
££ 
(
££ 
Usuario
££ #
usuario
££$ +
,
££+ ,
string
££- 3
RepitaPassword
££4 B
)
££B C
{
§§ 	
if
•• 
(
•• 
usuario
•• 
.
•• 
Nombre
•• 
==
•• !
null
••" &
||
••' )
usuario
••* 1
.
••1 2
Nombre
••2 8
==
••9 ;
$str
••< >
)
••> ?

ModelState
¶¶ 
.
¶¶ 
AddModelError
¶¶ (
(
¶¶( )
$str
¶¶) 1
,
¶¶1 2
$str
¶¶3 M
)
¶¶M N
;
¶¶N O
if
ßß 
(
ßß 
usuario
ßß 
.
ßß 
Nombre
ßß 
!=
ßß !
null
ßß" &
&&
ßß' )
Regex
ßß* /
.
ßß/ 0
IsMatch
ßß0 7
(
ßß7 8
usuario
ßß8 ?
.
ßß? @
Nombre
ßß@ F
,
ßßF G
$str
ßßH W
)
ßßW X
&&
ßßY [
usuario
ßß\ c
.
ßßc d
Nombre
ßßd j
.
ßßj k
Length
ßßk q
<=
ßßr t
$num
ßßu v
)
ßßv w
{
®® 

ModelState
©© 
.
©© 
AddModelError
©© (
(
©©( )
$str
©©) 1
,
©©1 2
$str
©©3 Q
)
©©Q R
;
©©R S
}
™™ 
if
¨¨ 
(
¨¨ 
usuario
¨¨ 
.
¨¨ 
Nombre
¨¨ 
!=
¨¨ !
null
¨¨" &
&&
¨¨' )
!
¨¨* +
Regex
¨¨+ 0
.
¨¨0 1
IsMatch
¨¨1 8
(
¨¨8 9
usuario
¨¨9 @
.
¨¨@ A
Nombre
¨¨A G
,
¨¨G H
$str
¨¨I X
)
¨¨X Y
)
¨¨Y Z
{
≠≠ 

ModelState
ÆÆ 
.
ÆÆ 
AddModelError
ÆÆ (
(
ÆÆ( )
$str
ÆÆ) 1
,
ÆÆ1 2
$str
ÆÆ3 Q
)
ÆÆQ R
;
ÆÆR S
}
ØØ 
if
≤≤ 
(
≤≤ 
usuario
≤≤ 
.
≤≤ 
Apellido
≤≤  
==
≤≤! #
null
≤≤$ (
||
≤≤) +
usuario
≤≤, 3
.
≤≤3 4
Apellido
≤≤4 <
==
≤≤= ?
$str
≤≤@ B
)
≤≤B C

ModelState
≥≥ 
.
≥≥ 
AddModelError
≥≥ (
(
≥≥( )
$str
≥≥) 3
,
≥≥3 4
$str
≥≥5 Q
)
≥≥Q R
;
≥≥R S
if
¥¥ 
(
¥¥ 
usuario
¥¥ 
.
¥¥ 
Apellido
¥¥  
!=
¥¥! #
null
¥¥$ (
&&
¥¥) +
!
¥¥, -
Regex
¥¥- 2
.
¥¥2 3
IsMatch
¥¥3 :
(
¥¥: ;
usuario
¥¥; B
.
¥¥B C
Apellido
¥¥C K
,
¥¥K L
$str
¥¥M \
)
¥¥\ ]
)
¥¥] ^
{
µµ 

ModelState
∂∂ 
.
∂∂ 
AddModelError
∂∂ (
(
∂∂( )
$str
∂∂) 3
,
∂∂3 4
$str
∂∂5 U
)
∂∂U V
;
∂∂V W
}
∑∑ 
if
∏∏ 
(
∏∏ 
usuario
∏∏ 
.
∏∏ 
Apellido
∏∏  
!=
∏∏! #
null
∏∏$ (
&&
∏∏) +
Regex
∏∏, 1
.
∏∏1 2
IsMatch
∏∏2 9
(
∏∏9 :
usuario
∏∏: A
.
∏∏A B
Apellido
∏∏B J
,
∏∏J K
$str
∏∏L [
)
∏∏[ \
&&
∏∏] _
usuario
∏∏` g
.
∏∏g h
Apellido
∏∏h p
.
∏∏p q
Length
∏∏q w
<=
∏∏x z
$num
∏∏{ |
)
∏∏| }
{
ππ 

ModelState
∫∫ 
.
∫∫ 
AddModelError
∫∫ (
(
∫∫( )
$str
∫∫) 3
,
∫∫3 4
$str
∫∫5 S
)
∫∫S T
;
∫∫T U
}
ªª 
}
ææ 	
public
øø 
void
øø 
validar1
øø 
(
øø 
Usuario
øø $
usuario
øø% ,
,
øø, -
string
øø. 4
RepitaPassword
øø5 C
)
øøC D
{
¿¿ 	
if
√√ 
(
√√ 
usuario
√√ 
.
√√ 
DNI
√√ 
==
√√ 
null
√√ #
||
√√$ &
usuario
√√' .
.
√√. /
DNI
√√/ 2
==
√√3 5
$str
√√6 8
)
√√8 9

ModelState
ƒƒ 
.
ƒƒ 
AddModelError
ƒƒ (
(
ƒƒ( )
$str
ƒƒ) .
,
ƒƒ. /
$str
ƒƒ0 G
)
ƒƒG H
;
ƒƒH I
if
∆∆ 
(
∆∆ 
usuario
∆∆ 
.
∆∆ 
DNI
∆∆ 
!=
∆∆ 
null
∆∆ #
&&
∆∆$ &
!
∆∆' (
Regex
∆∆( -
.
∆∆- .
IsMatch
∆∆. 5
(
∆∆5 6
usuario
∆∆6 =
.
∆∆= >
DNI
∆∆> A
,
∆∆A B
$str
∆∆C K
)
∆∆K L
)
∆∆L M
{
«« 

ModelState
»» 
.
»» 
AddModelError
»» (
(
»»( )
$str
»») .
,
»». /
$str
»»0 L
)
»»L M
;
»»M N
}
…… 
if
ÀÀ 
(
ÀÀ 
usuario
ÀÀ 
.
ÀÀ 
DNI
ÀÀ 
!=
ÀÀ 
null
ÀÀ #
&&
ÀÀ$ &
Regex
ÀÀ' ,
.
ÀÀ, -
IsMatch
ÀÀ- 4
(
ÀÀ4 5
usuario
ÀÀ5 <
.
ÀÀ< =
DNI
ÀÀ= @
,
ÀÀ@ A
$str
ÀÀB J
)
ÀÀJ K
&&
ÀÀL N
usuario
ÀÀO V
.
ÀÀV W
DNI
ÀÀW Z
.
ÀÀZ [
Length
ÀÀ[ a
!=
ÀÀb d
$num
ÀÀe f
)
ÀÀf g
{
ÃÃ 

ModelState
ÕÕ 
.
ÕÕ 
AddModelError
ÕÕ (
(
ÕÕ( )
$str
ÕÕ) .
,
ÕÕ. /
$str
ÕÕ0 P
)
ÕÕP Q
;
ÕÕQ R
}
ŒŒ 
if
œœ 
(
œœ 
usuario
œœ 
.
œœ 
DNI
œœ 
!=
œœ 
null
œœ #
&&
œœ$ &
Regex
œœ' ,
.
œœ, -
IsMatch
œœ- 4
(
œœ4 5
usuario
œœ5 <
.
œœ< =
DNI
œœ= @
,
œœ@ A
$str
œœB J
)
œœJ K
&&
œœL N
usuario
œœO V
.
œœV W
DNI
œœW Z
.
œœZ [
Length
œœ[ a
==
œœb d
$num
œœe f
)
œœf g
{
–– 
var
—— 
	usuarioDB
—— 
=
—— 
conexion
——  (
.
——( )
Usuarios
——) 1
.
——1 2
Any
——2 5
(
——5 6
t
——6 7
=>
——8 :
t
——; <
.
——< =
DNI
——= @
==
——A C
usuario
——D K
.
——K L
DNI
——L O
)
——O P
;
——P Q
if
““ 
(
““ 
	usuarioDB
““ 
)
““ 
{
”” 

ModelState
‘‘ 
.
‘‘ 
AddModelError
‘‘ ,
(
‘‘, -
$str
‘‘- 2
,
‘‘2 3
$str
‘‘4 H
)
‘‘H I
;
‘‘I J
}
’’ 
}
÷÷ 
if
ÿÿ 
(
ÿÿ 
usuario
ÿÿ 
.
ÿÿ 
Celular
ÿÿ 
==
ÿÿ  "
null
ÿÿ# '
||
ÿÿ( *
usuario
ÿÿ+ 2
.
ÿÿ2 3
Celular
ÿÿ3 :
==
ÿÿ; =
$str
ÿÿ> @
)
ÿÿ@ A

ModelState
ŸŸ 
.
ŸŸ 
AddModelError
ŸŸ (
(
ŸŸ( )
$str
ŸŸ) 2
,
ŸŸ2 3
$str
ŸŸ4 O
)
ŸŸO P
;
ŸŸP Q
}
›› 	
public
ﬁﬁ 
void
ﬁﬁ 
validar2
ﬁﬁ 
(
ﬁﬁ 
Usuario
ﬁﬁ $
usuario
ﬁﬁ% ,
,
ﬁﬁ, -
string
ﬁﬁ. 4
RepitaPassword
ﬁﬁ5 C
)
ﬁﬁC D
{
ﬂﬂ 	
if
·· 
(
·· 
usuario
·· 
.
·· 
Celular
·· 
!=
··  "
null
··# '
&&
··( *
!
··+ ,
Regex
··, 1
.
··1 2
IsMatch
··2 9
(
··9 :
usuario
··: A
.
··A B
Celular
··B I
,
··I J
$str
··K S
)
··S T
)
··T U
{
‚‚ 

ModelState
„„ 
.
„„ 
AddModelError
„„ (
(
„„( )
$str
„„) 2
,
„„2 3
$str
„„4 Z
)
„„Z [
;
„„[ \
}
‰‰ 
if
ÊÊ 
(
ÊÊ 
usuario
ÊÊ 
.
ÊÊ 
Celular
ÊÊ 
!=
ÊÊ  "
null
ÊÊ# '
&&
ÊÊ( *
Regex
ÊÊ+ 0
.
ÊÊ0 1
IsMatch
ÊÊ1 8
(
ÊÊ8 9
usuario
ÊÊ9 @
.
ÊÊ@ A
Celular
ÊÊA H
,
ÊÊH I
$str
ÊÊJ R
)
ÊÊR S
&&
ÊÊT V
usuario
ÊÊW ^
.
ÊÊ^ _
Celular
ÊÊ_ f
.
ÊÊf g
Length
ÊÊg m
!=
ÊÊn p
$num
ÊÊq r
)
ÊÊr s
{
ÁÁ 

ModelState
ËË 
.
ËË 
AddModelError
ËË (
(
ËË( )
$str
ËË) 2
,
ËË2 3
$str
ËË4 ^
)
ËË^ _
;
ËË_ `
}
ÈÈ 
if
ÍÍ 
(
ÍÍ 
usuario
ÍÍ 
.
ÍÍ 
Celular
ÍÍ 
!=
ÍÍ  "
null
ÍÍ# '
&&
ÍÍ( *
Regex
ÍÍ+ 0
.
ÍÍ0 1
IsMatch
ÍÍ1 8
(
ÍÍ8 9
usuario
ÍÍ9 @
.
ÍÍ@ A
Celular
ÍÍA H
,
ÍÍH I
$str
ÍÍJ R
)
ÍÍR S
&&
ÍÍT V
usuario
ÍÍW ^
.
ÍÍ^ _
Celular
ÍÍ_ f
.
ÍÍf g
Length
ÍÍg m
==
ÍÍn p
$num
ÍÍq r
&&
ÍÍs u
usuario
ÍÍv }
.
ÍÍ} ~
CelularÍÍ~ Ö
.ÍÍÖ Ü
	SubstringÍÍÜ è
(ÍÍè ê
$numÍÍê ë
,ÍÍë í
$numÍÍì î
)ÍÍî ï
!=ÍÍñ ò
$strÍÍô ú
)ÍÍú ù
{
ÎÎ 

ModelState
ÏÏ 
.
ÏÏ 
AddModelError
ÏÏ (
(
ÏÏ( )
$str
ÏÏ) 2
,
ÏÏ2 3
$str
ÏÏ4 \
)
ÏÏ\ ]
;
ÏÏ] ^
}
ÌÌ 
if
 
(
 
usuario
 
.
 
Correo
 
==
 !
null
" &
||
' )
usuario
* 1
.
1 2
Correo
2 8
==
9 ;
$str
< >
)
> ?

ModelState
ÒÒ 
.
ÒÒ 
AddModelError
ÒÒ (
(
ÒÒ( )
$str
ÒÒ) 1
,
ÒÒ1 2
$str
ÒÒ3 M
)
ÒÒM N
;
ÒÒN O
if
ÛÛ 
(
ÛÛ 
usuario
ÛÛ 
.
ÛÛ 
Correo
ÛÛ 
!=
ÛÛ !
null
ÛÛ" &
&&
ÛÛ' )
!
ÛÛ* +
Regex
ÛÛ+ 0
.
ÛÛ0 1
IsMatch
ÛÛ1 8
(
ÛÛ8 9
usuario
ÛÛ9 @
.
ÛÛ@ A
Correo
ÛÛA G
,
ÛÛG H
$strÛÛI Ÿ
)ÛÛŸ ⁄
)ÛÛ⁄ €
{
ÙÙ 

ModelState
ıı 
.
ıı 
AddModelError
ıı (
(
ıı( )
$str
ıı) 1
,
ıı1 2
$str
ıı3 R
)
ııR S
;
ııS T
}
ˆˆ 
if
¯¯ 
(
¯¯ 
usuario
¯¯ 
.
¯¯ 
Correo
¯¯ 
!=
¯¯ !
null
¯¯" &
&&
¯¯' )
Regex
¯¯* /
.
¯¯/ 0
IsMatch
¯¯0 7
(
¯¯7 8
usuario
¯¯8 ?
.
¯¯? @
Correo
¯¯@ F
,
¯¯F G
$str¯¯H ÿ
)¯¯ÿ Ÿ
)¯¯Ÿ ⁄
{
˘˘ 
var
˙˙ 
usuarioCorreoDB
˙˙ #
=
˙˙$ %
conexion
˙˙& .
.
˙˙. /
Usuarios
˙˙/ 7
.
˙˙7 8
Any
˙˙8 ;
(
˙˙; <
t
˙˙< =
=>
˙˙> @
t
˙˙A B
.
˙˙B C
Correo
˙˙C I
==
˙˙J L
usuario
˙˙M T
.
˙˙T U
Correo
˙˙U [
)
˙˙[ \
;
˙˙\ ]
if
˚˚ 
(
˚˚ 
usuarioCorreoDB
˚˚ #
)
˚˚# $
{
¸¸ 

ModelState
˝˝ 
.
˝˝ 
AddModelError
˝˝ ,
(
˝˝, -
$str
˝˝- 5
,
˝˝5 6
$str
˝˝7 N
)
˝˝N O
;
˝˝O P
}
˛˛ 
}
ˇˇ 
}
ÅÅ 	
public
ÇÇ 
void
ÇÇ 
validar3
ÇÇ 
(
ÇÇ 
Usuario
ÇÇ $
usuario
ÇÇ% ,
,
ÇÇ, -
string
ÇÇ. 4
RepitaPassword
ÇÇ5 C
)
ÇÇC D
{
ÉÉ 	
if
ÖÖ 
(
ÖÖ 
usuario
ÖÖ 
.
ÖÖ 
	Direccion
ÖÖ !
==
ÖÖ" $
null
ÖÖ% )
||
ÖÖ* ,
usuario
ÖÖ- 4
.
ÖÖ4 5
	Direccion
ÖÖ5 >
==
ÖÖ? A
$str
ÖÖB D
)
ÖÖD E

ModelState
ÜÜ 
.
ÜÜ 
AddModelError
ÜÜ (
(
ÜÜ( )
$str
ÜÜ) 4
,
ÜÜ4 5
$str
ÜÜ6 S
)
ÜÜS T
;
ÜÜT U
if
áá 
(
áá 
usuario
áá 
.
áá 
Password
áá  
==
áá! #
null
áá$ (
||
áá) +
usuario
áá, 3
.
áá3 4
Password
áá4 <
==
áá= ?
$str
áá@ B
)
ááB C

ModelState
àà 
.
àà 
AddModelError
àà (
(
àà( )
$str
àà) 3
,
àà3 4
$str
àà5 P
)
ààP Q
;
ààQ R
if
ää 
(
ää 
RepitaPassword
ää 
==
ää !
null
ää" &
||
ää' )
RepitaPassword
ää* 8
==
ää9 ;
$str
ää< >
)
ää> ?

ModelState
ãã 
.
ãã 
AddModelError
ãã (
(
ãã( )
$str
ãã) 9
,
ãã9 :
$str
ãã; V
)
ããV W
;
ããW X
if
çç 
(
çç 
usuario
çç 
.
çç 
Password
çç  
!=
çç! #
null
çç$ (
&&
çç) +
RepitaPassword
çç, :
!=
çç; =
null
çç> B
&&
ççC E
usuario
ççF M
.
ççM N
Password
ççN V
!=
ççW Y
RepitaPassword
ççZ h
)
ççh i
{
éé 

ModelState
èè 
.
èè 
AddModelError
èè (
(
èè( )
$str
èè) 9
,
èè9 :
$str
èè; W
)
èèW X
;
èèX Y
}
êê 
if
ëë 
(
ëë 
usuario
ëë 
.
ëë 
Perfil
ëë 
==
ëë !
null
ëë" &
)
ëë& '
{
íí 

ModelState
ìì 
.
ìì 
AddModelError
ìì (
(
ìì( )
$str
ìì) 1
,
ìì1 2
$str
ìì3 V
)
ììV W
;
ììW X
}
îî 
}
ññ 	
}
óó 
}òò Ã-
zC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Controllers\AuthController.cs
	namespace 	
PROYECTO_INCABATHS
 
. 
Controllers (
{ 
public 

class 
AuthController 
:  !

Controller" ,
{ 
private 
readonly 
IAuthService %
service& -
;- .
private 
readonly 
IServiceSession (
sessionService) 7
;7 8
public 
AuthController 
( 
IAuthService *
service+ 2
,2 3
IServiceSession4 C
sessionServiceD R
)R S
{ 	
this 
. 
service 
= 
service "
;" #
this 
. 
sessionService 
=  !
sessionService" 0
;0 1
} 	
[ 	
HttpGet	 
] 
public 
ActionResult 
Login !
(! "
)" #
{ 	
return 
View 
( 
) 
; 
} 	
[ 	
HttpPost	 
] 
public 
ActionResult 
Login !
(! "
Usuario" )
usuario* 1
,1 2
string3 9
RepitaPassword: H
)H I
{ 	
var   
UExiste   
=   
service   !
.  ! " 
ObtenerListaUsuarios  " 6
(  6 7
)  7 8
.  8 9
Count  9 >
(  > ?
u  ? @
=>  A C
u  D E
.  E F
Correo  F L
==  M O
usuario  P W
.  W X
Correo  X ^
&&  _ a
u  b c
.  c d
Password  d l
==  m o
usuario  p w
.  w x
Password	  x Ä
&&
  Å É
u
  Ñ Ö
.
  Ö Ü
Activo_Inactivo
  Ü ï
)
  ï ñ
;
  ñ ó
if"" 
("" 
UExiste"" 
!="" 
$num"" 
)"" 
{## 
var$$ 
	UsuarioDB$$ 
=$$ 
service$$ &
.$$& ' 
ObtenerListaUsuarios$$' ;
($$; <
)$$< =
.$$= >
First$$> C
($$C D
u$$D E
=>$$F H
u$$I J
.$$J K
Correo$$K Q
==$$R T
usuario$$U \
.$$\ ]
Correo$$] c
&&$$d f
u$$g h
.$$h i
Password$$i q
==$$r t
usuario$$u |
.$$| }
Password	$$} Ö
&&
$$Ü à
u
$$â ä
.
$$ä ã
Activo_Inactivo
$$ã ö
)
$$ö õ
;
$$õ ú
service%% 
.%% 
GuardarCookie%% %
(%%% &
	UsuarioDB%%& /
.%%/ 0
Correo%%0 6
)%%6 7
;%%7 8
if'' 
('' 
	UsuarioDB'' 
.'' 
IdTipoUsuario'' +
=='', .
$num''/ 0
)''0 1
{(( 
sessionService)) "
.))" #'
GuardarDatosUsuarioLogueado))# >
())> ?
	UsuarioDB))? H
)))H I
;))I J
return** 
RedirectToAction** +
(**+ ,
$str**, 3
,**3 4
$str**5 <
)**< =
;**= >
}++ 
else,, 
if,, 
(,, 
	UsuarioDB,, "
.,," #
IdTipoUsuario,,# 0
==,,1 3
$num,,4 5
),,5 6
{-- 
sessionService.. "
..." #'
GuardarDatosUsuarioLogueado..# >
(..> ?
	UsuarioDB..? H
)..H I
;..I J
return// 
RedirectToAction// +
(//+ ,
$str//, 6
,//6 7
$str//8 ?
)//? @
;//@ A
}00 
return11 
RedirectToAction11 '
(11' (
$str11( /
,11/ 0
$str111 7
)117 8
;118 9
}22 
ViewBag33 
.33 

Validation33 
=33  
$str33! D
;33D E
return44 
View44 
(44 
)44 
;44 
}55 	
public66 
ActionResult66 
Logout66 "
(66" #
)66# $
{77 	
service88 
.88 
CerrarSession88 !
(88! "
)88" #
;88# $
return99 
RedirectToAction99 #
(99# $
$str99$ +
)99+ ,
;99, -
}:: 	
public;; 
ActionResult;; 
Index;; !
(;;! "
);;" #
{<< 	
return== 
View== 
(== 
)== 
;== 
}>> 	
public?? 
string?? 
ObtenerUsuario?? $
(??$ %
)??% &
{@@ 	
varAA 
usuarioAA 
=AA 
sessionServiceAA (
.AA( )&
BuscarNombreUsuarioSessionAA) C
(AAC D
)AAD E
;AAE F
stringBB 
nombreBB 
;BB 
ifCC 
(CC 
usuarioCC 
==CC 
nullCC 
||CC  "
usuarioCC# *
==CC* ,
$strCC, .
)CC. /
{DD 
nombreEE 
=EE 
$strEE 
;EE  
returnFF 
nombreFF 
;FF 
}GG 
elseHH 
{II 
nombreJJ 
=JJ 
$strJJ 
;JJ 
returnKK 
nombreKK 
;KK 
}LL 
}MM 	
}OO 
}PP ´
{C:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Controllers\ErrorController.cs
	namespace 	
PROYECTO_INCABATHS
 
. 
Controllers (
{		 
public

 

class

 
ErrorController

  
:

! "

Controller

# -
{ 
private 
readonly 
AppConexionDB &
conexion' /
=0 1
new2 5
AppConexionDB6 C
(C D
)D E
;E F
public 
ActionResult 
Index !
(! "
)" #
{ 	
return 
View 
( 
) 
; 
} 	
[ 	
HttpPost	 
] 
public 
ActionResult 
VolerInicio '
(' (
)( )
{ 	
var 
EstaLogueado 
= 
Session &
[& '
$str' 6
]6 7
;7 8
if 
( 
EstaLogueado 
!= 
null !
&&" $
EstaLogueado% 1
.1 2
ToString2 :
(: ;
); <
!== ?
$str@ B
)B C
{ 
var 
	IdUsuario 
= 
Convert  '
.' (
ToInt32( /
(/ 0
Session0 7
[7 8
$str8 C
]C D
)D E
;E F
var 
usuario 
= 
conexion &
.& '
Usuarios' /
.; <
First< A
(A B
aB C
=>D F
aG H
.H I
	IdUsuarioI R
==S U
	IdUsuarioV _
)_ `
;` a
if 
( 
usuario 
. 
IdTipoUsuario )
==* ,
$num- .
). /
{ 
return 
RedirectToAction +
(+ ,
$str, 3
,3 4
$str5 <
)< =
;= >
} 
else 
if 
( 
usuario !
.! "
IdTipoUsuario" /
==0 2
$num3 4
)4 5
{ 
return 
RedirectToAction +
(+ ,
$str, 4
,4 5
$str6 =
)= >
;> ?
}   
}!! 
return"" 
RedirectToAction"" #
(""# $
$str""$ ,
,"", -
$str"". 5
)""5 6
;""6 7
}## 	
}$$ 
}%% ø	
zC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Controllers\HomeController.cs
	namespace 	
PROYECTO_INCABATHS
 
. 
Controllers (
{ 
public		 

class		 
HomeController		 
:		  !

Controller		" ,
{

 
public 
ActionResult 
Index !
(! "
)" #
{ 	
return 
View 
( 
) 
; 
} 	
public 
ActionResult 
About !
(! "
)" #
{ 	
ViewBag 
. 
Message 
= 
$str B
;B C
return 
View 
( 
) 
; 
} 	
public 
ActionResult 
Contact #
(# $
)$ %
{ 	
ViewBag 
. 
Message 
= 
$str 2
;2 3
return 
View 
( 
) 
; 
} 	
} 
} ≠6
~C:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Controllers\ModoPagoController.cs
	namespace

 	
PROYECTO_INCABATHS


 
.

 
Controllers

 (
{ 
[ 
	Authorize 
] 
public 

class 
ModoPagoController #
:$ %

Controller& 0
{ 
private 
readonly 
AppConexionDB &
conexion' /
=0 1
new2 5
AppConexionDB6 C
(C D
)D E
;E F
[ 	
HttpGet	 
] 
public 
ActionResult 
Index !
(! "
string" (
query) .
). /
{ 	
List 
< 
ModoPago 
> 
datos  
;  !
if 
( 
query 
== 
null 
||  
query! &
==' )
$str* ,
), -
{ 
datos 
= 
conexion  
.  !
	ModoPagos! *
.* +
ToList+ 1
(1 2
)2 3
;3 4
} 
else 
{ 
datos 
= 
conexion  
.  !
	ModoPagos! *
.* +
Where+ 0
(0 1
o1 2
=>3 5
o6 7
.7 8
Nombre8 >
.> ?
Contains? G
(G H
queryH M
)M N
)N O
.O P
ToListP V
(V W
)W X
;X Y
} 
ViewBag 
. 
datos 
= 
query !
;! "
return 
View 
( 
datos 
) 
; 
} 	
[ 	
HttpGet	 
] 
public   
ActionResult   
Crear   !
(  ! "
)  " #
{!! 	
return"" 
View"" 
("" 
new"" 
ModoPago"" $
(""$ %
)""% &
)""& '
;""' (
}## 	
[$$ 	
HttpPost$$	 
]$$ 
public%% 
ActionResult%% 
Crear%% !
(%%! "
ModoPago%%" *
modoPago%%+ 3
)%%3 4
{&& 	
validar'' 
('' 
modoPago'' 
)'' 
;'' 
if(( 
((( 

ModelState(( 
.(( 
IsValid(( "
)((" #
{)) 
conexion** 
.** 
	ModoPagos** "
.**" #
Add**# &
(**& '
modoPago**' /
)**/ 0
;**0 1
conexion++ 
.++ 
SaveChanges++ $
(++$ %
)++% &
;++& '
return,, 
RedirectToAction,, '
(,,' (
$str,,( /
),,/ 0
;,,0 1
}-- 
return// 
View// 
(// 
modoPago//  
)//  !
;//! "
}00 	
[11 	
HttpGet11	 
]11 
public22 
ActionResult22 
Editar22 "
(22" #
int22# &
id22' )
)22) *
{33 	
var44 

ModoPagoDb44 
=44 
conexion44 %
.44% &
	ModoPagos44& /
.44/ 0
Find440 4
(444 5
id445 7
)447 8
;448 9
return55 
View55 
(55 

ModoPagoDb55 "
)55" #
;55# $
}66 	
[77 	
HttpPost77	 
]77 
public88 
ActionResult88 
Editar88 "
(88" #
ModoPago88# +
modoPago88, 4
,884 5
int886 9
id88: <
)88< =
{99 	
var:: 

ModoPagoDb:: 
=:: 
conexion:: %
.::% &
	ModoPagos::& /
.::/ 0
Find::0 4
(::4 5
id::5 7
)::7 8
;::8 9
validar;; 
(;; 
modoPago;; 
);; 
;;; 
if<< 
(<< 

ModelState<< 
.<< 
IsValid<< "
)<<" #
{== 

ModoPagoDb>> 
.>> 
Nombre>> !
=>>" #
modoPago>>$ ,
.>>, -
Nombre>>- 3
;>>3 4
conexion?? 
.?? 
SaveChanges?? $
(??$ %
)??% &
;??& '
return@@ 
RedirectToAction@@ '
(@@' (
$str@@( /
)@@/ 0
;@@0 1
}AA 
returnBB 
ViewBB 
(BB 
modoPagoBB  
)BB  !
;BB! "
}CC 	
[DD 	
HttpGetDD	 
]DD 
publicEE 
ActionResultEE 
EliminarEE $
(EE$ %
intEE% (
idEE) +
)EE+ ,
{FF 	
varGG 

ModoPagoDbGG 
=GG 
conexionGG %
.GG% &
	ModoPagosGG& /
.GG/ 0
FirstGG0 5
(GG5 6
oGG6 7
=>GG8 :
oGG; <
.GG< =

IdModoPagoGG= G
==GGH J
idGGK M
)GGM N
;GGN O
conexionHH 
.HH 
	ModoPagosHH 
.HH 
RemoveHH %
(HH% &

ModoPagoDbHH& 0
)HH0 1
;HH1 2
conexionII 
.II 
SaveChangesII  
(II  !
)II! "
;II" #
returnJJ 
RedirectToActionJJ #
(JJ# $
$strJJ$ +
)JJ+ ,
;JJ, -
}LL 	
publicMM 
voidMM 
validarMM 
(MM 
ModoPagoMM $
modoPagoMM% -
)MM- .
{NN 	
ifQQ 
(QQ 
modoPagoQQ 
.QQ 
NombreQQ 
==QQ  "
nullQQ# '
||QQ( *
modoPagoQQ+ 3
.QQ3 4
NombreQQ4 :
==QQ; =
$strQQ> @
)QQ@ A

ModelStateRR 
.RR 
AddModelErrorRR (
(RR( )
$strRR) 1
,RR1 2
$strRR3 S
)RRS T
;RRT U
ifTT 
(TT 
modoPagoTT 
.TT 
NombreTT 
!=TT  "
nullTT# '
&&TT( *
!TT+ ,
RegexTT, 1
.TT1 2
IsMatchTT2 9
(TT9 :
modoPagoTT: B
.TTB C
NombreTTC I
,TTI J
$strTTK Z
)TTZ [
)TT[ \
{UU 

ModelStateVV 
.VV 
AddModelErrorVV ,
(VV, -
$strVV- 5
,VV5 6
$strVV7 [
)VV[ \
;VV\ ]
}WW 
}YY 	
}ZZ 
}[[ “§
}C:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Controllers\ReservaController.cs
	namespace 	
PROYECTO_INCABATHS
 
. 
Controllers (
{ 
public 

class 
ReservaController "
:# $

Controller% /
{ 
private 
readonly 
IReservaService (
service) 0
;0 1
private 
readonly 
IServiceSession (
sessionService) 7
;7 8
public 
ReservaController  
(  !
IReservaService! 0
service1 8
,8 9
IServiceSession: I
sessionServiceJ X
)X Y
{ 	
this 
. 
service 
= 
service "
;" #
this 
. 
sessionService 
=  !
sessionService" 0
;0 1
} 	
public 
ActionResult 
Index !
(! "
)" #
{ 	
if 
( 
! 
sessionService 
.  )
EstaLogueadoComoAdministrador  =
(= >
)> ?
)? @
{A B
returnC I
RedirectToActionJ Z
(Z [
$str[ b
,b c
$strd k
)k l
;l m
}n o
var 
datos 
= 
service 
.   
ObtenerListaReservas  4
(4 5
)5 6
.6 7
Where7 <
(< =
a= >
=>> @
a@ A
.A B
Activo_InactivoB Q
)Q R
.R S
ToListS Y
(Y Z
)Z [
;[ \
return 
View 
( 
datos 
) 
; 
} 	
[ 	
	Authorize	 
] 
[ 	
HttpGet	 
] 
public 
ActionResult 
Crear !
(! "
)" #
{   	
ViewBag!! 
.!! 
	Servicios!! 
=!! 
service!!  '
.!!' (!
ObtenerListaServicios!!( =
(!!= >
)!!> ?
.!!? @
ToList!!@ F
(!!F G
)!!G H
;!!H I
return"" 
View"" 
("" 
)"" 
;"" 
}## 	
[$$ 	
	Authorize$$	 
]$$ 
[%% 	
HttpPost%%	 
]%% 
public&& 
ActionResult&& 
Crear&& !
(&&! "
Reserva&&" )
reserva&&* 1
)&&1 2
{'' 	
if(( 
((( 
!(( 
sessionService(( 
.((  #
EstaLogueadoComoCliente((  7
(((7 8
)((8 9
)((9 :
{((; <
return((= C
RedirectToAction((D T
(((T U
$str((U \
,((\ ]
$str((^ e
)((e f
;((f g
}((h i
int)) 
valor)) 
=)) 
$num)) 
;)) 
if** 
(** 
reserva** 
!=** 
null** 
&&**  "
reserva**# *
.*** +
DetalleReservas**+ :
!=**; =
null**> B
&&**C E
reserva**F M
.**M N
DetalleReservas**N ]
.**] ^
Count**^ c
>**d e
$num**f g
)**g h
{++ 
int,, 
	idUsuario,, 
=,, 
sessionService,,  .
.,,. /"
BuscarIdUsuarioSession,,/ E
(,,E F
),,F G
;,,G H
reserva-- 
.-- 
Activo_Inactivo-- '
=--( )
true--* .
;--. /
service.. 
... 
CrearReserva.. $
(..$ %
	idUsuario..% .
,... /
reserva..0 7
)..7 8
;..8 9
valor// 
=// 
$num// 
;// 
return00 
RedirectToAction00 '
(00' (
$str00( 5
,005 6
$str007 @
,00@ A
new00B E
{00F G
msg00H K
=00L M
valor00N S
}00T U
)00U V
;00V W
}11 
return22 
View22 
(22 
)22 
;22 
}33 	
[44 	
	Authorize44	 
]44 
public55 
ActionResult55 
MisReservas55 '
(55' (
)55( )
{66 	
if77 
(77 
!77 
sessionService77 
.77  #
EstaLogueadoComoCliente77  7
(777 8
)778 9
)779 :
{77; <
return77= C
RedirectToAction77D T
(77T U
$str77U \
,77\ ]
$str77^ e
)77e f
;77f g
}77h i
if88 
(88 
sessionService88 
.88 &
BuscarNombreUsuarioSession88 9
(889 :
)88: ;
==88< >
null88? C
||88D F
sessionService88G U
.88U V&
BuscarNombreUsuarioSession88V p
(88p q
)88q r
==88s u
$str88v x
)88x y
{88z {
return	88| Ç
RedirectToAction
88É ì
(
88ì î
$str
88î õ
,
88õ ú
$str
88ù §
)
88§ •
;
88• ¶
}
88ß ®
var99 
usuarioIdDB99 
=99 
sessionService99 ,
.99, -"
BuscarIdUsuarioSession99- C
(99C D
)99D E
;99E F
var:: 
misReservas:: 
=:: 
service:: %
.::% & 
ObtenerListaReservas::& :
(::: ;
)::; <
.::< =
Where::= B
(::B C
a::C D
=>::E G
a::H I
.::I J
	IdUsuario::J S
==::T V
usuarioIdDB::W b
&&::c e
a::f g
.::g h
Activo_Inactivo::h w
)::w x
.::x y
ToList::y 
(	:: Ä
)
::Ä Å
;
::Å Ç
return<< 
View<< 
(<< 
misReservas<< #
)<<# $
;<<$ %
}== 	
[>> 	
	Authorize>>	 
]>> 
public?? 
ActionResult?? 
BuscarMisReservas?? -
(??- .
DateTime??. 6
fecha??7 <
)??< =
{@@ 	
ifAA 
(AA 
sessionServiceAA 
.AA &
BuscarNombreUsuarioSessionAA 9
(AA9 :
)AA: ;
==AA< >
nullAA? C
||AAD F
sessionServiceAAG U
.AAU V&
BuscarNombreUsuarioSessionAAV p
(AAp q
)AAq r
==AAs u
$strAAv x
)AAx y
{AAz {
return	AA| Ç
RedirectToAction
AAÉ ì
(
AAì î
$str
AAî õ
,
AAõ ú
$str
AAù §
)
AA§ •
;
AA• ¶
}
AAß ®
varBB 
usuarioIdDBBB 
=BB 
sessionServiceBB ,
.BB, -"
BuscarIdUsuarioSessionBB- C
(BBC D
)BBD E
;BBE F
varCC 
fechasCC 
=CC 
fechaCC 
.CC 
DateCC #
;CC# $
varDD 
endDateTimeDD 
=DD 
fechasDD $
.DD$ %
DateDD% )
.DD) *
AddDaysDD* 1
(DD1 2
$numDD2 3
)DD3 4
;DD4 5
ListEE 
<EE 
ReservaEE 
>EE 
misReservasEE %
;EE% &
ifGG 
(GG 
fechaGG 
.GG 
ToStringGG 
(GG 
)GG  
==GG! #
$strGG$ >
)GG> ?
{HH 
misReservasII 
=II 
serviceII %
.II% & 
ObtenerListaReservasII& :
(II: ;
)II; <
.II< =
WhereII= B
(IIB C
aIIC D
=>IIE G
aIIH I
.III J
	IdUsuarioIIJ S
==IIT V
usuarioIdDBIIW b
)IIb c
.IIc d
ToListIId j
(IIj k
)IIk l
;IIl m
}JJ 
elseKK 
{LL 
misReservasMM 
=MM 
serviceMM %
.MM% & 
ObtenerListaReservasMM& :
(MM: ;
)MM; <
.MM< =
WhereMM= B
(MMB C
aMMC D
=>MME G
aMMH I
.MMI J
	IdUsuarioMMJ S
==MMT V
usuarioIdDBMMW b
&&MMc e
aMMf g
.MMg h
FechaMMh m
>=MMn p
fechasMMq w
&&MMx z
aMM{ |
.MM| }
Fecha	MM} Ç
<
MMÉ Ñ
endDateTime
MMÖ ê
)
MMê ë
.
MMë í
ToList
MMí ò
(
MMò ô
)
MMô ö
;
MMö õ
}NN 
returnPP 
ViewPP 
(PP 
misReservasPP #
)PP# $
;PP$ %
}QQ 	
[RR 	
	AuthorizeRR	 
]RR 
publicSS 
ActionResultSS "
BuscarMisReservasAdminSS 2
(SS2 3
stringSS3 9
dniSS: =
)SS= >
{TT 	
ifUU 
(UU 
sessionServiceUU 
.UU &
BuscarNombreUsuarioSessionUU 9
(UU9 :
)UU: ;
==UU< >
nullUU? C
||UUD F
sessionServiceUUG U
.UUU V&
BuscarNombreUsuarioSessionUUV p
(UUp q
)UUq r
==UUs u
$strUUv x
)UUx y
return	UUz Ä
RedirectToAction
UUÅ ë
(
UUë í
$str
UUí ô
,
UUô ö
$str
UUõ ¢
)
UU¢ £
;
UU£ §
ifVV 
(VV 
dniVV 
!=VV 
$strVV 
&&VV 
dniVV !
!=VV" $
nullVV% )
)VV) *
{WW 
varXX 
contUDBXX 
=XX 
serviceXX %
.XX% & 
ObtenerListaUsuariosXX& :
(XX: ;
)XX; <
.XX< =
CountXX= B
(XXB C
uXXC D
=>XXE G
uXXH I
.XXI J
DNIXXJ M
==XXN P
dniXXQ T
&&XXU W
uXXX Y
.XXY Z
Activo_InactivoXXZ i
)XXi j
;XXj k
ifYY 
(YY 
contUDBYY 
>YY 
$numYY 
)YY  
{ZZ 
var[[ 
UsuDB[[ 
=[[ 
service[[  '
.[[' ( 
ObtenerListaUsuarios[[( <
([[< =
)[[= >
.[[> ?
First[[? D
([[D E
u[[E F
=>[[G I
u[[J K
.[[K L
DNI[[L O
==[[P R
dni[[S V
)[[V W
;[[W X
var\\ 
reservas\\  
=\\! "
service\\# *
.\\* + 
ObtenerListaReservas\\+ ?
(\\? @
)\\@ A
.\\A B
Where\\B G
(\\G H
r\\H I
=>\\J L
r\\M N
.\\N O
	IdUsuario\\O X
==\\Y [
UsuDB\\\ a
.\\a b
	IdUsuario\\b k
&&\\l n
r\\o p
.\\p q
Activo_Inactivo	\\q Ä
)
\\Ä Å
.
\\Å Ç
ToList
\\Ç à
(
\\à â
)
\\â ä
;
\\ä ã
return]] 
View]] 
(]]  
reservas]]  (
)]]( )
;]]) *
}__ 
else`` 
{aa 
varbb 
resebb 
=bb 
servicebb &
.bb& ' 
ObtenerListaReservasbb' ;
(bb; <
)bb< =
.bb= >
Wherebb> C
(bbC D
rbbD E
=>bbF H
rbbI J
.bbJ K
	IdUsuariobbK T
==bbU W
-bbX Y
$numbbY Z
&&bb[ ]
rbb^ _
.bb_ `
Activo_Inactivobb` o
)bbo p
.bbp q
ToListbbq w
(bbw x
)bbx y
;bby z
returncc 
Viewcc 
(cc  
resecc  $
)cc$ %
;cc% &
}dd 
}ee 
elseee 
{ff 
returngg 
Viewgg 
(gg 
servicegg #
.gg# $ 
ObtenerListaReservasgg$ 8
(gg8 9
)gg9 :
.gg: ;
ToListgg; A
(ggA B
)ggB C
)ggC D
;ggD E
}hh 
}ii 	
[jj 	
	Authorizejj	 
]jj 
publickk 
ActionResultkk 
MiDetalleReservakk ,
(kk, -
intkk- 0
idkk1 3
)kk3 4
{ll 	
varmm 
misReservasmm 
=mm 
servicemm %
.mm% &!
ObtenerDetalleReservamm& ;
(mm; <
)mm< =
.mm= >
Wheremm> C
(mmC D
ammD E
=>mmF H
ammI J
.mmJ K
	IdReservammK T
==mmU W
idmmX Z
&&mm[ ]
amm^ _
.mm_ `
Activo_Inactivomm` o
)mmo p
.mmp q
ToListmmq w
(mmw x
)mmx y
;mmy z
returnnn 
Viewnn 
(nn 
misReservasnn #
)nn# $
;nn$ %
}oo 	
[pp 	
	Authorizepp	 
]pp 
publicqq 
ActionResultqq 
Eliminarqq $
(qq$ %
intqq% (
?qq( )
idqq* ,
)qq, -
{rr 	
ifss 
(ss 
idss 
==ss 
nullss 
||ss 
idss  
==ss! #
$numss$ %
)ss% &
{ss' (
returnss) /
RedirectToActionss0 @
(ss@ A
$strssA H
,ssH I
$strssJ Q
)ssQ R
;ssR S
}ssT U
vartt 
	DbReservatt 
=tt 
servicett #
.tt# $ 
ObtenerListaReservastt$ 8
(tt8 9
)tt9 :
.tt: ;
Firsttt; @
(tt@ A
ottA B
=>ttC E
ottF G
.ttG H
	IdReservattH Q
==ttR T
idttU W
&&ttX Z
ott[ \
.tt\ ]
Activo_Inactivott] l
)ttl m
;ttm n
serviceuu 
.uu 
EliminarReservauu #
(uu# $
	DbReservauu$ -
)uu- .
;uu. /
varww 
CountReservaDbww 
=ww  
serviceww! (
.ww( )!
ObtenerDetalleReservaww) >
(ww> ?
)ww? @
.ww@ A
CountwwA F
(wwF G
owwG H
=>wwI K
owwL M
.wwM N
	IdReservawwN W
==wwX Z
idww[ ]
)ww] ^
;ww^ _
ifxx 
(xx 
CountReservaDbxx 
!=xx !
$numxx" #
)xx# $
{yy 
varzz 
CountReservaDbListazz '
=zz( )
servicezz* 1
.zz1 2!
ObtenerDetalleReservazz2 G
(zzG H
)zzH I
.zzI J
WherezzJ O
(zzO P
ozzP Q
=>zzR T
ozzU V
.zzV W
	IdReservazzW `
==zza c
idzzd f
&&zzg i
ozzj k
.zzk l
Activo_Inactivozzl {
)zz{ |
.zz| }
ToList	zz} É
(
zzÉ Ñ
)
zzÑ Ö
;
zzÖ Ü
for{{ 
({{ 
int{{ 
i{{ 
={{ 
$num{{ 
;{{ 
i{{  !
<{{" #
CountReservaDb{{$ 2
;{{2 3
i{{4 5
++{{5 7
){{7 8
{|| 
var}} 
idDetalleReserva}} (
=}}) *
CountReservaDbLista}}+ >
[}}> ?
i}}? @
]}}@ A
.}}A B
IdDetalleReserva}}B R
;}}R S
var~~ 
	ReservaDb~~ !
=~~" #
service~~$ +
.~~+ ,!
ObtenerDetalleReserva~~, A
(~~A B
)~~B C
.~~C D
First~~D I
(~~I J
o~~J K
=>~~L N
o~~O P
.~~P Q
IdDetalleReserva~~Q a
==~~b d
idDetalleReserva~~e u
)~~u v
;~~v w
service 
. "
EliminarDetalleReserva 2
(2 3
	ReservaDb3 <
)< =
;= >
}
ÄÄ 
}
ÅÅ 
return
ÇÇ 
RedirectToAction
ÇÇ #
(
ÇÇ# $
$str
ÇÇ$ +
)
ÇÇ+ ,
;
ÇÇ, -
}
ÉÉ 	
public
ÖÖ 
ActionResult
ÖÖ 
ObtenerTurnos
ÖÖ )
(
ÖÖ) *
int
ÖÖ* -
id
ÖÖ. 0
)
ÖÖ0 1
{
ÜÜ 	
var
áá 
fecha
áá 
=
áá 
DateTime
áá  
.
áá  !
Now
áá! $
.
áá$ %
Date
áá% )
;
áá) *
var
àà 

fechafinal
àà 
=
àà 
DateTime
àà %
.
àà% &
Now
àà& )
.
àà) *
Date
àà* .
.
àà. /
AddDays
àà/ 6
(
àà6 7
$num
àà7 8
)
àà8 9
;
àà9 :
var
ââ 
turnos
ââ 
=
ââ 
service
ââ  
.
ââ  ! 
ObtenerListaTurnos
ââ! 3
(
ââ3 4
)
ââ4 5
.
ââ5 6
Where
ââ6 ;
(
ââ; <
a
ââ< =
=>
ââ> @
a
ââA B
.
ââB C

IdServicio
ââC M
==
ââN P
id
ââQ S
&&
ââT V
a
ââW X
.
ââX Y
Fecha
ââY ^
>=
ââ^ `
fecha
ââ` e
&&
ââf h
a
ââi j
.
ââj k
Fecha
ââk p
<
ââp q

fechafinal
ââq {
)
ââ{ |
.
ââ| }
ToListââ} É
(ââÉ Ñ
)ââÑ Ö
;ââÖ Ü
return
ää 
View
ää 
(
ää 
turnos
ää 
)
ää 
;
ää  
}
ãã 	
public
åå 
string
åå $
ObtenerHoraInicioTurno
åå ,
(
åå, -
int
åå- 0
id
åå1 3
)
åå3 4
{
çç 	
var
éé 
TurnoDb
éé 
=
éé 
service
éé !
.
éé! " 
ObtenerListaTurnos
éé" 4
(
éé4 5
)
éé5 6
.
éé6 7
First
éé7 <
(
éé< =
a
éé= >
=>
éé? A
a
ééB C
.
ééC D
IdTurno
ééD K
==
ééL N
id
ééO Q
)
ééQ R
;
ééR S
return
èè 
TurnoDb
èè 
.
èè 

HoraInicio
èè %
.
èè% &
ToString
èè& .
(
èè. /
)
èè/ 0
;
èè0 1
}
êê 	
public
ëë 
string
ëë !
ObtenerHoraFinTurno
ëë )
(
ëë) *
int
ëë* -
id
ëë. 0
)
ëë0 1
{
íí 	
var
ìì 
TurnoDb
ìì 
=
ìì 
service
ìì !
.
ìì! " 
ObtenerListaTurnos
ìì" 4
(
ìì4 5
)
ìì5 6
.
ìì6 7
First
ìì7 <
(
ìì< =
a
ìì= >
=>
ìì? A
a
ììB C
.
ììC D
IdTurno
ììD K
==
ììL N
id
ììO Q
)
ììQ R
;
ììR S
return
îî 
TurnoDb
îî 
.
îî 
HoraFin
îî "
.
îî" #
ToString
îî# +
(
îî+ ,
)
îî, -
;
îî- .
}
ïï 	
public
ññ 
string
ññ 
BuscarUsuario
ññ #
(
ññ# $
string
ññ$ *
dni
ññ+ .
)
ññ. /
{
óó 	
var
òò 
ExisteU
òò 
=
òò 
service
òò !
.
òò! ""
ObtenerListaUsuarios
òò" 6
(
òò6 7
)
òò7 8
.
òò8 9
Count
òò9 >
(
òò> ?
a
òò? @
=>
òòA C
a
òòD E
.
òòE F
DNI
òòF I
==
òòJ L
dni
òòM P
)
òòP Q
;
òòQ R
if
öö 
(
öö 
ExisteU
öö 
>
öö 
$num
öö 
)
öö 
{
õõ 
var
úú 
	usuarioDB
úú 
=
úú 
service
úú  '
.
úú' ("
ObtenerListaUsuarios
úú( <
(
úú< =
)
úú= >
.
úú> ?
First
úú? D
(
úúD E
u
úúE F
=>
úúG I
u
úúJ K
.
úúK L
DNI
úúL O
==
úúP R
dni
úúS V
)
úúV W
;
úúW X
return
ûû 
	usuarioDB
ûû  
.
ûû  !
Nombre
ûû! '
+
ûû( )
$str
ûû) ,
+
ûû, -
	usuarioDB
ûû. 7
.
ûû7 8
Apellido
ûû8 @
;
ûû@ A
}
üü 
else
†† 
{
°° 
return
¢¢ 
$str
¢¢ !
;
¢¢! "
}
££ 
}
§§ 	
}
•• 
}¶¶ ˝r
~C:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Controllers\ServicioController.cs
	namespace 	
PROYECTO_INCABATHS
 
. 
Controllers (
{ 
public 

class 
ServicioController #
:$ %

Controller& 0
{ 
private 
readonly 
IServiceSession (
sessionService) 7
;7 8
private 
readonly 
IServicioService )
service* 1
;1 2
public 
ServicioController !
(! "
IServicioService" 2
service3 :
,: ;
IServiceSession< K
sessionServiceL Z
)Z [
{ 	
this 
. 
sessionService 
=  !
sessionService" 0
;0 1
this 
. 
service 
= 
service "
;" #
} 	
[ 	
	Authorize	 
] 
[ 	
HttpGet	 
] 
public 
ActionResult 
Index !
(! "
)" #
{ 	
if 
( 
! 
sessionService 
.  )
EstaLogueadoComoAdministrador  =
(= >
)> ?
)? @
{A B
returnC I
RedirectToActionJ Z
(Z [
$str[ b
,b c
$strd k
)k l
;l m
}n o
var 
model 
= 
service 
.  !
ObtenerListaServicios  5
(5 6
)6 7
.7 8
Where8 =
(= >
a> ?
=>@ B
aC D
.D E
Activo_InactivoE T
)T U
.U V
ToListV \
(\ ]
)] ^
;^ _
return 
View 
( 
model 
) 
; 
} 	
[   	
	Authorize  	 
]   
public!! 
ActionResult!! 
BuscarServicio!! *
(!!* +
string!!+ 1
query!!2 7
)!!7 8
{"" 	
List## 
<## 
Servicio## 
>## 
model##  
;##  !
if$$ 
($$ 
query$$ 
==$$ 
null$$ 
||$$  
query$$! &
==$$' )
$str$$* ,
)$$, -
{%% 
model&& 
=&& 
service&& 
.&&  !
ObtenerListaServicios&&  5
(&&5 6
)&&6 7
.&&7 8
Where&&8 =
(&&= >
a&&> ?
=>&&@ B
a&&C D
.&&D E
Activo_Inactivo&&E T
)&&T U
.&&U V
ToList&&V \
(&&\ ]
)&&] ^
;&&^ _
}'' 
else(( 
{)) 
model** 
=** 
service** 
.**  !
ObtenerListaServicios**  5
(**5 6
)**6 7
.**7 8
Where**8 =
(**= >
o**> ?
=>**@ B
o**C D
.**D E
Nombre**E K
.**K L
Contains**L T
(**T U
query**U Z
)**Z [
&&**\ ^
o**_ `
.**` a
Activo_Inactivo**a p
)**p q
.**q r
ToList**r x
(**x y
)**y z
;**z {
}++ 
ViewBag,, 
.,, 
datos,, 
=,, 
query,, !
;,,! "
return-- 
View-- 
(-- 
model-- 
)-- 
;-- 
}.. 	
[// 	
	Authorize//	 
]// 
[00 	
HttpGet00	 
]00 
public11 
ActionResult11 
Crear11 !
(11! "
)11" #
{22 	
if33 
(33 
!33 
sessionService33 
.33  )
EstaLogueadoComoAdministrador33  =
(33= >
)33> ?
)33? @
{33A B
return33C I
RedirectToAction33J Z
(33Z [
$str33[ b
,33b c
$str33d k
)33k l
;33l m
}33n o
return44 
View44 
(44 
new44 
Servicio44 $
(44$ %
)44% &
)44& '
;44' (
}55 	
[66 	
	Authorize66	 
]66 
[77 	
HttpPost77	 
]77 
public88 
ActionResult88 
Crear88 !
(88! "
Servicio88" *
servicio88+ 3
)883 4
{99 	
if:: 
(:: 
!:: 
sessionService:: 
.::  )
EstaLogueadoComoAdministrador::  =
(::= >
)::> ?
)::? @
{::A B
return::C I
RedirectToAction::J Z
(::Z [
$str::[ b
,::b c
$str::d k
)::k l
;::l m
}::n o
int;; 
id;; 
=;; 
$num;; 
;;; 
validar<< 
(<< 
servicio<< 
,<< 
id<<  
)<<  !
;<<! "
if== 
(== 

ModelState== 
.== 
IsValid== "
)==" #
{>> 
service?? 
.?? 
GuardarServicio?? '
(??' (
servicio??( 0
)??0 1
;??1 2
return@@ 
RedirectToAction@@ '
(@@' (
$str@@( /
)@@/ 0
;@@0 1
}AA 
returnBB 
ViewBB 
(BB 
servicioBB  
)BB  !
;BB! "
}CC 	
[DD 	
	AuthorizeDD	 
]DD 
[EE 	
HttpGetEE	 
]EE 
publicFF 
ActionResultFF 
EditarFF "
(FF" #
intFF# &
?FF& '
idFF( *
)FF* +
{GG 	
ifHH 
(HH 
!HH 
sessionServiceHH 
.HH  )
EstaLogueadoComoAdministradorHH  =
(HH= >
)HH> ?
)HH? @
{HHA B
returnHHC I
RedirectToActionHHJ Z
(HHZ [
$strHH[ b
,HHb c
$strHHd k
)HHk l
;HHl m
}HHn o
ifII 
(II 
idII 
==II 
nullII 
||II 
idII  
==II! #
$numII$ %
)II% &
{II' (
returnII) /
RedirectToActionII0 @
(II@ A
$strIIA H
,IIH I
$strIIJ Q
)IIQ R
;IIR S
}IIT U
varJJ 
modelJJ 
=JJ 
serviceJJ 
.JJ   
ObtenerServicioPorIdJJ  4
(JJ4 5
idJJ5 7
)JJ7 8
;JJ8 9
ViewBagKK 
.KK 

IdServicioKK 
=KK  
idKK! #
;KK# $
returnLL 
ViewLL 
(LL 
modelLL 
)LL 
;LL 
}MM 	
[NN 	
	AuthorizeNN	 
]NN 
[OO 	
HttpPostOO	 
]OO 
publicPP 
ActionResultPP 
EditarPP "
(PP" #
ServicioPP# +
servicioPP, 4
,PP4 5
intPP6 9
idPP: <
)PP< =
{QQ 	
ifRR 
(RR 
!RR 
sessionServiceRR 
.RR  )
EstaLogueadoComoAdministradorRR  =
(RR= >
)RR> ?
)RR? @
{RRA B
returnRRC I
RedirectToActionRRJ Z
(RRZ [
$strRR[ b
,RRb c
$strRRd k
)RRk l
;RRl m
}RRn o
validarSS 
(SS 
servicioSS 
,SS 
idSS  
)SS  !
;SS! "
ifTT 
(TT 

ModelStateTT 
.TT 
IsValidTT "
)TT" #
{UU 
serviceVV 
.VV 
EditarServicioVV &
(VV& '
idVV' )
,VV) *
servicioVV* 2
)VV2 3
;VV3 4
returnWW 
RedirectToActionWW '
(WW' (
$strWW( /
)WW/ 0
;WW0 1
}XX 
ViewBagYY 
.YY 

IdServicioYY 
=YY  
idYY! #
;YY# $
returnZZ 
ViewZZ 
(ZZ 
servicioZZ  
)ZZ  !
;ZZ! "
}[[ 	
[\\ 	
	Authorize\\	 
]\\ 
[]] 	
HttpGet]]	 
]]] 
public^^ 
ActionResult^^ 
Eliminar^^ $
(^^$ %
int^^% (
?^^( )
id^^* ,
)^^, -
{__ 	
if`` 
(`` 
id`` 
==`` 
null`` 
||`` 
id``  
==``! #
$num``$ %
)``% &
{``' (
return``) /
RedirectToAction``0 @
(``@ A
$str``A H
,``H I
$str``J Q
)``Q R
;``R S
}``T U
varaa 
CountTurnoDbaa 
=aa 
serviceaa &
.aa& '
ListaDeTurnosaa' 4
(aa4 5
)aa5 6
.aa6 7
Whereaa7 <
(aa< =
oaa= >
=>aa? A
oaaB C
.aaC D

IdServicioaaD N
==aaO Q
idaaR T
&&aaU W
oaaX Y
.aaY Z
Activo_InactivoaaZ i
)aai j
.aaj k
ToListaak q
(aaq r
)aar s
;aas t
ViewBagbb 
.bb 
	MisTurnosbb 
=bb 
CountTurnoDbbb  ,
;bb, -
ifcc 
(cc 
CountTurnoDbcc 
.cc 
Countcc "
!=cc# %
$numcc& '
)cc' (
{dd 
serviceee 
.ee %
EliminarTurnosDelServicioee 1
(ee1 2
idee2 4
)ee4 5
;ee5 6
}ff 
servicegg 
.gg 
EliminarServiciogg $
(gg$ %
idgg% '
)gg' (
;gg( )
returnhh 
RedirectToActionhh #
(hh# $
$strhh$ +
)hh+ ,
;hh, -
}ii 	
publicjj 
voidjj 
validarjj 
(jj 
Serviciojj $
serviciojj% -
,jj- .
intjj/ 2
idjj3 5
)jj5 6
{kk 	
ifll 
(ll 
servicioll 
.ll 
Nombrell 
==ll  "
nullll# '
||ll( *
servicioll+ 3
.ll3 4
Nombrell4 :
==ll; =
$strll> @
)ll@ A

ModelStatemm 
.mm 
AddModelErrormm (
(mm( )
$strmm) 1
,mm1 2
$strmm3 S
)mmS T
;mmT U
ifoo 
(oo 
serviciooo 
.oo 
Nombreoo 
!=oo  "
nulloo# '
&&oo( *
!oo+ ,
Regexoo, 1
.oo1 2
IsMatchoo2 9
(oo9 :
serviciooo: B
.ooB C
NombreooC I
,ooI J
$strooK Z
)ooZ [
)oo[ \
{pp 

ModelStateqq 
.qq 
AddModelErrorqq ,
(qq, -
$strqq- 5
,qq5 6
$strqq7 [
)qq[ \
;qq\ ]
}rr 
iftt 
(tt 
serviciott 
.tt 
Preciott 
==tt  "
$numtt# $
||tt% '
Converttt( /
.tt/ 0
ToStringtt0 8
(tt8 9
serviciott9 A
.ttA B
PreciottB H
)ttH I
==ttJ L
$strttM O
)ttO P

ModelStateuu 
.uu 
AddModelErroruu (
(uu( )
$struu) 1
,uu1 2
$struu3 S
)uuS T
;uuT U
ifww 
(ww 
servicioww 
.ww 
Precioww 
!=ww  "
$numww# $
&&ww% '
Convertww( /
.ww/ 0
ToStringww0 8
(ww8 9
servicioww9 A
.wwA B
PreciowwB H
)wwH I
==wwJ L
nullwwM Q
&&wwR T
!wwU V
RegexwwV [
.ww[ \
IsMatchww\ c
(wwc d
Convertwwd k
.wwk l
ToStringwwl t
(wwt u
serviciowwu }
.ww} ~
Precio	ww~ Ñ
)
wwÑ Ö
,
wwÖ Ü
$str
wwá £
)
ww£ §
)
ww§ •
{xx 

ModelStateyy 
.yy 
AddModelErroryy ,
(yy, -
$stryy- 5
,yy5 6
$stryy7 b
)yyb c
;yyc d
}zz 
if{{ 
({{ 
Regex{{ 
.{{ 
IsMatch{{ 
({{ 
Convert{{ %
.{{% &
ToString{{& .
({{. /
servicio{{/ 7
.{{7 8
Precio{{8 >
){{> ?
,{{? @
$str{{A P
){{P Q
){{Q R

ModelState|| 
.|| 
AddModelError|| (
(||( )
$str||) 1
,||1 2
$str||3 U
)||U V
;||V W
if 
( 
servicio 
. 
Aforo 
== !
$num" #
||$ &
Convert' .
.. /
ToString/ 7
(7 8
servicio8 @
.@ A
AforoA F
)F G
==H J
$strK M
)M N

ModelState
ÄÄ 
.
ÄÄ 
AddModelError
ÄÄ (
(
ÄÄ( )
$str
ÄÄ) 0
,
ÄÄ0 1
$str
ÄÄ2 Q
)
ÄÄQ R
;
ÄÄR S
}
ÇÇ 	
public
ÉÉ 

ViewResult
ÉÉ  
EliminarServcicioP
ÉÉ ,
(
ÉÉ, -
int
ÉÉ- 0
?
ÉÉ0 1
id
ÉÉ2 4
)
ÉÉ4 5
{
ÑÑ 	
var
ÖÖ 
model
ÖÖ 
=
ÖÖ 
service
ÖÖ 
.
ÖÖ  
ListaDeTurnos
ÖÖ  -
(
ÖÖ- .
)
ÖÖ. /
.
ÖÖ/ 0
Where
ÖÖ0 5
(
ÖÖ5 6
o
ÖÖ6 7
=>
ÖÖ8 :
o
ÖÖ; <
.
ÖÖ< =

IdServicio
ÖÖ= G
==
ÖÖH J
id
ÖÖK M
&&
ÖÖN P
o
ÖÖQ R
.
ÖÖR S
Activo_Inactivo
ÖÖS b
)
ÖÖb c
.
ÖÖc d
ToList
ÖÖd j
(
ÖÖj k
)
ÖÖk l
;
ÖÖl m
return
ÜÜ 
View
ÜÜ 
(
ÜÜ 
model
ÜÜ 
)
ÜÜ 
;
ÜÜ 
}
áá 	
}
àà 
}ââ ¶›
{C:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Controllers\TurnoController.cs
	namespace 	
PROYECTO_INCABATHS
 
. 
Controllers (
{ 
public 

class 
TurnoController  
:! "

Controller# -
{ 
private 
readonly 
IServiceSession (
sessionService) 7
;7 8
private 
readonly 
ITurnoService &
service' .
;. /
public 
TurnoController 
( 
ITurnoService ,
service- 4
,4 5
IServiceSession6 E
sessionServiceF T
)T U
{ 	
this 
. 
sessionService 
=  !
sessionService" 0
;0 1
this 
. 
service 
= 
service "
;" #
} 	
[ 	
	Authorize	 
] 
[ 	
HttpGet	 
] 
public 
ActionResult 
Index !
(! "
int" %
?% &
id' )
)) *
{ 	
if 
( 
! 
sessionService 
.  )
EstaLogueadoComoAdministrador  =
(= >
)> ?
)? @
{A B
returnC I
RedirectToActionJ Z
(Z [
$str[ b
,b c
$strd k
)k l
;l m
}n o
if 
( 
id 
== 
null 
|| 
id  
==! #
$num$ %
)% &
{' (
return) /
RedirectToAction0 @
(@ A
$strA H
,H I
$strJ Q
)Q R
;R S
}T U
var 
datos 
= 
service #
.# $
ObtenerTurnos$ 1
(1 2
)2 3
.3 4
Where4 9
(9 :
t: ;
=>< >
t? @
.@ A

IdServicioA K
==L N
idO Q
&&R T
tU V
.V W
Activo_InactivoW f
)f g
.g h
ToListh n
(n o
)o p
;p q
ViewBag 
. 
Servicio  
=! "
service# *
.* + 
ObtenerServicioPorId+ ?
(? @
id@ B
)B C
;C D
return 
View 
( 
datos 
) 
; 
}   	
[!! 	
	Authorize!!	 
]!! 
["" 	
HttpGet""	 
]"" 
public## 
ActionResult## 
BuscarTurno## '
(##' (
DateTime##( 0
?##0 1
fecha##2 7
,##7 8
int##9 <
?##< =
id##> @
)##@ A
{$$ 	
if%% 
(%% 
id%% 
==%% 
null%% 
||%% 
id%%  
==%%! #
$num%%$ %
)%%% &
{%%' (
return%%) /
RedirectToAction%%0 @
(%%@ A
$str%%A H
,%%H I
$str%%J Q
)%%Q R
;%%R S
}%%T U
List&& 
<&& 
Turno&& 
>&& 
datos&& 
;&& 
if'' 
('' 
fecha'' 
=='' 
null'' 
||''  
fecha''! &
.''& '
ToString''' /
(''/ 0
)''0 1
==''2 4
$str''5 O
)''O P
{(( 
datos)) 
=)) 
service)) 
.))  
ObtenerTurnos))  -
())- .
))). /
.))/ 0
Where))0 5
())5 6
t))6 7
=>))8 :
t)); <
.))< =

IdServicio))= G
==))H J
id))K M
&&))N P
t))Q R
.))R S
Activo_Inactivo))S b
)))b c
.))c d
ToList))d j
())j k
)))k l
;))l m
}** 
else++ 
{,, 
datos-- 
=-- 
service-- 
.--  
ObtenerTurnos--  -
(--- .
)--. /
.--/ 0
Where--0 5
(--5 6
t--6 7
=>--8 :
t--; <
.--< =

IdServicio--= G
==--H J
id--K M
&&--N P
t--Q R
.--R S
Fecha--S X
==--Y [
fecha--\ a
&&--b d
t--e f
.--f g
Activo_Inactivo--g v
)--v w
.--w x
ToList--x ~
(--~ 
)	-- Ä
;
--Ä Å
}.. 
ViewBag// 
.// 
Servicio// 
=// 
service// &
.//& ' 
ObtenerServicioPorId//' ;
(//; <
id//< >
)//> ?
;//? @
return00 
View00 
(00 
datos00 
)00 
;00 
}11 	
[22 	
	Authorize22	 
]22 
[33 	
HttpGet33	 
]33 
public44 
ActionResult44 
Crear44 !
(44! "
int44" %
?44% &
id44' )
)44) *
{55 	
if66 
(66 
!66 
sessionService66 
.66  )
EstaLogueadoComoAdministrador66  =
(66= >
)66> ?
)66? @
{66A B
return66C I
RedirectToAction66J Z
(66Z [
$str66[ b
,66b c
$str66d k
)66k l
;66l m
}66n o
if77 
(77 
id77 
==77 
null77 
||77 
id77  
==77! #
$num77$ %
)77% &
{77' (
return77) /
RedirectToAction770 @
(77@ A
$str77A H
,77H I
$str77J Q
)77Q R
;77R S
}77T U
ViewBag88 
.88 
Servicio88 
=88 
service88 &
.88& ' 
ObtenerServicioPorId88' ;
(88; <
id88< >
)88> ?
;88? @
return99 
View99 
(99 
new99 
Turno99 !
(99! "
)99" #
)99# $
;99$ %
}:: 	
[<< 	
	Authorize<<	 
]<< 
[== 	
HttpPost==	 
]== 
public>> 
ActionResult>> 
Crear>> !
(>>! "
Turno>>" '
turno>>( -
,>>- .
int>>/ 2
?>>2 3
id>>4 6
)>>6 7
{?? 	
if@@ 
(@@ 
!@@ 
sessionService@@ 
.@@  )
EstaLogueadoComoAdministrador@@  =
(@@= >
)@@> ?
)@@? @
{@@A B
return@@C I
RedirectToAction@@J Z
(@@Z [
$str@@[ b
,@@b c
$str@@d k
)@@k l
;@@l m
}@@n o
ifAA 
(AA 
idAA 
==AA 
nullAA 
||AA 
idAA  
==AA! #
$numAA$ %
)AA% &
{AA' (
returnAA) /
RedirectToActionAA0 @
(AA@ A
$strAAA H
,AAH I
$strAAJ Q
)AAQ R
;AAR S
}AAT U
validarBB 
(BB 
turnoBB 
,BB 
idBB 
)BB 
;BB 
validar1CC 
(CC 
turnoCC 
,CC 
idCC 
)CC 
;CC  
validar2DD 
(DD 
turnoDD 
,DD 
idDD 
)DD 
;DD  
validar2_copiaEE 
(EE 
turnoEE  
,EE  !
idEE" $
)EE$ %
;EE% &
validar3FF 
(FF 
turnoFF 
,FF 
idFF 
)FF 
;FF  
validar3_copiaGG 
(GG 
turnoGG  
,GG  !
idGG" $
)GG$ %
;GG% &
ifHH 
(HH 

ModelStateHH 
.HH 
IsValidHH "
)HH" #
{II 
serviceJJ 
.JJ 
GuardarTurnoJJ $
(JJ$ %
idJJ% '
,JJ' (
turnoJJ) .
)JJ. /
;JJ/ 0
returnKK 
RedirectToActionKK '
(KK' (
$strKK( /
,KK/ 0
newKK1 4
{KK5 6
idKK7 9
=KK: ;
turnoKK< A
.KKA B

IdServicioKKB L
}KKM N
)KKN O
;KKO P
}LL 
ViewBagMM 
.MM 
ServicioMM 
=MM 
serviceMM &
.MM& ' 
ObtenerServicioPorIdMM' ;
(MM; <
idMM< >
)MM> ?
;MM? @
returnNN 
ViewNN 
(NN 
turnoNN 
)NN 
;NN 
}OO 	
[PP 	
	AuthorizePP	 
]PP 
[QQ 	
HttpGetQQ	 
]QQ 
publicRR 
ActionResultRR 
EditarRR "
(RR" #
intRR# &
?RR& '
idRR( *
)RR* +
{SS 	
ifTT 
(TT 
idTT 
==TT 
nullTT 
||TT 
idTT  
==TT! #
$numTT$ %
)TT% &
{TT' (
returnTT) /
RedirectToActionTT0 @
(TT@ A
$strTTA H
,TTH I
$strTTJ Q
)TTQ R
;TTR S
}TTT U
varUU 
DbTurnoUU 
=UU 
serviceUU !
.UU! "
ObtenerTurnoPorIdUU" 3
(UU3 4
idUU4 6
)UU6 7
;UU7 8
ViewBagVV 
.VV 
ServicioVV 
=VV 
serviceVV &
.VV& ' 
ObtenerServicioPorIdVV' ;
(VV; <
DbTurnoVV< C
.VVC D

IdServicioVVD N
)VVN O
;VVO P
returnWW 
ViewWW 
(WW 
DbTurnoWW 
)WW  
;WW  !
}XX 	
[YY 	
	AuthorizeYY	 
]YY 
[ZZ 	
HttpPostZZ	 
]ZZ 
public[[ 
ActionResult[[ 
Editar[[ "
([[" #
Turno[[# (
turno[[) .
,[[. /
int[[0 3
?[[3 4
id[[5 7
)[[7 8
{\\ 	
if]] 
(]] 
id]] 
==]] 
null]] 
||]] 
id]]  
==]]! #
$num]]$ %
)]]% &
{]]' (
return]]) /
RedirectToAction]]0 @
(]]@ A
$str]]A H
,]]H I
$str]]J Q
)]]Q R
;]]R S
}]]T U
var^^ 
DbTurno^^ 
=^^ 
service^^ !
.^^! "
ObtenerTurnoPorId^^" 3
(^^3 4
id^^4 6
)^^6 7
;^^7 8
validarEditar__ 
(__ 
turno__ 
,__  
id__! #
)__# $
;__$ %
validarEditar1`` 
(`` 
turno``  
,``  !
id``" $
)``$ %
;``% &
validarEditar2aa 
(aa 
turnoaa  
,aa  !
idaa" $
)aa$ %
;aa% & 
validarEditar1_copiabb  
(bb  !
turnobb! &
,bb& '
idbb( *
)bb* +
;bb+ , 
validarEditar2_copiacc  
(cc  !
turnocc! &
,cc& '
idcc( *
)cc* +
;cc+ ,
ifdd 
(dd 

ModelStatedd 
.dd 
IsValiddd "
)dd" #
{ee 
serviceff 
.ff 
EditarTurnoff #
(ff# $
turnoff$ )
,ff) *
DbTurnoff+ 2
)ff2 3
;ff3 4
returngg 
RedirectToActiongg '
(gg' (
$strgg( /
,gg/ 0
newgg1 4
{gg5 6
idgg7 9
=gg: ;
DbTurnogg< C
.ggC D

IdServicioggD N
}ggO P
)ggP Q
;ggQ R
}hh 
ViewBagii 
.ii 
Servicioii 
=ii 
serviceii &
.ii& ' 
ObtenerServicioPorIdii' ;
(ii; <
DbTurnoii< C
.iiC D

IdServicioiiD N
)iiN O
;iiO P
returnjj 
Viewjj 
(jj 
DbTurnojj 
)jj  
;jj  !
}kk 	
[ll 	
	Authorizell	 
]ll 
[mm 	
HttpGetmm	 
]mm 
publicnn 
ActionResultnn 
Eliminarnn $
(nn$ %
intnn% (
?nn( )
idnn* ,
)nn, -
{oo 	
ifpp 
(pp 
idpp 
==pp 
nullpp 
||pp 
idpp  
==pp! #
$numpp$ %
)pp% &
{pp' (
returnpp) /
RedirectToActionpp0 @
(pp@ A
$strppA H
,ppH I
$strppJ Q
)ppQ R
;ppR S
}ppT U
varqq 
DbTurnoqq 
=qq 
serviceqq !
.qq! "
ObtenerTurnoPorIdqq" 3
(qq3 4
idqq4 6
)qq6 7
;qq7 8
ifrr 
(rr 
DbTurnorr 
!=rr 
nullrr 
)rr  
{ss 
servicett 
.tt 
EliminarTurnott %
(tt% &
DbTurnott& -
)tt- .
;tt. /
ViewBaguu 
.uu 
Turnouu 
=uu 
DbTurnouu  '
;uu' (
returnvv 
RedirectToActionvv '
(vv' (
$strvv( /
,vv/ 0
newvv1 4
{vv5 6
idvv7 9
=vv: ;
servicevv< C
.vvC D
ObtenerTurnoPorIdvvD U
(vvU V
idvvV X
)vvX Y
.vvY Z

IdServiciovvZ d
}vve f
)vvf g
;vvg h
}xx 
returnyy 
Viewyy 
(yy 
)yy 
;yy 
}zz 	
public|| 
void|| 
validar|| 
(|| 
Turno|| !
turno||" '
,||' (
int||) ,
?||, -
id||. 0
)||0 1
{}} 	
string~~ 
fechaP~~ 
=~~ 
Convert~~ #
.~~# $
ToString~~$ ,
(~~, -
turno~~- 2
.~~2 3
Fecha~~3 8
)~~8 9
;~~9 :
if 
( 
fechaP 
== 
$str 1
)1 2

ModelState
ÄÄ 
.
ÄÄ 
AddModelError
ÄÄ (
(
ÄÄ( )
$str
ÄÄ) 0
,
ÄÄ0 1
$str
ÄÄ2 V
)
ÄÄV W
;
ÄÄW X
if
ÅÅ 
(
ÅÅ 
turno
ÅÅ 
.
ÅÅ 
Fecha
ÅÅ 
.
ÅÅ 
ToString
ÅÅ $
(
ÅÅ$ %
)
ÅÅ% &
!=
ÅÅ' )
$str
ÅÅ* D
&&
ÅÅE G
turno
ÅÅH M
.
ÅÅM N
Fecha
ÅÅN S
<
ÅÅT U
DateTime
ÅÅV ^
.
ÅÅ^ _
Now
ÅÅ_ b
.
ÅÅb c
Date
ÅÅc g
)
ÅÅg h
{
ÇÇ 

ModelState
ÉÉ 
.
ÉÉ 
AddModelError
ÉÉ ,
(
ÉÉ, -
$str
ÉÉ- 4
,
ÉÉ4 5
$str
ÉÉ6 [
)
ÉÉ[ \
;
ÉÉ\ ]
}
ÑÑ 
Turno
ÖÖ 
t1
ÖÖ 
=
ÖÖ 
turno
ÖÖ 
,
ÖÖ 
t2
ÖÖ 
=
ÖÖ  
turno
ÖÖ  %
,
ÖÖ% &
t3
ÖÖ& (
=
ÖÖ( )
turno
ÖÖ) .
,
ÖÖ. /
t4
ÖÖ/ 1
=
ÖÖ1 2
turno
ÖÖ2 7
;
ÖÖ7 8
if
ÜÜ 
(
ÜÜ 
Convert
ÜÜ 
.
ÜÜ 
ToString
ÜÜ  
(
ÜÜ  !
t1
ÜÜ! #
.
ÜÜ# $

HoraInicio
ÜÜ$ .
)
ÜÜ. /
==
ÜÜ0 2
$str
ÜÜ3 =
)
ÜÜ= >

ModelState
áá 
.
áá 
AddModelError
áá (
(
áá( )
$str
áá) 5
,
áá5 6
$str
áá7 e
)
ááe f
;
ááf g
if
àà 
(
àà 
Convert
àà 
.
àà 
ToString
àà  
(
àà  !
t2
àà! #
.
àà# $
HoraFin
àà$ +
)
àà+ ,
==
àà- /
$str
àà0 :
)
àà: ;

ModelState
ââ 
.
ââ 
AddModelError
ââ (
(
ââ( )
$str
ââ) 2
,
ââ2 3
$str
ââ4 a
)
ââa b
;
ââb c
if
çç 
(
çç 
Convert
çç 
.
çç 
ToString
çç  
(
çç  !
t3
çç! #
.
çç# $

HoraInicio
çç$ .
)
çç. /
!=
çç0 2
$str
çç3 =
&&
çç> @
turno
ççA F
.
ççF G

HoraInicio
ççG Q
==
ççR T
turno
ççU Z
.
ççZ [
HoraFin
çç[ b
)
ççb c
{
éé 

ModelState
èè 
.
èè 
AddModelError
èè ,
(
èè, -
$str
èè- 6
,
èè6 7
$str
èè8 t
)
èèt u
;
èèu v
}
êê 
if
íí 
(
íí 
Convert
íí 
.
íí 
ToString
íí  
(
íí  !
t4
íí! #
.
íí# $

HoraInicio
íí$ .
)
íí. /
!=
íí0 2
$str
íí3 =
&&
íí> @
turno
ííA F
.
ííF G

HoraInicio
ííG Q
!=
ííR T
turno
ííU Z
.
ííZ [
HoraFin
íí[ b
&&
ííc e
turno
ííf k
.
íík l

HoraInicio
ííl v
>
ííw x
turno
ííy ~
.
íí~ 
HoraFiníí Ü
)ííÜ á
{
ìì 

ModelState
îî "
.
îî" #
AddModelError
îî# 0
(
îî0 1
$str
îî1 =
,
îî= >
$str
îî? |
)
îî| }
;
îî} ~
}
ïï 
}
óó 	
public
òò 
void
òò 
validar1
òò 
(
òò 
Turno
òò "
turno1
òò# )
,
òò) *
int
òò+ .
?
òò. /
id
òò0 2
)
òò2 3
{
ôô 	
if
õõ 
(
õõ 
Convert
õõ 
.
õõ 
ToString
õõ  
(
õõ  !
turno1
õõ! '
.
õõ' (

HoraInicio
õõ( 2
)
õõ2 3
!=
õõ4 6
$str
õõ7 A
&&
õõB D
turno1
õõE K
.
õõK L

HoraInicio
õõL V
!=
õõW Y
turno1
õõZ `
.
õõ` a
HoraFin
õõa h
&&
õõi k
turno1
õõl r
.
õõr s

HoraInicio
õõs }
<
õõ~ 
turno1õõÄ Ü
.õõÜ á
HoraFinõõá é
&&õõè ë
serviceõõí ô
.õõô ö
Existeõõö †
(õõ† °
idõõ° £
,õõ£ §
turno1õõ• ´
)õõ´ ¨
)õõ¨ ≠
{
úú 

ModelState
ùù 
.
ùù 
AddModelError
ùù ,
(
ùù, -
$str
ùù- 6
,
ùù6 7
$str
ùù8 N
)
ùùN O
;
ùùO P
}
ûû 
}
†† 	
public
°° 
void
°° 
validar2
°° 
(
°° 
Turno
°° "
turno2
°°# )
,
°°) *
int
°°+ .
?
°°. /
id
°°0 2
)
°°2 3
{
¢¢ 	
if
££ 
(
££ 
Convert
££ 
.
££ 
ToString
££  
(
££  !
turno2
££! '
.
££' (

HoraInicio
££( 2
)
££2 3
!=
££4 6
$str
££7 A
&&
££B D
turno2
££E K
.
££K L

HoraInicio
££L V
!=
££W Y
turno2
££Z `
.
££` a
HoraFin
££a h
&&
££i k
turno2
££l r
.
££r s

HoraInicio
££s }
<
££~ 
turno2££Ä Ü
.££Ü á
HoraFin££á é
&&££è ë
!££í ì
service££ì ö
.££ö õ
Existe££õ °
(££° ¢
id££¢ §
,££§ •
turno2££¶ ¨
)££¨ ≠
)££≠ Æ
{
§§ 
var
•• 
ListaTurnos
•• #
=
••$ %
service
••& -
.
••- .
ObtenerTurnos
••. ;
(
••; <
)
••< =
.
••= >
Where
••> C
(
••C D
a
••D E
=>
••F H
a
••I J
.
••J K

IdServicio
••K U
==
••V X
id
••Y [
)
••[ \
.
••\ ]
ToList
••] c
(
••c d
)
••d e
;
••e f
for
¶¶ 
(
¶¶ 
int
¶¶ 
i
¶¶ 
=
¶¶  
$num
¶¶! "
;
¶¶" #
i
¶¶$ %
<
¶¶& '
ListaTurnos
¶¶( 3
.
¶¶3 4
Count
¶¶4 9
;
¶¶9 :
i
¶¶; <
++
¶¶< >
)
¶¶> ?
{
ßß 
if
®® 
(
®® 
turno2
®® "
.
®®" #

HoraInicio
®®# -
>=
®®. 0
ListaTurnos
®®1 <
[
®®< =
i
®®= >
]
®®> ?
.
®®? @

HoraInicio
®®@ J
&&
®®K M
turno2
®®N T
.
®®T U

HoraInicio
®®U _
<=
®®` b
ListaTurnos
®®c n
[
®®n o
i
®®o p
]
®®p q
.
®®q r
HoraFin
®®r y
&&
®®z |
ListaTurnos®®} à
[®®à â
i®®â ä
]®®ä ã
.®®ã å
Fecha®®å ë
==®®í î
turno2®®ï õ
.®®õ ú
Fecha®®ú °
)®®° ¢
{
©© 

ModelState
™™ &
.
™™& '
AddModelError
™™' 4
(
™™4 5
$str
™™5 >
,
™™> ?
$str
™™@ h
)
™™h i
;
™™i j
}
´´ 
}
¨¨ 
}
ÆÆ 
}
ØØ 	
public
∞∞ 
void
∞∞ 
validar2_copia
∞∞ "
(
∞∞" #
Turno
∞∞# (
turno2C
∞∞) 0
,
∞∞0 1
int
∞∞2 5
?
∞∞5 6
id
∞∞7 9
)
∞∞9 :
{
±± 	
if
≤≤ 
(
≤≤ 
Convert
≤≤ 
.
≤≤ 
ToString
≤≤  
(
≤≤  !
turno2C
≤≤! (
.
≤≤( )

HoraInicio
≤≤) 3
)
≤≤3 4
!=
≤≤5 7
$str
≤≤8 B
&&
≤≤C E
turno2C
≤≤F M
.
≤≤M N

HoraInicio
≤≤N X
!=
≤≤Y [
turno2C
≤≤\ c
.
≤≤c d
HoraFin
≤≤d k
&&
≤≤l n
turno2C
≤≤o v
.
≤≤v w

HoraInicio≤≤w Å
<≤≤Ç É
turno2C≤≤Ñ ã
.≤≤ã å
HoraFin≤≤å ì
&&≤≤î ñ
!≤≤ó ò
service≤≤ò ü
.≤≤ü †
Existe≤≤† ¶
(≤≤¶ ß
id≤≤ß ©
,≤≤© ™
turno2C≤≤´ ≤
)≤≤≤ ≥
)≤≤≥ ¥
{
≥≥ 
var
¥¥ 
ListaTurnos
¥¥ #
=
¥¥$ %
service
¥¥& -
.
¥¥- .
ObtenerTurnos
¥¥. ;
(
¥¥; <
)
¥¥< =
.
¥¥= >
Where
¥¥> C
(
¥¥C D
a
¥¥D E
=>
¥¥F H
a
¥¥I J
.
¥¥J K

IdServicio
¥¥K U
==
¥¥V X
id
¥¥Y [
)
¥¥[ \
.
¥¥\ ]
ToList
¥¥] c
(
¥¥c d
)
¥¥d e
;
¥¥e f
for
µµ 
(
µµ 
int
µµ 
i
µµ 
=
µµ  
$num
µµ! "
;
µµ" #
i
µµ$ %
<
µµ& '
ListaTurnos
µµ( 3
.
µµ3 4
Count
µµ4 9
;
µµ9 :
i
µµ; <
++
µµ< >
)
µµ> ?
{
∂∂ 
if
∑∑ 
(
∑∑ 
turno2C
∑∑ #
.
∑∑# $
HoraFin
∑∑$ +
<=
∑∑, .
ListaTurnos
∑∑/ :
[
∑∑: ;
i
∑∑; <
]
∑∑< =
.
∑∑= >
HoraFin
∑∑> E
&&
∑∑F H
turno2C
∑∑I P
.
∑∑P Q
HoraFin
∑∑Q X
>=
∑∑Y [
ListaTurnos
∑∑\ g
[
∑∑g h
i
∑∑h i
]
∑∑i j
.
∑∑j k

HoraInicio
∑∑k u
&&
∑∑v x
ListaTurnos∑∑y Ñ
[∑∑Ñ Ö
i∑∑Ö Ü
]∑∑Ü á
.∑∑á à
Fecha∑∑à ç
==∑∑é ê
turno2C∑∑ë ò
.∑∑ò ô
Fecha∑∑ô û
)∑∑û ü
{
∏∏ 

ModelState
ππ &
.
ππ& '
AddModelError
ππ' 4
(
ππ4 5
$str
ππ5 >
,
ππ> ?
$str
ππ@ h
)
ππh i
;
ππi j
}
∫∫ 
}
ªª 
}
ºº 
}
ΩΩ 	
public
ææ 
void
ææ 
validar3
ææ 
(
ææ 
Turno
ææ "
turno3
ææ# )
,
ææ) *
int
ææ+ .
?
ææ. /
id
ææ0 2
)
ææ2 3
{
øø 	
if
¿¿ 
(
¿¿ 
Convert
¿¿ 
.
¿¿ 
ToString
¿¿  
(
¿¿  !
turno3
¿¿! '
.
¿¿' (

HoraInicio
¿¿( 2
)
¿¿2 3
!=
¿¿4 6
$str
¿¿7 A
&&
¿¿B D
turno3
¿¿E K
.
¿¿K L

HoraInicio
¿¿L V
!=
¿¿W Y
turno3
¿¿Z `
.
¿¿` a
HoraFin
¿¿a h
&&
¿¿i k
turno3
¿¿l r
.
¿¿r s

HoraInicio
¿¿s }
<
¿¿~ 
turno3¿¿Ä Ü
.¿¿Ü á
HoraFin¿¿á é
&&¿¿è ë
!¿¿í ì
service¿¿ì ö
.¿¿ö õ
Existe¿¿õ °
(¿¿° ¢
id¿¿¢ §
,¿¿§ •
turno3¿¿¶ ¨
)¿¿¨ ≠
)¿¿≠ Æ
{
¡¡ 
var
¬¬ 
ListaTurnos
¬¬ #
=
¬¬$ %
service
¬¬& -
.
¬¬- .
ObtenerTurnos
¬¬. ;
(
¬¬; <
)
¬¬< =
.
¬¬= >
Where
¬¬> C
(
¬¬C D
a
¬¬D E
=>
¬¬F H
a
¬¬I J
.
¬¬J K

IdServicio
¬¬K U
==
¬¬V X
id
¬¬Y [
)
¬¬[ \
.
¬¬\ ]
ToList
¬¬] c
(
¬¬c d
)
¬¬d e
;
¬¬e f
for
√√ 
(
√√ 
int
√√ 
i
√√ 
=
√√  
$num
√√! "
;
√√" #
i
√√$ %
<
√√& '
ListaTurnos
√√( 3
.
√√3 4
Count
√√4 9
;
√√9 :
i
√√; <
++
√√< >
)
√√> ?
{
ƒƒ 
if
≈≈ 
(
≈≈ 
turno3
≈≈ "
.
≈≈" #
HoraFin
≈≈# *
>=
≈≈+ -
ListaTurnos
≈≈. 9
[
≈≈9 :
i
≈≈: ;
]
≈≈; <
.
≈≈< =
HoraFin
≈≈= D
&&
≈≈E G
turno3
≈≈H N
.
≈≈N O

HoraInicio
≈≈O Y
<=
≈≈Z \
ListaTurnos
≈≈] h
[
≈≈h i
i
≈≈i j
]
≈≈j k
.
≈≈k l
HoraFin
≈≈l s
&&
≈≈t v
ListaTurnos≈≈w Ç
[≈≈Ç É
i≈≈É Ñ
]≈≈Ñ Ö
.≈≈Ö Ü
Fecha≈≈Ü ã
==≈≈å é
turno3≈≈è ï
.≈≈ï ñ
Fecha≈≈ñ õ
)≈≈õ ú
{
∆∆ 

ModelState
«« &
.
««& '
AddModelError
««' 4
(
««4 5
$str
««5 >
,
««> ?
$str
««@ h
)
««h i
;
««i j
}
»» 
}
…… 
}
   
}
ÀÀ 	
public
ÃÃ 
void
ÃÃ 
validar3_copia
ÃÃ "
(
ÃÃ" #
Turno
ÃÃ# (
turno3C
ÃÃ) 0
,
ÃÃ0 1
int
ÃÃ2 5
?
ÃÃ5 6
id
ÃÃ7 9
)
ÃÃ9 :
{
ÕÕ 	
if
ŒŒ 
(
ŒŒ 
Convert
ŒŒ 
.
ŒŒ 
ToString
ŒŒ  
(
ŒŒ  !
turno3C
ŒŒ! (
.
ŒŒ( )

HoraInicio
ŒŒ) 3
)
ŒŒ3 4
!=
ŒŒ5 7
$str
ŒŒ8 B
&&
ŒŒC E
turno3C
ŒŒF M
.
ŒŒM N

HoraInicio
ŒŒN X
!=
ŒŒY [
turno3C
ŒŒ\ c
.
ŒŒc d
HoraFin
ŒŒd k
&&
ŒŒl n
turno3C
ŒŒo v
.
ŒŒv w

HoraInicioŒŒw Å
<ŒŒÇ É
turno3CŒŒÑ ã
.ŒŒã å
HoraFinŒŒå ì
&&ŒŒî ñ
!ŒŒó ò
serviceŒŒò ü
.ŒŒü †
ExisteŒŒ† ¶
(ŒŒ¶ ß
idŒŒß ©
,ŒŒ© ™
turno3CŒŒ´ ≤
)ŒŒ≤ ≥
)ŒŒ≥ ¥
{
œœ 
var
–– 
ListaTurnos
–– #
=
––$ %
service
––& -
.
––- .
ObtenerTurnos
––. ;
(
––; <
)
––< =
.
––= >
Where
––> C
(
––C D
a
––D E
=>
––F H
a
––I J
.
––J K

IdServicio
––K U
==
––V X
id
––Y [
)
––[ \
.
––\ ]
ToList
––] c
(
––c d
)
––d e
;
––e f
for
—— 
(
—— 
int
—— 
i
—— 
=
——  
$num
——! "
;
——" #
i
——$ %
<
——& '
ListaTurnos
——( 3
.
——3 4
Count
——4 9
;
——9 :
i
——; <
++
——< >
)
——> ?
{
““ 
if
”” 
(
”” 
turno3C
”” #
.
””# $

HoraInicio
””$ .
<=
””/ 1
ListaTurnos
””2 =
[
””= >
i
””> ?
]
””? @
.
””@ A

HoraInicio
””A K
&&
””L N
turno3C
””O V
.
””V W
HoraFin
””W ^
>=
””_ a
ListaTurnos
””b m
[
””m n
i
””n o
]
””o p
.
””p q

HoraInicio
””q {
&&
””| ~
ListaTurnos”” ä
[””ä ã
i””ã å
]””å ç
.””ç é
Fecha””é ì
==””î ñ
turno3C””ó û
.””û ü
Fecha””ü §
)””§ •
{
‘‘ 

ModelState
’’ &
.
’’& '
AddModelError
’’' 4
(
’’4 5
$str
’’5 >
,
’’> ?
$str
’’@ h
)
’’h i
;
’’i j
}
÷÷ 
}
◊◊ 
}
ÿÿ 
}
ŸŸ 	
public
⁄⁄ 
void
⁄⁄ 
validarEditar
⁄⁄ !
(
⁄⁄! "
Turno
⁄⁄" '
turno
⁄⁄( -
,
⁄⁄- .
int
⁄⁄/ 2
?
⁄⁄2 3
id
⁄⁄4 6
)
⁄⁄6 7
{
€€ 	
Turno
‹‹ 
tu1
‹‹ 
=
‹‹ 
turno
‹‹ 
,
‹‹ 
tu2
‹‹ "
=
‹‹# $
turno
‹‹% *
,
‹‹* +
tu3
‹‹, /
=
‹‹0 1
turno
‹‹2 7
,
‹‹7 8
tu4
‹‹9 <
=
‹‹= >
turno
‹‹? D
;
‹‹D E
if
›› 
(
›› 
Convert
›› 
.
›› 
ToString
››  
(
››  !
tu1
››! $
.
››$ %

HoraInicio
››% /
)
››/ 0
==
››1 3
$str
››4 >
)
››> ?

ModelState
ﬁﬁ 
.
ﬁﬁ 
AddModelError
ﬁﬁ (
(
ﬁﬁ( )
$str
ﬁﬁ) 5
,
ﬁﬁ5 6
$str
ﬁﬁ7 e
)
ﬁﬁe f
;
ﬁﬁf g
if
ﬂﬂ 
(
ﬂﬂ 
Convert
ﬂﬂ 
.
ﬂﬂ 
ToString
ﬂﬂ  
(
ﬂﬂ  !
tu2
ﬂﬂ! $
.
ﬂﬂ$ %
HoraFin
ﬂﬂ% ,
)
ﬂﬂ, -
==
ﬂﬂ. 0
$str
ﬂﬂ1 ;
)
ﬂﬂ; <

ModelState
‡‡ 
.
‡‡ 
AddModelError
‡‡ (
(
‡‡( )
$str
‡‡) 2
,
‡‡2 3
$str
‡‡4 a
)
‡‡a b
;
‡‡b c
if
‰‰ 
(
‰‰ 
Convert
‰‰ 
.
‰‰ 
ToString
‰‰  
(
‰‰  !
tu3
‰‰! $
.
‰‰$ %

HoraInicio
‰‰% /
)
‰‰/ 0
!=
‰‰1 3
$str
‰‰4 >
&&
‰‰? A
turno
‰‰B G
.
‰‰G H

HoraInicio
‰‰H R
==
‰‰S U
turno
‰‰V [
.
‰‰[ \
HoraFin
‰‰\ c
)
‰‰c d
{
ÂÂ 

ModelState
ÊÊ 
.
ÊÊ 
AddModelError
ÊÊ ,
(
ÊÊ, -
$str
ÊÊ- 6
,
ÊÊ6 7
$str
ÊÊ8 t
)
ÊÊt u
;
ÊÊu v
}
ÁÁ 
if
ÈÈ 
(
ÈÈ 
Convert
ÈÈ 
.
ÈÈ 
ToString
ÈÈ  
(
ÈÈ  !
tu4
ÈÈ! $
.
ÈÈ$ %

HoraInicio
ÈÈ% /
)
ÈÈ/ 0
!=
ÈÈ1 3
$str
ÈÈ4 >
&&
ÈÈ? A
turno
ÈÈB G
.
ÈÈG H

HoraInicio
ÈÈH R
!=
ÈÈS U
turno
ÈÈV [
.
ÈÈ[ \
HoraFin
ÈÈ\ c
&&
ÈÈd f
turno
ÈÈg l
.
ÈÈl m

HoraInicio
ÈÈm w
>
ÈÈx y
turno
ÈÈz 
.ÈÈ Ä
HoraFinÈÈÄ á
)ÈÈá à
{
ÍÍ 

ModelState
ÎÎ "
.
ÎÎ" #
AddModelError
ÎÎ# 0
(
ÎÎ0 1
$str
ÎÎ1 =
,
ÎÎ= >
$str
ÎÎ? |
)
ÎÎ| }
;
ÎÎ} ~
}
ÏÏ 
}
ÌÌ 	
public
ÓÓ 
void
ÓÓ 
validarEditar1
ÓÓ "
(
ÓÓ" #
Turno
ÓÓ# (
turno1
ÓÓ) /
,
ÓÓ/ 0
int
ÓÓ1 4
?
ÓÓ4 5
id
ÓÓ6 8
)
ÓÓ8 9
{
ÔÔ 	
if
 
(
 
Convert
 
.
 
ToString
  
(
  !
turno1
! '
.
' (

HoraInicio
( 2
)
2 3
!=
4 6
$str
7 A
&&
B D
turno1
E K
.
K L

HoraInicio
L V
!=
W Y
turno1
Z `
.
` a
HoraFin
a h
&&
i k
turno1
l r
.
r s

HoraInicio
s }
<
~ 
turno1Ä Ü
.Ü á
HoraFiná é
&&è ë
!í ì
serviceì ö
.ö õ
Existeõ °
(° ¢
id¢ §
,§ •
turno1¶ ¨
)¨ ≠
)≠ Æ
{
ÒÒ 
var
ÚÚ 
ListaTurnos
ÚÚ #
=
ÚÚ$ %
service
ÚÚ& -
.
ÚÚ- .
ObtenerTurnos
ÚÚ. ;
(
ÚÚ; <
)
ÚÚ< =
.
ÚÚ= >
Where
ÚÚ> C
(
ÚÚC D
a
ÚÚD E
=>
ÚÚF H
a
ÚÚI J
.
ÚÚJ K

IdServicio
ÚÚK U
==
ÚÚV X
id
ÚÚY [
)
ÚÚ[ \
.
ÚÚ\ ]
ToList
ÚÚ] c
(
ÚÚc d
)
ÚÚd e
;
ÚÚe f
for
ÛÛ 
(
ÛÛ 
int
ÛÛ 
i
ÛÛ 
=
ÛÛ  
$num
ÛÛ! "
;
ÛÛ" #
i
ÛÛ$ %
<
ÛÛ& '
ListaTurnos
ÛÛ( 3
.
ÛÛ3 4
Count
ÛÛ4 9
;
ÛÛ9 :
i
ÛÛ; <
++
ÛÛ< >
)
ÛÛ> ?
{
ÙÙ 
if
ˆˆ 
(
ˆˆ 
turno1
ˆˆ "
.
ˆˆ" #

HoraInicio
ˆˆ# -
>=
ˆˆ. 0
ListaTurnos
ˆˆ1 <
[
ˆˆ< =
i
ˆˆ= >
]
ˆˆ> ?
.
ˆˆ? @

HoraInicio
ˆˆ@ J
&&
ˆˆK M
turno1
ˆˆN T
.
ˆˆT U

HoraInicio
ˆˆU _
<=
ˆˆ` b
ListaTurnos
ˆˆc n
[
ˆˆn o
i
ˆˆo p
]
ˆˆp q
.
ˆˆq r
HoraFin
ˆˆr y
&&
ˆˆz |
ListaTurnosˆˆ} à
[ˆˆà â
iˆˆâ ä
]ˆˆä ã
.ˆˆã å
Fechaˆˆå ë
==ˆˆí î
turno1ˆˆï õ
.ˆˆõ ú
Fechaˆˆú °
)ˆˆ° ¢
{
˜˜ 

ModelState
¯¯ &
.
¯¯& '
AddModelError
¯¯' 4
(
¯¯4 5
$str
¯¯5 >
,
¯¯> ?
$str
¯¯@ h
)
¯¯h i
;
¯¯i j
}
˘˘ 
}
˙˙ 
}
˚˚ 
}
¸¸ 	
public
˝˝ 
void
˝˝ "
validarEditar1_copia
˝˝ (
(
˝˝( )
Turno
˝˝) .
turno1EC
˝˝/ 7
,
˝˝7 8
int
˝˝9 <
?
˝˝< =
id
˝˝> @
)
˝˝@ A
{
˛˛ 	
if
ˇˇ 
(
ˇˇ 
Convert
ˇˇ 
.
ˇˇ 
ToString
ˇˇ  
(
ˇˇ  !
turno1EC
ˇˇ! )
.
ˇˇ) *

HoraInicio
ˇˇ* 4
)
ˇˇ4 5
!=
ˇˇ6 8
$str
ˇˇ9 C
&&
ˇˇD F
turno1EC
ˇˇG O
.
ˇˇO P

HoraInicio
ˇˇP Z
!=
ˇˇ[ ]
turno1EC
ˇˇ^ f
.
ˇˇf g
HoraFin
ˇˇg n
&&
ˇˇo q
turno1EC
ˇˇr z
.
ˇˇz {

HoraInicioˇˇ{ Ö
<ˇˇÜ á
turno1ECˇˇà ê
.ˇˇê ë
HoraFinˇˇë ò
&&ˇˇô õ
!ˇˇú ù
serviceˇˇù §
.ˇˇ§ •
Existeˇˇ• ´
(ˇˇ´ ¨
idˇˇ¨ Æ
,ˇˇÆ Ø
turno1ECˇˇ∞ ∏
)ˇˇ∏ π
)ˇˇπ ∫
{
ÄÄ 
var
ÅÅ 
ListaTurnos
ÅÅ #
=
ÅÅ$ %
service
ÅÅ& -
.
ÅÅ- .
ObtenerTurnos
ÅÅ. ;
(
ÅÅ; <
)
ÅÅ< =
.
ÅÅ= >
Where
ÅÅ> C
(
ÅÅC D
a
ÅÅD E
=>
ÅÅF H
a
ÅÅI J
.
ÅÅJ K

IdServicio
ÅÅK U
==
ÅÅV X
id
ÅÅY [
)
ÅÅ[ \
.
ÅÅ\ ]
ToList
ÅÅ] c
(
ÅÅc d
)
ÅÅd e
;
ÅÅe f
for
ÇÇ 
(
ÇÇ 
int
ÇÇ 
i
ÇÇ 
=
ÇÇ  
$num
ÇÇ! "
;
ÇÇ" #
i
ÇÇ$ %
<
ÇÇ& '
ListaTurnos
ÇÇ( 3
.
ÇÇ3 4
Count
ÇÇ4 9
;
ÇÇ9 :
i
ÇÇ; <
++
ÇÇ< >
)
ÇÇ> ?
{
ÉÉ 
if
ÖÖ 
(
ÖÖ 
turno1EC
ÖÖ $
.
ÖÖ$ %
HoraFin
ÖÖ% ,
<=
ÖÖ- /
ListaTurnos
ÖÖ0 ;
[
ÖÖ; <
i
ÖÖ< =
]
ÖÖ= >
.
ÖÖ> ?
HoraFin
ÖÖ? F
&&
ÖÖG I
turno1EC
ÖÖJ R
.
ÖÖR S
HoraFin
ÖÖS Z
>=
ÖÖ[ ]
ListaTurnos
ÖÖ^ i
[
ÖÖi j
i
ÖÖj k
]
ÖÖk l
.
ÖÖl m

HoraInicio
ÖÖm w
&&
ÖÖx z
ListaTurnosÖÖ{ Ü
[ÖÖÜ á
iÖÖá à
]ÖÖà â
.ÖÖâ ä
FechaÖÖä è
==ÖÖê í
turno1ECÖÖì õ
.ÖÖõ ú
FechaÖÖú °
)ÖÖ° ¢
{
ÜÜ 

ModelState
áá &
.
áá& '
AddModelError
áá' 4
(
áá4 5
$str
áá5 >
,
áá> ?
$str
áá@ h
)
ááh i
;
áái j
}
àà 
}
ââ 
}
ää 
}
ãã 	
public
åå 
void
åå 
validarEditar2
åå "
(
åå" #
Turno
åå# (
turnoE2
åå) 0
,
åå0 1
int
åå2 5
?
åå5 6
id
åå7 9
)
åå9 :
{
çç 	
if
éé 
(
éé 
Convert
éé 
.
éé 
ToString
éé  
(
éé  !
turnoE2
éé! (
.
éé( )

HoraInicio
éé) 3
)
éé3 4
!=
éé5 7
$str
éé8 B
&&
ééC E
turnoE2
ééF M
.
ééM N

HoraInicio
ééN X
!=
ééY [
turnoE2
éé\ c
.
ééc d
HoraFin
ééd k
&&
éél n
turnoE2
ééo v
.
éév w

HoraInicioééw Å
<ééÇ É
turnoE2ééÑ ã
.ééã å
HoraFinééå ì
&&ééî ñ
!ééó ò
serviceééò ü
.ééü †
Existeéé† ¶
(éé¶ ß
idééß ©
,éé© ™
turnoE2éé´ ≤
)éé≤ ≥
)éé≥ ¥
{
èè 
var
êê 
ListaTurnos
êê #
=
êê$ %
service
êê& -
.
êê- .
ObtenerTurnos
êê. ;
(
êê; <
)
êê< =
.
êê= >
Where
êê> C
(
êêC D
a
êêD E
=>
êêF H
a
êêI J
.
êêJ K

IdServicio
êêK U
==
êêV X
id
êêY [
)
êê[ \
.
êê\ ]
ToList
êê] c
(
êêc d
)
êêd e
;
êêe f
for
ëë 
(
ëë 
int
ëë 
i
ëë 
=
ëë  
$num
ëë! "
;
ëë" #
i
ëë$ %
<
ëë& '
ListaTurnos
ëë( 3
.
ëë3 4
Count
ëë4 9
;
ëë9 :
i
ëë; <
++
ëë< >
)
ëë> ?
{
íí 
if
ìì 
(
ìì 
turnoE2
ìì #
.
ìì# $
HoraFin
ìì$ +
>=
ìì, .
ListaTurnos
ìì/ :
[
ìì: ;
i
ìì; <
]
ìì< =
.
ìì= >
HoraFin
ìì> E
&&
ììF H
turnoE2
ììI P
.
ììP Q

HoraInicio
ììQ [
<=
ìì\ ^
ListaTurnos
ìì_ j
[
ììj k
i
ììk l
]
ììl m
.
ììm n
HoraFin
ììn u
&&
ììv x
ListaTurnosììy Ñ
[ììÑ Ö
iììÖ Ü
]ììÜ á
.ììá à
Fechaììà ç
==ììé ê
turnoE2ììë ò
.ììò ô
Fechaììô û
)ììû ü
{
îî 

ModelState
ïï &
.
ïï& '
AddModelError
ïï' 4
(
ïï4 5
$str
ïï5 >
,
ïï> ?
$str
ïï@ h
)
ïïh i
;
ïïi j
}
ññ 
}
óó 
}
òò 
}
ôô 	
public
öö 
void
öö "
validarEditar2_copia
öö (
(
öö( )
Turno
öö) .
turnoE2C
öö/ 7
,
öö7 8
int
öö9 <
?
öö< =
id
öö> @
)
öö@ A
{
õõ 	
if
úú 
(
úú 
Convert
úú 
.
úú 
ToString
úú  
(
úú  !
turnoE2C
úú! )
.
úú) *

HoraInicio
úú* 4
)
úú4 5
!=
úú6 8
$str
úú9 C
&&
úúD F
turnoE2C
úúG O
.
úúO P

HoraInicio
úúP Z
!=
úú[ ]
turnoE2C
úú^ f
.
úúf g
HoraFin
úúg n
&&
úúo q
turnoE2C
úúr z
.
úúz {

HoraInicioúú{ Ö
<úúÜ á
turnoE2Cúúà ê
.úúê ë
HoraFinúúë ò
&&úúô õ
!úúú ù
serviceúúù §
.úú§ •
Existeúú• ´
(úú´ ¨
idúú¨ Æ
,úúÆ Ø
turnoE2Cúú∞ ∏
)úú∏ π
)úúπ ∫
{
ùù 
var
ûû 
ListaTurnos
ûû #
=
ûû$ %
service
ûû& -
.
ûû- .
ObtenerTurnos
ûû. ;
(
ûû; <
)
ûû< =
.
ûû= >
Where
ûû> C
(
ûûC D
a
ûûD E
=>
ûûF H
a
ûûI J
.
ûûJ K

IdServicio
ûûK U
==
ûûV X
id
ûûY [
)
ûû[ \
.
ûû\ ]
ToList
ûû] c
(
ûûc d
)
ûûd e
;
ûûe f
for
üü 
(
üü 
int
üü 
i
üü 
=
üü  
$num
üü! "
;
üü" #
i
üü$ %
<
üü& '
ListaTurnos
üü( 3
.
üü3 4
Count
üü4 9
;
üü9 :
i
üü; <
++
üü< >
)
üü> ?
{
†† 
if
°° 
(
°° 
turnoE2C
°° $
.
°°$ %

HoraInicio
°°% /
<=
°°0 2
ListaTurnos
°°3 >
[
°°> ?
i
°°? @
]
°°@ A
.
°°A B

HoraInicio
°°B L
&&
°°M O
turnoE2C
°°P X
.
°°X Y
HoraFin
°°Y `
>=
°°a c
ListaTurnos
°°d o
[
°°o p
i
°°p q
]
°°q r
.
°°r s

HoraInicio
°°s }
&&°°~ Ä
ListaTurnos°°Å å
[°°å ç
i°°ç é
]°°é è
.°°è ê
Fecha°°ê ï
==°°ñ ò
turnoE2C°°ô °
.°°° ¢
Fecha°°¢ ß
)°°ß ®
{
¢¢ 

ModelState
££ &
.
££& '
AddModelError
££' 4
(
££4 5
$str
££5 >
,
££> ?
$str
££@ h
)
££h i
;
££i j
}
§§ 
}
•• 
}
¶¶ 
}
ßß 	
}
®® 
}©© €Õ
}C:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Controllers\UsuarioController.cs
	namespace 	
PROYECTO_INCABATHS
 
. 
Controllers (
{ 
public 

class 
UsuarioController "
:# $

Controller% /
{ 
private 
const 
string 

RutaImagen '
=( )
$str* 6
;6 7
private 
const 
string 
RutaI "
=# $
$str% 1
;1 2
private 
readonly 
IServiceSession (
sessionService) 7
;7 8
private 
readonly 
IUsuarioService (
service) 0
;0 1
public 
UsuarioController  
(  !
IUsuarioService! 0
service1 8
,8 9
IServiceSession: I
sessionServiceJ X
)X Y
{ 	
this 
. 
service 
= 
service "
;" #
this 
. 
sessionService 
=  !
sessionService" 0
;0 1
} 	
[ 	
	Authorize	 
] 
[ 	
HttpGet	 
] 
public 
ActionResult 
Index !
(! "
)" #
{ 	
if   
(   
!   
sessionService   
.    )
EstaLogueadoComoAdministrador    =
(  = >
)  > ?
)  ? @
{  A B
return  C I
RedirectToAction  J Z
(  Z [
$str  [ b
,  b c
$str  d k
)  k l
;  l m
}  n o
var!! 
datos!! 
=!! 
service!! 
.!!   
ObtenerListaUsuarios!!  4
(!!4 5
)!!5 6
.!!6 7
Where!!7 <
(!!< =
o!!= >
=>!!? A
o!!B C
.!!C D
Activo_Inactivo!!D S
)!!S T
.!!T U
ToList!!U [
(!![ \
)!!\ ]
;!!] ^
return"" 
View"" 
("" 
datos"" 
)"" 
;"" 
}## 	
[$$ 	
	Authorize$$	 
]$$ 
[%% 	
HttpGet%%	 
]%% 
public&& 
ActionResult&& 
BuscarUsuario&& )
(&&) *
string&&* 0
query&&1 6
)&&6 7
{'' 	
List(( 
<(( 
Usuario(( 
>(( 
datos(( 
;((  
if)) 
()) 
query)) 
==)) 
null)) 
||))  
query))! &
==))' )
$str))* ,
))), -
{** 
datos++ 
=++ 
service++ 
.++   
ObtenerListaUsuarios++  4
(++4 5
)++5 6
.++6 7
Where++7 <
(++< =
o++= >
=>++? A
o++B C
.++C D
Activo_Inactivo++D S
)++S T
.++T U
ToList++U [
(++[ \
)++\ ]
;++] ^
},, 
else-- 
{.. 
datos// 
=// 
service// 
.//   
ObtenerListaUsuarios//  4
(//4 5
)//5 6
.//6 7
Where//7 <
(//< =
o//= >
=>//? A
o//B C
.//C D
DNI//D G
.//G H
Contains//H P
(//P Q
query//Q V
)//V W
&&//X Z
o//[ \
.//\ ]
Activo_Inactivo//] l
)//l m
.//m n
ToList//n t
(//t u
)//u v
;//v w
}00 
ViewBag11 
.11 
datos11 
=11 
query11 !
;11! "
return22 
View22 
(22 
datos22 
)22 
;22 
}33 	
[44 	
	Authorize44	 
]44 
[55 	
HttpGet55	 
]55 
public66 
ActionResult66 
Crear66 !
(66! "
)66" #
{77 	
if88 
(88 
!88 
sessionService88 
.88  )
EstaLogueadoComoAdministrador88  =
(88= >
)88> ?
)88? @
{88A B
return88C I
RedirectToAction88J Z
(88Z [
$str88[ b
,88b c
$str88d k
)88k l
;88l m
}88n o
ViewBag99 
.99 
TipoUsuarios99  
=99! "
service99# *
.99* +&
ObtenerListaDeTipoUsuarios99+ E
(99E F
)99F G
.99G H
ToList99H N
(99N O
)99O P
;99P Q
return:: 
View:: 
(:: 
new:: 
Usuario:: #
(::# $
)::$ %
)::% &
;::& '
};; 	
[<< 	
	Authorize<<	 
]<< 
[== 	
HttpPost==	 
]== 
public>> 
ActionResult>> 
Crear>> !
(>>! "
Usuario>>" )
usuario>>* 1
,>>1 2
string>>3 9
RepitaPassword>>: H
,>>H I
HttpPostedFileBase>>J \
file>>] a
)>>a b
{?? 	
if@@ 
(@@ 
!@@ 
sessionService@@ 
.@@  )
EstaLogueadoComoAdministrador@@  =
(@@= >
)@@> ?
)@@? @
{@@A B
return@@C I
RedirectToAction@@J Z
(@@Z [
$str@@[ b
,@@b c
$str@@d k
)@@k l
;@@l m
}@@n o
ifAA 
(AA 
fileAA 
!=AA 
nullAA 
&&AA 
fileAA  $
.AA$ %
ContentLengthAA% 2
>AA3 4
$numAA5 6
)AA6 7
{BB 
stringCC 
rutaCC 
=CC 
PathCC "
.CC" #
CombineCC# *
(CC* +
ServerCC+ 1
.CC1 2
MapPathCC2 9
(CC9 :

RutaImagenCC: D
)CCD E
,CCE F
PathCCG K
.CCK L
GetFileNameCCL W
(CCW X
fileCCX \
.CC\ ]
FileNameCC] e
)CCe f
)CCf g
;CCg h
fileDD 
.DD 
SaveAsDD 
(DD 
rutaDD  
)DD  !
;DD! "
usuarioEE 
.EE 
PerfilEE 
=EE  
RutaIEE! &
+EE' (
PathEE) -
.EE- .
GetFileNameEE. 9
(EE9 :
fileEE: >
.EE> ?
FileNameEE? G
)EEG H
;EEH I
}FF 
validarGG 
(GG 
usuarioGG 
,GG 
RepitaPasswordGG *
)GG* +
;GG+ ,
validar1HH 
(HH 
usuarioHH 
,HH 
RepitaPasswordHH ,
)HH, -
;HH- .
validar2II 
(II 
usuarioII 
,II 
RepitaPasswordII ,
)II, -
;II- .
validar3JJ 
(JJ 
usuarioJJ 
,JJ 
RepitaPasswordJJ ,
)JJ, -
;JJ- .
ifKK 
(KK 

ModelStateKK 
.KK 
IsValidKK "
)KK" #
{LL 
serviceMM 
.MM 
CrearUsuarioMM $
(MM$ %
usuarioMM% ,
)MM, -
;MM- .
returnNN 
RedirectToActionNN '
(NN' (
$strNN( /
)NN/ 0
;NN0 1
}OO 
ViewBagPP 
.PP 
TipoUsuariosPP  
=PP! "
servicePP# *
.PP* +&
ObtenerListaDeTipoUsuariosPP+ E
(PPE F
)PPF G
.PPG H
ToListPPH N
(PPN O
)PPO P
;PPP Q
returnQQ 
ViewQQ 
(QQ 
usuarioQQ 
)QQ  
;QQ  !
}RR 	
[SS 	
	AuthorizeSS	 
]SS 
[TT 	
HttpGetTT	 
]TT 
publicUU 
ActionResultUU 
EditarUU "
(UU" #
intUU# &
?UU& '
idUU( *
)UU* +
{VV 	
ifWW 
(WW 
!WW 
sessionServiceWW 
.WW  )
EstaLogueadoComoAdministradorWW  =
(WW= >
)WW> ?
)WW? @
{WWA B
returnWWC I
RedirectToActionWWJ Z
(WWZ [
$strWW[ b
,WWb c
$strWWd k
)WWk l
;WWl m
}WWn o
ifXX 
(XX 
idXX 
==XX 
$numXX 
||XX 
idXX 
==XX  
nullXX! %
)XX% &
{XX' (
returnXX) /
RedirectToActionXX0 @
(XX@ A
$strXXA H
,XXH I
$strXXJ Q
)XXQ R
;XXR S
}XXT U
ViewBagZZ 
.ZZ 
TipoUsuariosZZ  
=ZZ! "
serviceZZ# *
.ZZ* +&
ObtenerListaDeTipoUsuariosZZ+ E
(ZZE F
)ZZF G
.ZZG H
ToListZZH N
(ZZN O
)ZZO P
;ZZP Q
var[[ 
	UsuarioDb[[ 
=[[ 
service[[ #
.[[# $
ObtenerUsuarioPorId[[$ 7
([[7 8
id[[8 :
)[[: ;
;[[; <
ViewBag\\ 
.\\ 
	IdUsuario\\ 
=\\ 
id\\  "
;\\" #
return]] 
View]] 
(]] 
	UsuarioDb]] !
)]]! "
;]]" #
}^^ 	
[__ 	
	Authorize__	 
]__ 
[`` 	
HttpPost``	 
]`` 
publicaa 
ActionResultaa 
Editaraa "
(aa" #
Usuarioaa# *
usuarioaa+ 2
,aa2 3
intaa4 7
?aa7 8
idaa9 ;
,aa; <
HttpPostedFileBaseaa= O
fileaaP T
)aaT U
{bb 	
ifcc 
(cc 
!cc 
sessionServicecc 
.cc  )
EstaLogueadoComoAdministradorcc  =
(cc= >
)cc> ?
)cc? @
{ccA B
returnccC I
RedirectToActionccJ Z
(ccZ [
$strcc[ b
,ccb c
$strccd k
)cck l
;ccl m
}ccn o
ifdd 
(dd 
iddd 
==dd 
$numdd 
||dd 
iddd 
==dd  
nulldd! %
)dd% &
{dd' (
returndd) /
RedirectToActiondd0 @
(dd@ A
$strddA H
,ddH I
$strddJ Q
)ddQ R
;ddR S
}ddT U
varff 
	UsuarioDbff 
=ff 
serviceff #
.ff# $
ObtenerUsuarioPorIdff$ 7
(ff7 8
idff8 :
)ff: ;
;ff; <
ifgg 
(gg 
filegg 
!=gg 
nullgg 
&&gg 
filegg  $
.gg$ %
ContentLengthgg% 2
>gg3 4
$numgg5 6
)gg6 7
{hh 
stringii 
rutaii 
=ii 
Pathii "
.ii" #
Combineii# *
(ii* +
Serverii+ 1
.ii1 2
MapPathii2 9
(ii9 :

RutaImagenii: D
)iiD E
,iiE F
PathiiG K
.iiK L
GetFileNameiiL W
(iiW X
fileiiX \
.ii\ ]
FileNameii] e
)iie f
)iif g
;iig h
filejj 
.jj 
SaveAsjj 
(jj 
rutajj  
)jj  !
;jj! "
usuariokk 
.kk 
Perfilkk 
=kk  
RutaIkk! &
+kk' (
Pathkk) -
.kk- .
GetFileNamekk. 9
(kk9 :
filekk: >
.kk> ?
FileNamekk? G
)kkG H
;kkH I
	UsuarioDbll 
.ll 
Perfilll  
=ll! "
usuarioll# *
.ll* +
Perfilll+ 1
;ll1 2
}mm  
validarEditarUsuarionn  
(nn  !
usuarionn! (
,nn( )
idnn* ,
)nn, -
;nn- .!
validarEditarUsuario1oo !
(oo! "
usuariooo" )
,oo) *
idoo+ -
)oo- .
;oo. /!
validarEditarUsuario2pp !
(pp! "
usuariopp" )
,pp) *
idpp+ -
)pp- .
;pp. /!
validarEditarUsuario3qq !
(qq! "
usuarioqq" )
,qq) *
idqq+ -
)qq- .
;qq. /
ifrr 
(rr 

ModelStaterr 
.rr 
IsValidrr "
)rr" #
{ss 
servicett 
.tt 
EditarUsuariott %
(tt% &
usuariott& -
,tt- .
	UsuarioDbtt/ 8
)tt8 9
;tt9 :
returnuu 
RedirectToActionuu '
(uu' (
$struu( /
)uu/ 0
;uu0 1
}vv 
ViewBagww 
.ww 
TipoUsuariosww  
=ww! "
serviceww# *
.ww* +&
ObtenerListaDeTipoUsuariosww+ E
(wwE F
)wwF G
.wwG H
ToListwwH N
(wwN O
)wwO P
;wwP Q
ViewBagxx 
.xx 
	IdUsuarioxx 
=xx 
idxx  "
;xx" #
returnyy 
Viewyy 
(yy 
	UsuarioDbyy !
)yy! "
;yy" #
}zz 	
[{{ 	
	Authorize{{	 
]{{ 
[|| 	
HttpGet||	 
]|| 
public}} 
ActionResult}} 
Eliminar}} $
(}}$ %
int}}% (
id}}) +
)}}+ ,
{~~ 	
service 
. 
EliminarUsuario #
(# $
id$ &
)& '
;' (
return
ÄÄ 
RedirectToAction
ÄÄ #
(
ÄÄ# $
$str
ÄÄ$ +
)
ÄÄ+ ,
;
ÄÄ, -
}
ÇÇ 	
[
ÉÉ 	
	Authorize
ÉÉ	 
]
ÉÉ 
[
ÑÑ 	
HttpGet
ÑÑ	 
]
ÑÑ 
public
ÖÖ 
ActionResult
ÖÖ 
VerMiCuenta
ÖÖ '
(
ÖÖ' (
)
ÖÖ( )
{
ÜÜ 	
if
áá 
(
áá 
!
áá 
sessionService
áá 
.
áá  %
EstaLogueadoComoCliente
áá  7
(
áá7 8
)
áá8 9
)
áá9 :
{
áá; <
return
áá= C
RedirectToAction
ááD T
(
ááT U
$str
ááU \
,
áá\ ]
$str
áá^ e
)
ááe f
;
ááf g
}
ááh i
var
àà 
usuarioIdDB
àà 
=
àà 
service
àà %
.
àà% &$
BuscarIdUsuarioSession
àà& <
(
àà< =
)
àà= >
;
àà> ?
var
ää 
	UsuarioDb
ää 
=
ää 
service
ää  '
.
ää' (!
ObtenerUsuarioPorId
ää( ;
(
ää; <
usuarioIdDB
ää< G
)
ääG H
;
ääH I
return
ãã 
View
ãã 
(
ãã 
	UsuarioDb
ãã %
)
ãã% &
;
ãã& '
}
åå 	
[
çç 	
	Authorize
çç	 
]
çç 
[
éé 	
HttpGet
éé	 
]
éé 
public
èè 
ActionResult
èè %
ActualizarDatosUCliente
èè 3
(
èè3 4
)
èè4 5
{
êê 	
if
ëë 
(
ëë 
!
ëë 
sessionService
ëë 
.
ëë  %
EstaLogueadoComoCliente
ëë  7
(
ëë7 8
)
ëë8 9
)
ëë9 :
{
ëë; <
return
ëë= C
RedirectToAction
ëëD T
(
ëëT U
$str
ëëU \
,
ëë\ ]
$str
ëë^ e
)
ëëe f
;
ëëf g
}
ëëh i
var
íí 
usuarioIdDB
íí 
=
íí 
service
íí %
.
íí% &$
BuscarIdUsuarioSession
íí& <
(
íí< =
)
íí= >
;
íí> ?
if
ìì 
(
ìì 
usuarioIdDB
ìì 
!=
ìì 
$num
ìì  
)
ìì  !
{
îî 
var
ïï 
	UsuarioDb
ïï 
=
ïï 
service
ïï  '
.
ïï' ("
ObtenerListaUsuarios
ïï( <
(
ïï< =
)
ïï= >
.
ïï> ?
First
ïï? D
(
ïïD E
o
ïïE F
=>
ïïG I
o
ïïJ K
.
ïïK L
	IdUsuario
ïïL U
==
ïïV X
usuarioIdDB
ïïY d
)
ïïd e
;
ïïe f
return
ññ 
View
ññ 
(
ññ 
	UsuarioDb
ññ %
)
ññ% &
;
ññ& '
}
óó 
return
òò 
View
òò 
(
òò 
)
òò 
;
òò 
}
ôô 	
[
öö 	
	Authorize
öö	 
]
öö 
[
õõ 	
HttpPost
õõ	 
]
õõ 
public
úú 
ActionResult
úú %
ActualizarDatosUCliente
úú 3
(
úú3 4
Usuario
úú4 ;
usuario
úú< C
,
úúC D 
HttpPostedFileBase
úúE W
archivo
úúX _
)
úú_ `
{
ùù 	
if
ûû 
(
ûû 
!
ûû 
sessionService
ûû 
.
ûû  %
EstaLogueadoComoCliente
ûû  7
(
ûû7 8
)
ûû8 9
)
ûû9 :
{
ûû; <
return
ûû= C
RedirectToAction
ûûD T
(
ûûT U
$str
ûûU \
,
ûû\ ]
$str
ûû^ e
)
ûûe f
;
ûûf g
}
ûûh i
var
üü 
usuarioIdDB
üü 
=
üü 
service
üü %
.
üü% &$
BuscarIdUsuarioSession
üü& <
(
üü< =
)
üü= >
;
üü> ?
var
†† 
	UsuarioDb
†† 
=
†† 
service
†† #
.
††# $"
ObtenerListaUsuarios
††$ 8
(
††8 9
)
††9 :
.
††: ;
First
††; @
(
††@ A
o
††A B
=>
††C E
o
††F G
.
††G H
	IdUsuario
††H Q
==
††R T
usuarioIdDB
††U `
)
††` a
;
††a b
if
¢¢ 
(
¢¢ 
archivo
¢¢ 
!=
¢¢ 
null
¢¢ 
&&
¢¢  "
archivo
¢¢# *
.
¢¢* +
ContentLength
¢¢+ 8
>
¢¢9 :
$num
¢¢; <
)
¢¢< =
{
££ 
string
§§ 
ruta
§§ 
=
§§ 
Path
§§ "
.
§§" #
Combine
§§# *
(
§§* +
Server
§§+ 1
.
§§1 2
MapPath
§§2 9
(
§§9 :

RutaImagen
§§: D
)
§§D E
,
§§E F
Path
§§G K
.
§§K L
GetFileName
§§L W
(
§§W X
archivo
§§X _
.
§§_ `
FileName
§§` h
)
§§h i
)
§§i j
;
§§j k
archivo
•• 
.
•• 
SaveAs
•• 
(
•• 
ruta
•• #
)
••# $
;
••$ %
usuario
¶¶ 
.
¶¶ 
Perfil
¶¶ 
=
¶¶  
RutaI
¶¶! &
+
¶¶' (
Path
¶¶) -
.
¶¶- .
GetFileName
¶¶. 9
(
¶¶9 :
archivo
¶¶: A
.
¶¶A B
FileName
¶¶B J
)
¶¶J K
;
¶¶K L
	UsuarioDb
ßß 
.
ßß 
Perfil
ßß  
=
ßß! "
usuario
ßß# *
.
ßß* +
Perfil
ßß+ 1
;
ßß1 2
}
®® $
validarActualizarDatos
™™ "
(
™™" #
usuario
™™# *
)
™™* +
;
™™+ ,%
validarActualizarDatos1
´´ #
(
´´# $
usuario
´´$ +
)
´´+ ,
;
´´, -%
validarActualizarDatos2
¨¨ #
(
¨¨# $
usuario
¨¨$ +
)
¨¨+ ,
;
¨¨, -
if
≠≠ 
(
≠≠ 

ModelState
≠≠ 
.
≠≠ 
IsValid
≠≠ "
)
≠≠" #
{
ÆÆ 
service
ØØ 
.
ØØ $
ActualizarDatosUsuario
ØØ .
(
ØØ. /
usuario
ØØ/ 6
,
ØØ6 7
	UsuarioDb
ØØ8 A
)
ØØA B
;
ØØB C
Session
∞∞ 
[
∞∞ 
$str
∞∞ '
]
∞∞' (
=
∞∞) *
usuario
∞∞+ 2
.
∞∞2 3
Nombre
∞∞3 9
;
∞∞9 :
Session
±± 
[
±± 
$str
±± $
]
±±$ %
=
±±& '
usuario
±±( /
.
±±/ 0
DNI
±±0 3
;
±±3 4
return
≤≤ 
RedirectToAction
≤≤ '
(
≤≤' (
$str
≤≤( 5
)
≤≤5 6
;
≤≤6 7
}
≥≥ 
return
¥¥ 
View
¥¥ 
(
¥¥ 
usuario
¥¥ 
)
¥¥  
;
¥¥  !
}
µµ 	
[
∂∂ 	
	Authorize
∂∂	 
]
∂∂ 
[
∑∑ 	
HttpGet
∑∑	 
]
∑∑ 
public
∏∏ 
ActionResult
∏∏ "
CambiarContraUsuario
∏∏ 0
(
∏∏0 1
)
∏∏1 2
{
ππ 	
if
∫∫ 
(
∫∫ 
!
∫∫ 
sessionService
∫∫ 
.
∫∫  %
EstaLogueadoComoCliente
∫∫  7
(
∫∫7 8
)
∫∫8 9
)
∫∫9 :
{
∫∫; <
return
∫∫= C
RedirectToAction
∫∫D T
(
∫∫T U
$str
∫∫U \
,
∫∫\ ]
$str
∫∫^ e
)
∫∫e f
;
∫∫f g
}
∫∫h i
return
ªª 
View
ªª 
(
ªª 
new
ªª 
Usuario
ªª #
(
ªª# $
)
ªª$ %
)
ªª% &
;
ªª& '
}
ºº 	
[
ΩΩ 	
	Authorize
ΩΩ	 
]
ΩΩ 
[
ææ 	
HttpPost
ææ	 
]
ææ 
public
øø 
ActionResult
øø "
CambiarContraUsuario
øø 0
(
øø0 1
Usuario
øø1 8
usuario
øø9 @
,
øø@ A
string
øøB H
NuevaPassword
øøI V
,
øøV W
string
øøX ^
RepitaPassword
øø_ m
)
øøm n
{
¿¿ 	"
ValidarCambiarContra
¡¡  
(
¡¡  !
usuario
¡¡! (
,
¡¡( )
NuevaPassword
¡¡* 7
,
¡¡7 8
RepitaPassword
¡¡9 G
)
¡¡G H
;
¡¡H I#
ValidarCambiarContra1
¡¡I ^
(
¡¡^ _
usuario
¡¡_ f
,
¡¡f g
NuevaPassword
¡¡h u
,
¡¡u v
RepitaPassword¡¡w Ö
)¡¡Ö Ü
;¡¡Ü á
if
¬¬ 
(
¬¬ 

ModelState
¬¬ 
.
¬¬ 
IsValid
¬¬ "
)
¬¬" #
{
√√ 
var
ƒƒ 
usuarioIdDB
ƒƒ 
=
ƒƒ  !
Convert
ƒƒ" )
.
ƒƒ) *
ToInt32
ƒƒ* 1
(
ƒƒ1 2
Session
ƒƒ2 9
[
ƒƒ9 :
$str
ƒƒ: E
]
ƒƒE F
)
ƒƒF G
;
ƒƒG H
var
≈≈ 
	UsuarioDb
≈≈ 
=
≈≈ 
service
≈≈  '
.
≈≈' ("
ObtenerListaUsuarios
≈≈( <
(
≈≈< =
)
≈≈= >
.
≈≈> ?
First
≈≈? D
(
≈≈D E
o
≈≈E F
=>
≈≈G I
o
≈≈J K
.
≈≈K L
	IdUsuario
≈≈L U
==
≈≈V X
usuarioIdDB
≈≈Y d
)
≈≈d e
;
≈≈e f
service
∆∆ 
.
∆∆ "
CambiarContraUsuario
∆∆ ,
(
∆∆, -
NuevaPassword
∆∆- :
,
∆∆: ;
	UsuarioDb
∆∆; D
)
∆∆D E
;
∆∆E F
return
«« 
RedirectToAction
«« '
(
««' (
$str
««( 0
,
««0 1
$str
««2 8
)
««8 9
;
««9 :
}
»» 
return
…… 
View
…… 
(
…… 
usuario
…… 
)
……  
;
……  !
}
   	
[
ÃÃ 	
	Authorize
ÃÃ	 
]
ÃÃ 
[
ÕÕ 	
HttpGet
ÕÕ	 
]
ÕÕ 
public
ŒŒ 
ActionResult
ŒŒ 
VerMiCuentaAdmin
ŒŒ ,
(
ŒŒ, -
)
ŒŒ- .
{
œœ 	
if
–– 
(
–– 
!
–– 
sessionService
–– 
.
––  +
EstaLogueadoComoAdministrador
––  =
(
––= >
)
––> ?
)
––? @
{
––A B
return
––C I
RedirectToAction
––J Z
(
––Z [
$str
––[ b
,
––b c
$str
––d k
)
––k l
;
––l m
}
––n o
var
—— 
usuarioIdDB
—— 
=
—— 
service
—— %
.
——% &$
BuscarIdUsuarioSession
——& <
(
——< =
)
——= >
;
——> ?
var
““ 
	UsuarioDb
““ 
=
““ 
service
““ #
.
““# $"
ObtenerListaUsuarios
““$ 8
(
““8 9
)
““9 :
.
““: ;
First
““; @
(
““@ A
o
““A B
=>
““C E
o
““F G
.
““G H
	IdUsuario
““H Q
==
““R T
usuarioIdDB
““U `
)
““` a
;
““a b
return
”” 
View
”” 
(
”” 
	UsuarioDb
”” !
)
””! "
;
””" #
}
‘‘ 	
[
’’ 	
	Authorize
’’	 
]
’’ 
[
÷÷ 	
HttpGet
÷÷	 
]
÷÷ 
public
◊◊ 
ActionResult
◊◊ #
ActualizarDatosUAdmin
◊◊ 1
(
◊◊1 2
)
◊◊2 3
{
ÿÿ 	
if
ŸŸ 
(
ŸŸ 
!
ŸŸ 
sessionService
ŸŸ 
.
ŸŸ  +
EstaLogueadoComoAdministrador
ŸŸ  =
(
ŸŸ= >
)
ŸŸ> ?
)
ŸŸ? @
{
ŸŸA B
return
ŸŸC I
RedirectToAction
ŸŸJ Z
(
ŸŸZ [
$str
ŸŸ[ b
,
ŸŸb c
$str
ŸŸd k
)
ŸŸk l
;
ŸŸl m
}
ŸŸn o
var
⁄⁄ 
usuarioIdDB
⁄⁄ 
=
⁄⁄ 
service
⁄⁄ %
.
⁄⁄% &$
BuscarIdUsuarioSession
⁄⁄& <
(
⁄⁄< =
)
⁄⁄= >
;
⁄⁄> ?
var
€€ 
UsuarioObtenido
€€ 
=
€€  !
service
€€" )
.
€€) *"
ObtenerListaUsuarios
€€* >
(
€€> ?
)
€€? @
.
€€@ A
First
€€A F
(
€€F G
o
€€G H
=>
€€I K
o
€€L M
.
€€M N
	IdUsuario
€€N W
==
€€X Z
usuarioIdDB
€€[ f
)
€€f g
;
€€g h
return
‹‹ 
View
‹‹ 
(
‹‹ 
UsuarioObtenido
‹‹ '
)
‹‹' (
;
‹‹( )
}
›› 	
[
ﬁﬁ 	
	Authorize
ﬁﬁ	 
]
ﬁﬁ 
[
ﬂﬂ 	
HttpPost
ﬂﬂ	 
]
ﬂﬂ 
public
‡‡ 
ActionResult
‡‡ #
ActualizarDatosUAdmin
‡‡ 1
(
‡‡1 2
Usuario
‡‡2 9
usuario
‡‡: A
,
‡‡A B 
HttpPostedFileBase
‡‡C U
file
‡‡V Z
)
‡‡Z [
{
·· 	
var
‚‚ 
usuarioIdDB
‚‚ 
=
‚‚ 
service
‚‚ %
.
‚‚% &$
BuscarIdUsuarioSession
‚‚& <
(
‚‚< =
)
‚‚= >
;
‚‚> ?
var
„„ 
	UsuarioDb
„„ 
=
„„ 
service
„„ #
.
„„# $"
ObtenerListaUsuarios
„„$ 8
(
„„8 9
)
„„9 :
.
„„: ;
First
„„; @
(
„„@ A
o
„„A B
=>
„„C E
o
„„F G
.
„„G H
	IdUsuario
„„H Q
==
„„R T
usuarioIdDB
„„U `
)
„„` a
;
„„a b
if
ÂÂ 
(
ÂÂ 
file
ÂÂ 
!=
ÂÂ 
null
ÂÂ 
&&
ÂÂ 
file
ÂÂ  $
.
ÂÂ$ %
ContentLength
ÂÂ% 2
>
ÂÂ3 4
$num
ÂÂ5 6
)
ÂÂ6 7
{
ÊÊ 
string
ÁÁ 
ruta
ÁÁ 
=
ÁÁ 
Path
ÁÁ "
.
ÁÁ" #
Combine
ÁÁ# *
(
ÁÁ* +
Server
ÁÁ+ 1
.
ÁÁ1 2
MapPath
ÁÁ2 9
(
ÁÁ9 :

RutaImagen
ÁÁ: D
)
ÁÁD E
,
ÁÁE F
Path
ÁÁG K
.
ÁÁK L
GetFileName
ÁÁL W
(
ÁÁW X
file
ÁÁX \
.
ÁÁ\ ]
FileName
ÁÁ] e
)
ÁÁe f
)
ÁÁf g
;
ÁÁg h
file
ËË 
.
ËË 
SaveAs
ËË 
(
ËË 
ruta
ËË  
)
ËË  !
;
ËË! "
usuario
ÈÈ 
.
ÈÈ 
Perfil
ÈÈ 
=
ÈÈ  
RutaI
ÈÈ! &
+
ÈÈ' (
Path
ÈÈ) -
.
ÈÈ- .
GetFileName
ÈÈ. 9
(
ÈÈ9 :
file
ÈÈ: >
.
ÈÈ> ?
FileName
ÈÈ? G
)
ÈÈG H
;
ÈÈH I
	UsuarioDb
ÍÍ 
.
ÍÍ 
Perfil
ÍÍ  
=
ÍÍ! "
usuario
ÍÍ# *
.
ÍÍ* +
Perfil
ÍÍ+ 1
;
ÍÍ1 2
}
ÎÎ $
validarActualizarDatos
ÏÏ "
(
ÏÏ" #
usuario
ÏÏ# *
)
ÏÏ* +
;
ÏÏ+ ,
if
ÌÌ 
(
ÌÌ 

ModelState
ÌÌ 
.
ÌÌ 
IsValid
ÌÌ "
)
ÌÌ" #
{
ÓÓ 
service
ÔÔ 
.
ÔÔ $
ActualizarDatosUsuario
ÔÔ .
(
ÔÔ. /
usuario
ÔÔ/ 6
,
ÔÔ6 7
	UsuarioDb
ÔÔ8 A
)
ÔÔA B
;
ÔÔB C
Session
 
[
 
$str
 '
]
' (
=
) *
usuario
+ 2
.
2 3
Nombre
3 9
;
9 :
Session
ÒÒ 
[
ÒÒ 
$str
ÒÒ $
]
ÒÒ$ %
=
ÒÒ& '
usuario
ÒÒ( /
.
ÒÒ/ 0
DNI
ÒÒ0 3
;
ÒÒ3 4
return
ÚÚ 
RedirectToAction
ÚÚ '
(
ÚÚ' (
$str
ÚÚ( :
)
ÚÚ: ;
;
ÚÚ; <
}
ÛÛ 
return
ÙÙ 
View
ÙÙ 
(
ÙÙ 
usuario
ÙÙ 
)
ÙÙ  
;
ÙÙ  !
}
ıı 	
[
ˆˆ 	
	Authorize
ˆˆ	 
]
ˆˆ 
[
˜˜ 	
HttpGet
˜˜	 
]
˜˜ 
public
¯¯ 
ActionResult
¯¯ '
CambiarContraUsuarioAdmin
¯¯ 5
(
¯¯5 6
)
¯¯6 7
{
˘˘ 	
if
˙˙ 
(
˙˙ 
!
˙˙ 
sessionService
˙˙ 
.
˙˙  +
EstaLogueadoComoAdministrador
˙˙  =
(
˙˙= >
)
˙˙> ?
)
˙˙? @
{
˙˙A B
return
˙˙C I
RedirectToAction
˙˙J Z
(
˙˙Z [
$str
˙˙[ b
,
˙˙b c
$str
˙˙d k
)
˙˙k l
;
˙˙l m
}
˙˙n o
return
˚˚ 
View
˚˚ 
(
˚˚ 
new
˚˚ 
Usuario
˚˚ #
(
˚˚# $
)
˚˚$ %
)
˚˚% &
;
˚˚& '
}
¸¸ 	
[
˝˝ 	
	Authorize
˝˝	 
]
˝˝ 
[
˛˛ 	
HttpPost
˛˛	 
]
˛˛ 
public
ˇˇ 
ActionResult
ˇˇ '
CambiarContraUsuarioAdmin
ˇˇ 5
(
ˇˇ5 6
Usuario
ˇˇ6 =
usuario
ˇˇ> E
,
ˇˇE F
string
ˇˇG M
NuevaPassword
ˇˇN [
,
ˇˇ[ \
string
ˇˇ] c
RepitaPassword
ˇˇd r
)
ˇˇr s
{
ÄÄ 	"
ValidarCambiarContra
ÅÅ  
(
ÅÅ  !
usuario
ÅÅ! (
,
ÅÅ( )
NuevaPassword
ÅÅ* 7
,
ÅÅ7 8
RepitaPassword
ÅÅ9 G
)
ÅÅG H
;
ÅÅH I
if
ÇÇ 
(
ÇÇ 

ModelState
ÇÇ 
.
ÇÇ 
IsValid
ÇÇ "
)
ÇÇ" #
{
ÉÉ 
var
ÑÑ 
usuarioIdDB
ÑÑ 
=
ÑÑ  !
service
ÑÑ" )
.
ÑÑ) *$
BuscarIdUsuarioSession
ÑÑ* @
(
ÑÑ@ A
)
ÑÑA B
;
ÑÑB C
var
ÖÖ 
	UsuarioDb
ÖÖ 
=
ÖÖ 
service
ÖÖ  '
.
ÖÖ' ("
ObtenerListaUsuarios
ÖÖ( <
(
ÖÖ< =
)
ÖÖ= >
.
ÖÖ> ?
First
ÖÖ? D
(
ÖÖD E
o
ÖÖE F
=>
ÖÖG I
o
ÖÖJ K
.
ÖÖK L
	IdUsuario
ÖÖL U
==
ÖÖV X
usuarioIdDB
ÖÖY d
)
ÖÖd e
;
ÖÖe f
service
ÜÜ 
.
ÜÜ "
CambiarContraUsuario
ÜÜ ,
(
ÜÜ, -
NuevaPassword
ÜÜ- :
,
ÜÜ: ;
	UsuarioDb
ÜÜ< E
)
ÜÜE F
;
ÜÜF G
return
áá 
RedirectToAction
áá '
(
áá' (
$str
áá( 0
,
áá0 1
$str
áá2 8
)
áá8 9
;
áá9 :
}
àà 
return
ââ 
View
ââ 
(
ââ 
usuario
ââ 
)
ââ  
;
ââ  !
}
ää 	
private
åå 
readonly
åå 
AppConexionDB
åå &
conexion
åå' /
=
åå0 1
new
åå2 5
AppConexionDB
åå6 C
(
ååC D
)
ååD E
;
ååE F
public
çç 
void
çç "
ValidarCambiarContra
çç (
(
çç( )
Usuario
çç) 0
usuario
çç1 8
,
çç8 9
string
çç: @
NuevaPassword
ççA N
,
ççN O
string
ççP V
RepitaPassword
ççW e
)
ççe f
{
éé 	
var
èè 
usuarioIdDB
èè 
=
èè 
service
èè %
.
èè% &$
BuscarIdUsuarioSession
èè& <
(
èè< =
)
èè= >
;
èè> ?
if
êê 
(
êê 
usuario
êê 
.
êê 
Password
êê  
!=
êê! #
null
êê$ (
&&
êê) +
usuario
êê, 3
.
êê3 4
Password
êê4 <
!=
êê= ?
$str
êê@ B
&&
êêC E
service
êêF M
.
êêM N
Existe
êêN T
(
êêT U
usuario
êêU \
,
êê\ ]
usuarioIdDB
êê^ i
)
êêi j
==
êêk m
$num
êên o
)
êêo p
{
ëë 

ModelState
íí 
.
íí 
AddModelError
íí ,
(
íí, -
$str
íí- 7
,
íí7 8
$str
íí9 S
)
ííS T
;
ííT U
}
ìì 
if
îî 
(
îî 
usuario
îî 
.
îî 
Password
îî  
==
îî! #
null
îî$ (
||
îî) +
usuario
îî, 3
.
îî3 4
Password
îî4 <
==
îî= ?
$str
îî@ B
)
îîB C

ModelState
ïï 
.
ïï 
AddModelError
ïï (
(
ïï( )
$str
ïï) 3
,
ïï3 4
$str
ïï5 P
)
ïïP Q
;
ïïQ R
if
ññ 
(
ññ 
usuario
ññ 
.
ññ 
Password
ññ  
==
ññ! #
null
ññ$ (
||
ññ) +
usuario
ññ, 3
.
ññ3 4
Password
ññ4 <
==
ññ= ?
$str
ññ@ B
)
ññB C
{
óó 
if
òò 
(
òò 
NuevaPassword
òò !
==
òò" $
null
òò% )
||
òò* ,
NuevaPassword
òò- :
==
òò; =
$str
òò> @
)
òò@ A

ModelState
ôô 
.
ôô 
AddModelError
ôô ,
(
ôô, -
$str
ôô- <
,
ôô< =
$str
ôô> Y
)
ôôY Z
;
ôôZ [
if
öö 
(
öö 
RepitaPassword
öö "
==
öö# %
null
öö& *
||
öö+ -
RepitaPassword
öö. <
==
öö= ?
$str
öö@ B
)
ööB C

ModelState
õõ 
.
õõ 
AddModelError
õõ ,
(
õõ, -
$str
õõ- =
,
õõ= >
$str
õõ? Z
)
õõZ [
;
õõ[ \
}
úú 
}
ùù 	
public
ûû 
void
ûû #
ValidarCambiarContra1
ûû )
(
ûû) *
Usuario
ûû* 1
usuario
ûû2 9
,
ûû9 :
string
ûû; A
NuevaPassword
ûûB O
,
ûûO P
string
ûûQ W
RepitaPassword
ûûX f
)
ûûf g
{
üü 	
var
†† 
usuarioIdDB
†† 
=
†† 
service
†† %
.
††% &$
BuscarIdUsuarioSession
††& <
(
††< =
)
††= >
;
††> ?
if
°° 
(
°° 
usuario
°° 
.
°° 
Password
°°  
!=
°°! #
null
°°$ (
&&
°°) +
usuario
°°, 3
.
°°3 4
Password
°°4 <
!=
°°= ?
$str
°°@ B
&&
°°C E
service
°°F M
.
°°M N
Existe
°°N T
(
°°T U
usuario
°°U \
,
°°\ ]
usuarioIdDB
°°^ i
)
°°i j
!=
°°k m
$num
°°n o
&&
°°p r
usuario
°°s z
.
°°z {
Password°°{ É
!=°°Ñ Ü
NuevaPassword°°á î
)°°î ï
{
¢¢ 
if
££ 
(
££ 
NuevaPassword
££ !
==
££" $
null
££% )
||
££* ,
NuevaPassword
££- :
==
££; =
$str
££> @
)
££@ A

ModelState
§§ 
.
§§ 
AddModelError
§§ ,
(
§§, -
$str
§§- <
,
§§< =
$str
§§> Y
)
§§Y Z
;
§§Z [
if
•• 
(
•• 
RepitaPassword
•• "
==
••# %
null
••& *
||
••+ -
RepitaPassword
••. <
==
••= ?
$str
••@ B
)
••B C

ModelState
¶¶ 
.
¶¶ 
AddModelError
¶¶ ,
(
¶¶, -
$str
¶¶- =
,
¶¶= >
$str
¶¶? Z
)
¶¶Z [
;
¶¶[ \
if
ßß 
(
ßß 
NuevaPassword
ßß !
!=
ßß" $
null
ßß% )
&&
ßß* ,
NuevaPassword
ßß- :
!=
ßß; =
$str
ßß> @
&&
ßßA C
RepitaPassword
ßßD R
!=
ßßS U
null
ßßV Z
&&
ßß[ ]
RepitaPassword
ßß^ l
!=
ßßm o
$str
ßßp r
&&
ßßs u
NuevaPasswordßßv É
!=ßßÑ Ü
RepitaPasswordßßá ï
)ßßï ñ
{
®® 

ModelState
©© 
.
©© 
AddModelError
©© ,
(
©©, -
$str
©©- =
,
©©= >
$str
©©? ]
)
©©] ^
;
©©^ _
}
™™ 
}
´´ 
if
¨¨ 
(
¨¨ 
usuario
¨¨ 
.
¨¨ 
Password
¨¨  
!=
¨¨! #
null
¨¨$ (
&&
¨¨) +
usuario
¨¨, 3
.
¨¨3 4
Password
¨¨4 <
!=
¨¨= ?
$str
¨¨@ B
&&
¨¨C E
service
¨¨F M
.
¨¨M N
Existe
¨¨N T
(
¨¨T U
usuario
¨¨U \
,
¨¨\ ]
usuarioIdDB
¨¨^ i
)
¨¨i j
!=
¨¨k m
$num
¨¨n o
&&
¨¨p r
usuario
¨¨s z
.
¨¨z {
Password¨¨{ É
==¨¨Ñ Ü
NuevaPassword¨¨á î
)¨¨î ï
{
≠≠ 

ModelState
ÆÆ 
.
ÆÆ 
AddModelError
ÆÆ (
(
ÆÆ( )
$str
ÆÆ) 8
,
ÆÆ8 9
$str
ÆÆ: Z
)
ÆÆZ [
;
ÆÆ[ \
}
ØØ 
}
∞∞ 	
public
¥¥ 
void
¥¥ $
validarActualizarDatos
¥¥ *
(
¥¥* +
Usuario
¥¥+ 2
usu
¥¥3 6
)
¥¥6 7
{
µµ 	
if
∂∂ 
(
∂∂ 
usu
∂∂ 
.
∂∂ 
Nombre
∂∂ 
==
∂∂ 
null
∂∂ "
||
∂∂# %
usu
∂∂& )
.
∂∂) *
Nombre
∂∂* 0
==
∂∂1 3
$str
∂∂4 6
)
∂∂6 7

ModelState
∑∑ 
.
∑∑ 
AddModelError
∑∑ (
(
∑∑( )
$str
∑∑) 1
,
∑∑1 2
$str
∑∑3 M
)
∑∑M N
;
∑∑N O
if
∏∏ 
(
∏∏ 
usu
∏∏ 
.
∏∏ 
Nombre
∏∏ 
!=
∏∏ 
null
∏∏ "
&&
∏∏# %
!
∏∏& '
Regex
∏∏' ,
.
∏∏, -
IsMatch
∏∏- 4
(
∏∏4 5
usu
∏∏5 8
.
∏∏8 9
Nombre
∏∏9 ?
,
∏∏? @
$str
∏∏A P
)
∏∏P Q
)
∏∏Q R
{
ππ 

ModelState
∫∫ 
.
∫∫ 
AddModelError
∫∫ ,
(
∫∫, -
$str
∫∫- 5
,
∫∫5 6
$str
∫∫7 [
)
∫∫[ \
;
∫∫\ ]
}
ªª 
if
ΩΩ 
(
ΩΩ 
usu
ΩΩ 
.
ΩΩ 
Apellido
ΩΩ 
==
ΩΩ 
null
ΩΩ  $
||
ΩΩ% '
usu
ΩΩ( +
.
ΩΩ+ ,
Apellido
ΩΩ, 4
==
ΩΩ5 7
$str
ΩΩ8 :
)
ΩΩ: ;

ModelState
ææ 
.
ææ 
AddModelError
ææ (
(
ææ( )
$str
ææ) 3
,
ææ3 4
$str
ææ5 Q
)
ææQ R
;
ææR S
if
øø 
(
øø 
usu
øø 
.
øø 
Apellido
øø 
!=
øø 
null
øø  $
&&
øø% '
!
øø( )
Regex
øø) .
.
øø. /
IsMatch
øø/ 6
(
øø6 7
usu
øø7 :
.
øø: ;
Apellido
øø; C
,
øøC D
$str
øøE T
)
øøT U
)
øøU V
{
¿¿ 

ModelState
¡¡ 
.
¡¡ 
AddModelError
¡¡ ,
(
¡¡, -
$str
¡¡- 7
,
¡¡7 8
$str
¡¡9 _
)
¡¡_ `
;
¡¡` a
}
¬¬ 
if
ƒƒ 
(
ƒƒ 
usu
ƒƒ 
.
ƒƒ 
DNI
ƒƒ 
==
ƒƒ 
null
ƒƒ 
||
ƒƒ  "
usu
ƒƒ# &
.
ƒƒ& '
DNI
ƒƒ' *
==
ƒƒ+ -
$str
ƒƒ. 0
)
ƒƒ0 1

ModelState
≈≈ 
.
≈≈ 
AddModelError
≈≈ (
(
≈≈( )
$str
≈≈) .
,
≈≈. /
$str
≈≈0 G
)
≈≈G H
;
≈≈H I
if
«« 
(
«« 
usu
«« 
.
«« 
DNI
«« 
!=
«« 
null
«« 
&&
««  "
!
««# $
Regex
««$ )
.
««) *
IsMatch
««* 1
(
««1 2
usu
««2 5
.
««5 6
DNI
««6 9
,
««9 :
$str
««; C
)
««C D
)
««D E
{
»» 

ModelState
…… 
.
…… 
AddModelError
…… ,
(
……, -
$str
……- 2
,
……2 3
$str
……4 V
)
……V W
;
……W X
}
   
if
ÃÃ 
(
ÃÃ 
usu
ÃÃ 
.
ÃÃ 
DNI
ÃÃ 
!=
ÃÃ 
null
ÃÃ 
&&
ÃÃ  "
Regex
ÃÃ# (
.
ÃÃ( )
IsMatch
ÃÃ) 0
(
ÃÃ0 1
usu
ÃÃ1 4
.
ÃÃ4 5
DNI
ÃÃ5 8
,
ÃÃ8 9
$str
ÃÃ: B
)
ÃÃB C
&&
ÃÃD F
usu
ÃÃG J
.
ÃÃJ K
DNI
ÃÃK N
.
ÃÃN O
Length
ÃÃO U
!=
ÃÃV X
$num
ÃÃY Z
)
ÃÃZ [
{
ÕÕ 

ModelState
ŒŒ "
.
ŒŒ" #
AddModelError
ŒŒ# 0
(
ŒŒ0 1
$str
ŒŒ1 6
,
ŒŒ6 7
$str
ŒŒ8 ^
)
ŒŒ^ _
;
ŒŒ_ `
}
œœ 
}
–– 	
public
—— 
void
—— %
validarActualizarDatos1
—— +
(
——+ ,
Usuario
——, 3
usuario
——4 ;
)
——; <
{
““ 	
if
”” 
(
”” 
usuario
”” 
.
”” 
DNI
”” 
!=
”” 
null
”” #
&&
””$ &
usuario
””' .
.
””. /
DNI
””/ 2
!=
””3 5
$str
””6 8
&&
””9 ;
Regex
””< A
.
””A B
IsMatch
””B I
(
””I J
usuario
””J Q
.
””Q R
DNI
””R U
,
””U V
$str
””W _
)
””_ `
&&
””a c
usuario
””d k
.
””k l
DNI
””l o
.
””o p
Length
””p v
==
””w y
$num
””z {
)
””{ |
{
‘‘ 
var
’’ 
DNIUsuarioDB
’’  
=
’’! "
Convert
’’# *
.
’’* +
ToString
’’+ 3
(
’’3 4
Session
’’4 ;
[
’’; <
$str
’’< H
]
’’H I
)
’’I J
;
’’J K
var
÷÷ 
UsuDNI
÷÷ 
=
÷÷ 
conexion
÷÷ %
.
÷÷% &
Usuarios
÷÷& .
.
÷÷. /
First
÷÷/ 4
(
÷÷4 5
a
÷÷5 6
=>
÷÷7 9
a
÷÷: ;
.
÷÷; <
DNI
÷÷< ?
==
÷÷@ B
DNIUsuarioDB
÷÷C O
)
÷÷O P
;
÷÷P Q
if
◊◊ 
(
◊◊ 
UsuDNI
◊◊ 
.
◊◊ 
DNI
◊◊ 
!=
◊◊ !
usuario
◊◊" )
.
◊◊) *
DNI
◊◊* -
)
◊◊- .
{
ÿÿ 
var
ŸŸ 
	usuarioDB
ŸŸ !
=
ŸŸ" #
conexion
ŸŸ$ ,
.
ŸŸ, -
Usuarios
ŸŸ- 5
.
ŸŸ5 6
Any
ŸŸ6 9
(
ŸŸ9 :
t
ŸŸ: ;
=>
ŸŸ< >
t
ŸŸ? @
.
ŸŸ@ A
DNI
ŸŸA D
==
ŸŸE G
usuario
ŸŸH O
.
ŸŸO P
DNI
ŸŸP S
)
ŸŸS T
;
ŸŸT U
if
⁄⁄ 
(
⁄⁄ 
	usuarioDB
⁄⁄ !
)
⁄⁄! "
{
€€ 

ModelState
‹‹ "
.
‹‹" #
AddModelError
‹‹# 0
(
‹‹0 1
$str
‹‹1 6
,
‹‹6 7
$str
‹‹8 L
)
‹‹L M
;
‹‹M N
}
›› 
}
ﬁﬁ 
}
ﬂﬂ 
}
‚‚ 	
public
„„ 
void
„„ %
validarActualizarDatos2
„„ +
(
„„+ ,
Usuario
„„, 3
usuario
„„4 ;
)
„„; <
{
‰‰ 	
if
ÂÂ 
(
ÂÂ 
usuario
ÂÂ 
.
ÂÂ 
Celular
ÂÂ 
==
ÂÂ  "
null
ÂÂ# '
||
ÂÂ( *
usuario
ÂÂ+ 2
.
ÂÂ2 3
Celular
ÂÂ3 :
==
ÂÂ; =
$str
ÂÂ> @
)
ÂÂ@ A

ModelState
ÊÊ 
.
ÊÊ 
AddModelError
ÊÊ (
(
ÊÊ( )
$str
ÊÊ) 2
,
ÊÊ2 3
$str
ÊÊ4 O
)
ÊÊO P
;
ÊÊP Q
if
ËË 
(
ËË 
usuario
ËË 
.
ËË 
Celular
ËË 
!=
ËË  "
null
ËË# '
&&
ËË( *
!
ËË+ ,
Regex
ËË, 1
.
ËË1 2
IsMatch
ËË2 9
(
ËË9 :
usuario
ËË: A
.
ËËA B
Celular
ËËB I
,
ËËI J
$str
ËËK S
)
ËËS T
)
ËËT U
{
ÈÈ 

ModelState
ÍÍ 
.
ÍÍ 
AddModelError
ÍÍ (
(
ÍÍ( )
$str
ÍÍ) 2
,
ÍÍ2 3
$str
ÍÍ4 Z
)
ÍÍZ [
;
ÍÍ[ \
}
ÎÎ 
}
ÏÏ 	
public
ÓÓ 
void
ÓÓ 
validar
ÓÓ 
(
ÓÓ 
Usuario
ÓÓ #
usuario
ÓÓ$ +
,
ÓÓ+ ,
string
ÓÓ- 3
RepitaPassword
ÓÓ4 B
)
ÓÓB C
{
ÔÔ 	
Usuario
ÒÒ 
u1
ÒÒ 
=
ÒÒ 
usuario
ÒÒ  
,
ÒÒ  !
u2
ÒÒ! #
=
ÒÒ# $
usuario
ÒÒ$ +
,
ÒÒ+ ,
u3
ÒÒ, .
=
ÒÒ. /
usuario
ÒÒ/ 6
,
ÒÒ6 7
u4
ÒÒ7 9
=
ÒÒ9 :
usuario
ÒÒ: A
,
ÒÒA B
u5
ÒÒB D
=
ÒÒD E
usuario
ÒÒE L
,
ÒÒL M
u6
ÒÒM O
=
ÒÒO P
usuario
ÒÒP W
,
ÒÒW X
u7
ÒÒX Z
=
ÒÒZ [
usuario
ÒÒ[ b
;
ÒÒb c
if
ÚÚ 
(
ÚÚ 
u1
ÚÚ 
.
ÚÚ 
Nombre
ÚÚ 
==
ÚÚ 
null
ÚÚ !
||
ÚÚ" $
u1
ÚÚ% '
.
ÚÚ' (
Nombre
ÚÚ( .
==
ÚÚ/ 1
$str
ÚÚ2 4
)
ÚÚ4 5

ModelState
ÛÛ 
.
ÛÛ 
AddModelError
ÛÛ (
(
ÛÛ( )
$str
ÛÛ) 1
,
ÛÛ1 2
$str
ÛÛ3 M
)
ÛÛM N
;
ÛÛN O
if
ÙÙ 
(
ÙÙ 
u2
ÙÙ 
.
ÙÙ 
Nombre
ÙÙ 
!=
ÙÙ 
null
ÙÙ !
&&
ÙÙ" $
!
ÙÙ% &
Regex
ÙÙ& +
.
ÙÙ+ ,
IsMatch
ÙÙ, 3
(
ÙÙ3 4
u2
ÙÙ4 6
.
ÙÙ6 7
Nombre
ÙÙ7 =
,
ÙÙ= >
$str
ÙÙ? N
)
ÙÙN O
)
ÙÙO P
{
ıı 

ModelState
ˆˆ 
.
ˆˆ 
AddModelError
ˆˆ ,
(
ˆˆ, -
$str
ˆˆ- 5
,
ˆˆ5 6
$str
ˆˆ7 [
)
ˆˆ[ \
;
ˆˆ\ ]
}
˜˜ 
if
˘˘ 
(
˘˘ 
u3
˘˘ 
.
˘˘ 
Apellido
˘˘ 
==
˘˘ 
null
˘˘ #
||
˘˘$ &
u3
˘˘' )
.
˘˘) *
Apellido
˘˘* 2
==
˘˘3 5
$str
˘˘6 8
)
˘˘8 9

ModelState
˙˙ 
.
˙˙ 
AddModelError
˙˙ (
(
˙˙( )
$str
˙˙) 3
,
˙˙3 4
$str
˙˙5 Q
)
˙˙Q R
;
˙˙R S
if
˚˚ 
(
˚˚ 
u4
˚˚ 
.
˚˚ 
Apellido
˚˚ 
!=
˚˚ 
null
˚˚ #
&&
˚˚$ &
!
˚˚' (
Regex
˚˚( -
.
˚˚- .
IsMatch
˚˚. 5
(
˚˚5 6
u4
˚˚6 8
.
˚˚8 9
Apellido
˚˚9 A
,
˚˚A B
$str
˚˚C R
)
˚˚R S
)
˚˚S T
{
¸¸ 

ModelState
˝˝ 
.
˝˝ 
AddModelError
˝˝ ,
(
˝˝, -
$str
˝˝- 7
,
˝˝7 8
$str
˝˝9 _
)
˝˝_ `
;
˝˝` a
}
˛˛ 
if
ÄÄ 
(
ÄÄ 
u5
ÄÄ 
.
ÄÄ 
DNI
ÄÄ 
==
ÄÄ 
null
ÄÄ 
||
ÄÄ !
u5
ÄÄ" $
.
ÄÄ$ %
DNI
ÄÄ% (
==
ÄÄ) +
$str
ÄÄ, .
)
ÄÄ. /

ModelState
ÅÅ 
.
ÅÅ 
AddModelError
ÅÅ (
(
ÅÅ( )
$str
ÅÅ) .
,
ÅÅ. /
$str
ÅÅ0 G
)
ÅÅG H
;
ÅÅH I
if
ÉÉ 
(
ÉÉ 
u6
ÉÉ 
.
ÉÉ 
DNI
ÉÉ 
!=
ÉÉ 
null
ÉÉ 
&&
ÉÉ !
!
ÉÉ" #
Regex
ÉÉ# (
.
ÉÉ( )
IsMatch
ÉÉ) 0
(
ÉÉ0 1
u6
ÉÉ1 3
.
ÉÉ3 4
DNI
ÉÉ4 7
,
ÉÉ7 8
$str
ÉÉ9 A
)
ÉÉA B
)
ÉÉB C
{
ÑÑ 

ModelState
ÖÖ 
.
ÖÖ 
AddModelError
ÖÖ ,
(
ÖÖ, -
$str
ÖÖ- 2
,
ÖÖ2 3
$str
ÖÖ4 V
)
ÖÖV W
;
ÖÖW X
}
ÜÜ 
if
àà 
(
àà 
u7
àà 
.
àà 
DNI
àà 
!=
àà 
null
àà 
&&
àà !
Regex
àà" '
.
àà' (
IsMatch
àà( /
(
àà/ 0
u7
àà0 2
.
àà2 3
DNI
àà3 6
,
àà6 7
$str
àà8 @
)
àà@ A
&&
ààB D
usuario
ààE L
.
ààL M
DNI
ààM P
.
ààP Q
Length
ààQ W
!=
ààX Z
$num
àà[ \
)
àà\ ]
{
ââ 

ModelState
ää "
.
ää" #
AddModelError
ää# 0
(
ää0 1
$str
ää1 6
,
ää6 7
$str
ää8 ^
)
ää^ _
;
ää_ `
}
ãã 
}
çç 	
public
éé 
void
éé 
validar1
éé 
(
éé 
Usuario
éé $
usuario
éé% ,
,
éé, -
string
éé. 4
RepitaPassword
éé5 C
)
ééC D
{
èè 	
if
êê 
(
êê 
usuario
êê 
.
êê 
DNI
êê 
!=
êê 
null
êê #
&&
êê$ &
Regex
êê' ,
.
êê, -
IsMatch
êê- 4
(
êê4 5
usuario
êê5 <
.
êê< =
DNI
êê= @
,
êê@ A
$str
êêB J
)
êêJ K
&&
êêL N
usuario
êêO V
.
êêV W
DNI
êêW Z
.
êêZ [
Length
êê[ a
==
êêb d
$num
êêe f
)
êêf g
{
ëë 
var
íí 
	usuarioDB
íí 
=
íí 
conexion
íí  (
.
íí( )
Usuarios
íí) 1
.
íí1 2
Any
íí2 5
(
íí5 6
t
íí6 7
=>
íí8 :
t
íí; <
.
íí< =
DNI
íí= @
==
ííA C
usuario
ííD K
.
ííK L
DNI
ííL O
)
ííO P
;
ííP Q
if
ìì 
(
ìì 
	usuarioDB
ìì 
)
ìì 
{
îî 

ModelState
ïï 
.
ïï 
AddModelError
ïï ,
(
ïï, -
$str
ïï- 2
,
ïï2 3
$str
ïï4 H
)
ïïH I
;
ïïI J
}
ññ 
}
óó 
Usuario
ôô 
Vu1
ôô 
=
ôô 
usuario
ôô !
,
ôô! "
Vu2
ôô# &
=
ôô' (
usuario
ôô) 0
,
ôô0 1
Vu3
ôô2 5
=
ôô6 7
usuario
ôô8 ?
,
ôô? @
Vu4
ôôA D
=
ôôE F
usuario
ôôG N
,
ôôN O
Vu5
ôôP S
=
ôôT U
usuario
ôôV ]
;
ôô] ^
if
öö 
(
öö 
Vu1
öö 
.
öö 
Celular
öö 
==
öö 
null
öö #
||
öö$ &
Vu1
öö' *
.
öö* +
Celular
öö+ 2
==
öö3 5
$str
öö6 8
)
öö8 9

ModelState
õõ 
.
õõ 
AddModelError
õõ (
(
õõ( )
$str
õõ) 2
,
õõ2 3
$str
õõ4 O
)
õõO P
;
õõP Q
if
ùù 
(
ùù 
Vu2
ùù 
.
ùù 
Celular
ùù 
!=
ùù 
null
ùù #
&&
ùù$ &
!
ùù' (
Regex
ùù( -
.
ùù- .
IsMatch
ùù. 5
(
ùù5 6
Vu2
ùù6 9
.
ùù9 :
Celular
ùù: A
,
ùùA B
$str
ùùC K
)
ùùK L
)
ùùL M
{
ûû 

ModelState
üü 
.
üü 
AddModelError
üü (
(
üü( )
$str
üü) 2
,
üü2 3
$str
üü4 Z
)
üüZ [
;
üü[ \
}
†† 
if
¢¢ 
(
¢¢ 
Vu3
¢¢ 
.
¢¢ 
Celular
¢¢ 
!=
¢¢ 
null
¢¢ #
&&
¢¢$ &
!
¢¢' (
Regex
¢¢( -
.
¢¢- .
IsMatch
¢¢. 5
(
¢¢5 6
Vu3
¢¢6 9
.
¢¢9 :
Celular
¢¢: A
,
¢¢A B
$str
¢¢C K
)
¢¢K L
&&
¢¢M O
usuario
¢¢P W
.
¢¢W X
Celular
¢¢X _
.
¢¢_ `
Length
¢¢` f
!=
¢¢g i
$num
¢¢j k
)
¢¢k l
{
££ 

ModelState
§§ 
.
§§ 
AddModelError
§§ (
(
§§( )
$str
§§) 2
,
§§2 3
$str
§§4 ^
)
§§^ _
;
§§_ `
}
•• 
if
ßß 
(
ßß 
Vu4
ßß 
.
ßß 
Celular
ßß 
!=
ßß 
null
ßß #
&&
ßß$ &
Regex
ßß' ,
.
ßß, -
IsMatch
ßß- 4
(
ßß4 5
Vu4
ßß5 8
.
ßß8 9
Celular
ßß9 @
,
ßß@ A
$str
ßßB J
)
ßßJ K
&&
ßßL N
Vu4
ßßO R
.
ßßR S
Celular
ßßS Z
.
ßßZ [
Length
ßß[ a
==
ßßb d
$num
ßße f
&&
ßßg i
Vu4
ßßj m
.
ßßm n
Celular
ßßn u
.
ßßu v
	Substring
ßßv 
(ßß Ä
$numßßÄ Å
,ßßÅ Ç
$numßßÉ Ñ
)ßßÑ Ö
!=ßßÜ à
$strßßâ å
)ßßå ç
{
®® 

ModelState
©© 
.
©© 
AddModelError
©© (
(
©©( )
$str
©©) 2
,
©©2 3
$str
©©4 \
)
©©\ ]
;
©©] ^
}
™™ 
if
¨¨ 
(
¨¨ 
Vu5
¨¨ 
.
¨¨ 
Correo
¨¨ 
==
¨¨ 
null
¨¨ "
||
¨¨# %
Vu5
¨¨& )
.
¨¨) *
Correo
¨¨* 0
==
¨¨1 3
$str
¨¨4 6
)
¨¨6 7

ModelState
≠≠ 
.
≠≠ 
AddModelError
≠≠ (
(
≠≠( )
$str
≠≠) 1
,
≠≠1 2
$str
≠≠3 M
)
≠≠M N
;
≠≠N O
}
∞∞ 	
public
±± 
void
±± 
validar2
±± 
(
±± 
Usuario
±± $
usuario
±±% ,
,
±±, -
string
±±. 4
RepitaPassword
±±5 C
)
±±C D
{
≤≤ 	
Usuario
≥≥ 
V2usu1
≥≥ 
=
≥≥ 
usuario
≥≥ $
,
≥≥$ %
V2usu2
≥≥& ,
=
≥≥- .
usuario
≥≥/ 6
;
≥≥6 7
if
¥¥ 
(
¥¥ 
V2usu1
¥¥ 
.
¥¥ 
Correo
¥¥ 
!=
¥¥  
null
¥¥! %
&&
¥¥& (
!
¥¥) *
Regex
¥¥* /
.
¥¥/ 0
IsMatch
¥¥0 7
(
¥¥7 8
V2usu1
¥¥8 >
.
¥¥> ?
Correo
¥¥? E
,
¥¥E F
$str¥¥G ◊
)¥¥◊ ÿ
)¥¥ÿ Ÿ
{
µµ 

ModelState
∂∂ 
.
∂∂ 
AddModelError
∂∂ (
(
∂∂( )
$str
∂∂) 1
,
∂∂1 2
$str
∂∂3 R
)
∂∂R S
;
∂∂S T
}
∑∑ 
if
ππ 
(
ππ 
V2usu2
ππ 
.
ππ 
Correo
ππ 
!=
ππ  
null
ππ! %
&&
ππ& (
Regex
ππ) .
.
ππ. /
IsMatch
ππ/ 6
(
ππ6 7
V2usu2
ππ7 =
.
ππ= >
Correo
ππ> D
,
ππD E
$strππF ÷
)ππ÷ ◊
)ππ◊ ÿ
{
∫∫ 
var
ªª 
usuarioCorreoD
ªª "
=
ªª# $
conexion
ªª% -
.
ªª- .
Usuarios
ªª. 6
.
ªª6 7
Any
ªª7 :
(
ªª: ;
t
ªª; <
=>
ªª= ?
t
ªª@ A
.
ªªA B
Correo
ªªB H
==
ªªI K
usuario
ªªL S
.
ªªS T
Correo
ªªT Z
)
ªªZ [
;
ªª[ \
if
ºº 
(
ºº 
usuarioCorreoD
ºº "
)
ºº" #
{
ΩΩ 

ModelState
ææ 
.
ææ 
AddModelError
ææ ,
(
ææ, -
$str
ææ- 5
,
ææ5 6
$str
ææ7 N
)
ææN O
;
ææO P
}
øø 
}
¿¿ 
}
¬¬ 	
public
√√ 
void
√√ 
validar3
√√ 
(
√√ 
Usuario
√√ $
usuario
√√% ,
,
√√, -
string
√√. 4

RepitaPass
√√5 ?
)
√√? @
{
ƒƒ 	
Usuario
≈≈ 
V3usu1
≈≈ 
=
≈≈ 
usuario
≈≈ $
,
≈≈$ %
V3usu2
≈≈& ,
=
≈≈- .
usuario
≈≈/ 6
,
≈≈6 7
V3usu3
≈≈8 >
=
≈≈? @
usuario
≈≈A H
;
≈≈H I
if
∆∆ 
(
∆∆ 
V3usu1
∆∆ 
.
∆∆ 
	Direccion
∆∆  
==
∆∆! #
null
∆∆$ (
||
∆∆) +
V3usu1
∆∆, 2
.
∆∆2 3
	Direccion
∆∆3 <
==
∆∆= ?
$str
∆∆@ B
)
∆∆B C

ModelState
«« 
.
«« 
AddModelError
«« (
(
««( )
$str
««) 4
,
««4 5
$str
««6 S
)
««S T
;
««T U
if
…… 
(
…… 
V3usu2
…… 
.
…… 
Password
…… 
==
……  "
null
……# '
||
……( *
V3usu2
……+ 1
.
……1 2
Password
……2 :
==
……; =
$str
……> @
)
……@ A

ModelState
   
.
   
AddModelError
   (
(
  ( )
$str
  ) 3
,
  3 4
$str
  5 P
)
  P Q
;
  Q R
if
ÃÃ 
(
ÃÃ 

RepitaPass
ÃÃ 
==
ÃÃ 
null
ÃÃ "
||
ÃÃ# %

RepitaPass
ÃÃ& 0
==
ÃÃ1 3
$str
ÃÃ4 6
)
ÃÃ6 7

ModelState
ÕÕ 
.
ÕÕ 
AddModelError
ÕÕ (
(
ÕÕ( )
$str
ÕÕ) 9
,
ÕÕ9 :
$str
ÕÕ; V
)
ÕÕV W
;
ÕÕW X
if
œœ 
(
œœ 
V3usu3
œœ 
.
œœ 
Password
œœ 
!=
œœ  "
null
œœ# '
&&
œœ( *

RepitaPass
œœ+ 5
!=
œœ6 8
null
œœ9 =
&&
œœ> @
V3usu3
œœA G
.
œœG H
Password
œœH P
!=
œœQ S

RepitaPass
œœT ^
)
œœ^ _
{
–– 

ModelState
—— 
.
—— 
AddModelError
—— (
(
——( )
$str
——) 9
,
——9 :
$str
——; W
)
——W X
;
——X Y
}
““ 
}
”” 	
public
‘‘ 
void
‘‘ "
validarEditarUsuario
‘‘ (
(
‘‘( )
Usuario
‘‘) 0
usuario
‘‘1 8
,
‘‘8 9
int
‘‘: =
?
‘‘= >
id
‘‘? A
)
‘‘A B
{
’’ 	
if
◊◊ 
(
◊◊ 
usuario
◊◊ 
.
◊◊ 
Nombre
◊◊ 
==
◊◊ !
null
◊◊" &
||
◊◊' )
usuario
◊◊* 1
.
◊◊1 2
Nombre
◊◊2 8
==
◊◊9 ;
$str
◊◊< >
)
◊◊> ?

ModelState
ÿÿ 
.
ÿÿ 
AddModelError
ÿÿ (
(
ÿÿ( )
$str
ÿÿ) 1
,
ÿÿ1 2
$str
ÿÿ3 S
)
ÿÿS T
;
ÿÿT U
if
ŸŸ 
(
ŸŸ 
usuario
ŸŸ 
.
ŸŸ 
Nombre
ŸŸ 
!=
ŸŸ !
null
ŸŸ" &
&&
ŸŸ' )
!
ŸŸ* +
Regex
ŸŸ+ 0
.
ŸŸ0 1
IsMatch
ŸŸ1 8
(
ŸŸ8 9
usuario
ŸŸ9 @
.
ŸŸ@ A
Nombre
ŸŸA G
,
ŸŸG H
$str
ŸŸI X
)
ŸŸX Y
)
ŸŸY Z
{
⁄⁄ 

ModelState
€€ 
.
€€ 
AddModelError
€€ ,
(
€€, -
$str
€€- 5
,
€€5 6
$str
€€7 [
)
€€[ \
;
€€\ ]
}
‹‹ 
if
ﬁﬁ 
(
ﬁﬁ 
usuario
ﬁﬁ 
.
ﬁﬁ 
Apellido
ﬁﬁ  
==
ﬁﬁ! #
null
ﬁﬁ$ (
||
ﬁﬁ) +
usuario
ﬁﬁ, 3
.
ﬁﬁ3 4
Apellido
ﬁﬁ4 <
==
ﬁﬁ= ?
$str
ﬁﬁ@ B
)
ﬁﬁB C

ModelState
ﬂﬂ 
.
ﬂﬂ 
AddModelError
ﬂﬂ (
(
ﬂﬂ( )
$str
ﬂﬂ) 3
,
ﬂﬂ3 4
$str
ﬂﬂ5 Q
)
ﬂﬂQ R
;
ﬂﬂR S
if
‡‡ 
(
‡‡ 
usuario
‡‡ 
.
‡‡ 
Apellido
‡‡  
!=
‡‡! #
null
‡‡$ (
&&
‡‡) +
!
‡‡, -
Regex
‡‡- 2
.
‡‡2 3
IsMatch
‡‡3 :
(
‡‡: ;
usuario
‡‡; B
.
‡‡B C
Apellido
‡‡C K
,
‡‡K L
$str
‡‡M \
)
‡‡\ ]
)
‡‡] ^
{
·· 

ModelState
‚‚ 
.
‚‚ 
AddModelError
‚‚ ,
(
‚‚, -
$str
‚‚- 7
,
‚‚7 8
$str
‚‚9 _
)
‚‚_ `
;
‚‚` a
}
„„ 
if
ÂÂ 
(
ÂÂ 
usuario
ÂÂ 
.
ÂÂ 
DNI
ÂÂ 
==
ÂÂ 
null
ÂÂ #
||
ÂÂ$ &
usuario
ÂÂ' .
.
ÂÂ. /
DNI
ÂÂ/ 2
==
ÂÂ3 5
$str
ÂÂ6 8
)
ÂÂ8 9

ModelState
ÊÊ 
.
ÊÊ 
AddModelError
ÊÊ (
(
ÊÊ( )
$str
ÊÊ) .
,
ÊÊ. /
$str
ÊÊ0 G
)
ÊÊG H
;
ÊÊH I
if
ËË 
(
ËË 
usuario
ËË 
.
ËË 
DNI
ËË 
!=
ËË 
null
ËË #
&&
ËË$ &
!
ËË' (
Regex
ËË( -
.
ËË- .
IsMatch
ËË. 5
(
ËË5 6
usuario
ËË6 =
.
ËË= >
DNI
ËË> A
,
ËËA B
$str
ËËC K
)
ËËK L
)
ËËL M
{
ÈÈ 

ModelState
ÍÍ 
.
ÍÍ 
AddModelError
ÍÍ ,
(
ÍÍ, -
$str
ÍÍ- 2
,
ÍÍ2 3
$str
ÍÍ4 V
)
ÍÍV W
;
ÍÍW X
}
ÎÎ 
if
ÌÌ 
(
ÌÌ 
usuario
ÌÌ 
.
ÌÌ 
DNI
ÌÌ 
!=
ÌÌ 
null
ÌÌ #
&&
ÌÌ$ &
Regex
ÌÌ' ,
.
ÌÌ, -
IsMatch
ÌÌ- 4
(
ÌÌ4 5
usuario
ÌÌ5 <
.
ÌÌ< =
DNI
ÌÌ= @
,
ÌÌ@ A
$str
ÌÌB J
)
ÌÌJ K
&&
ÌÌL N
usuario
ÌÌO V
.
ÌÌV W
DNI
ÌÌW Z
.
ÌÌZ [
Length
ÌÌ[ a
!=
ÌÌb d
$num
ÌÌe f
)
ÌÌf g
{
ÓÓ 

ModelState
ÔÔ "
.
ÔÔ" #
AddModelError
ÔÔ# 0
(
ÔÔ0 1
$str
ÔÔ1 6
,
ÔÔ6 7
$str
ÔÔ8 ^
)
ÔÔ^ _
;
ÔÔ_ `
}
 
}
ÚÚ 	
public
ÙÙ 
void
ÙÙ #
validarEditarUsuario1
ÙÙ )
(
ÙÙ) *
Usuario
ÙÙ* 1
usuario
ÙÙ2 9
,
ÙÙ9 :
int
ÙÙ; >
?
ÙÙ> ?
id
ÙÙ@ B
)
ÙÙB C
{
ıı 	
Usuario
ˆˆ 
VEu1
ˆˆ 
=
ˆˆ 
usuario
ˆˆ "
,
ˆˆ" #
VEu2
ˆˆ$ (
=
ˆˆ) *
usuario
ˆˆ+ 2
,
ˆˆ2 3
VEu3
ˆˆ4 8
=
ˆˆ9 :
usuario
ˆˆ; B
,
ˆˆB C
VEu4
ˆˆD H
=
ˆˆI J
usuario
ˆˆK R
,
ˆˆR S
VEu5
ˆˆT X
=
ˆˆY Z
usuario
ˆˆ[ b
,
ˆˆb c
VEu6
ˆˆd h
=
ˆˆh i
usuario
ˆˆi p
,
ˆˆp q
VEu7
ˆˆq u
=
ˆˆu v
usuario
ˆˆv }
;
ˆˆ} ~
if
˜˜ 
(
˜˜ 
VEu1
˜˜ 
.
˜˜ 
Celular
˜˜ 
==
˜˜ 
null
˜˜  $
||
˜˜% '
VEu1
˜˜( ,
.
˜˜, -
Celular
˜˜- 4
==
˜˜5 7
$str
˜˜8 :
)
˜˜: ;

ModelState
¯¯ 
.
¯¯ 
AddModelError
¯¯ (
(
¯¯( )
$str
¯¯) 2
,
¯¯2 3
$str
¯¯4 O
)
¯¯O P
;
¯¯P Q
if
˙˙ 
(
˙˙ 
VEu2
˙˙ 
.
˙˙ 
Celular
˙˙ 
!=
˙˙ 
null
˙˙  $
&&
˙˙% '
!
˙˙( )
Regex
˙˙) .
.
˙˙. /
IsMatch
˙˙/ 6
(
˙˙6 7
VEu2
˙˙7 ;
.
˙˙; <
Celular
˙˙< C
,
˙˙C D
$str
˙˙E M
)
˙˙M N
)
˙˙N O
{
˚˚ 

ModelState
¸¸ 
.
¸¸ 
AddModelError
¸¸ (
(
¸¸( )
$str
¸¸) 2
,
¸¸2 3
$str
¸¸4 Z
)
¸¸Z [
;
¸¸[ \
}
˝˝ 
if
ˇˇ 
(
ˇˇ 
VEu3
ˇˇ 
.
ˇˇ 
Celular
ˇˇ 
!=
ˇˇ 
null
ˇˇ  $
&&
ˇˇ% '
!
ˇˇ( )
Regex
ˇˇ) .
.
ˇˇ. /
IsMatch
ˇˇ/ 6
(
ˇˇ6 7
VEu3
ˇˇ7 ;
.
ˇˇ; <
Celular
ˇˇ< C
,
ˇˇC D
$str
ˇˇE M
)
ˇˇM N
&&
ˇˇO Q
usuario
ˇˇR Y
.
ˇˇY Z
Celular
ˇˇZ a
.
ˇˇa b
Length
ˇˇb h
!=
ˇˇi k
$num
ˇˇl m
)
ˇˇm n
{
ÄÄ 

ModelState
ÅÅ 
.
ÅÅ 
AddModelError
ÅÅ (
(
ÅÅ( )
$str
ÅÅ) 2
,
ÅÅ2 3
$str
ÅÅ4 ^
)
ÅÅ^ _
;
ÅÅ_ `
}
ÇÇ 
if
ÑÑ 
(
ÑÑ 
VEu4
ÑÑ 
.
ÑÑ 
Celular
ÑÑ 
!=
ÑÑ 
null
ÑÑ  $
&&
ÑÑ% '
Regex
ÑÑ( -
.
ÑÑ- .
IsMatch
ÑÑ. 5
(
ÑÑ5 6
VEu4
ÑÑ6 :
.
ÑÑ: ;
Celular
ÑÑ; B
,
ÑÑB C
$str
ÑÑD L
)
ÑÑL M
&&
ÑÑN P
VEu4
ÑÑQ U
.
ÑÑU V
Celular
ÑÑV ]
.
ÑÑ] ^
Length
ÑÑ^ d
==
ÑÑe g
$num
ÑÑh i
&&
ÑÑj l
VEu4
ÑÑm q
.
ÑÑq r
Celular
ÑÑr y
.
ÑÑy z
	SubstringÑÑz É
(ÑÑÉ Ñ
$numÑÑÑ Ö
,ÑÑÖ Ü
$numÑÑá à
)ÑÑà â
!=ÑÑä å
$strÑÑç ê
)ÑÑê ë
{
ÖÖ 

ModelState
ÜÜ 
.
ÜÜ 
AddModelError
ÜÜ (
(
ÜÜ( )
$str
ÜÜ) 2
,
ÜÜ2 3
$str
ÜÜ4 \
)
ÜÜ\ ]
;
ÜÜ] ^
}
áá 
if
ââ 
(
ââ 
VEu5
ââ 
.
ââ 
Correo
ââ 
==
ââ 
null
ââ #
||
ââ$ &
VEu5
ââ' +
.
ââ+ ,
Correo
ââ, 2
==
ââ3 5
$str
ââ6 8
)
ââ8 9

ModelState
ää 
.
ää 
AddModelError
ää (
(
ää( )
$str
ää) 1
,
ää1 2
$str
ää3 M
)
ääM N
;
ääN O
if
åå 
(
åå 
VEu6
åå 
.
åå 
Correo
åå 
!=
åå 
null
åå #
&&
åå$ &
!
åå' (
Regex
åå( -
.
åå- .
IsMatch
åå. 5
(
åå5 6
VEu6
åå6 :
.
åå: ;
Correo
åå; A
,
ååA B
$strååC ”
)åå” ‘
)åå‘ ’
{
çç 

ModelState
éé 
.
éé 
AddModelError
éé (
(
éé( )
$str
éé) 1
,
éé1 2
$str
éé3 R
)
ééR S
;
ééS T
}
èè 
if
íí 
(
íí 
VEu7
íí 
.
íí 
	Direccion
íí 
==
íí !
null
íí" &
||
íí' )
VEu7
íí* .
.
íí. /
	Direccion
íí/ 8
==
íí9 ;
$str
íí< >
)
íí> ?

ModelState
ìì 
.
ìì 
AddModelError
ìì (
(
ìì( )
$str
ìì) 4
,
ìì4 5
$str
ìì6 S
)
ììS T
;
ììT U
}
ññ 	
public
óó 
void
óó #
validarEditarUsuario2
óó )
(
óó) *
Usuario
óó* 1
usuario
óó2 9
,
óó9 :
int
óó; >
?
óó> ?
id
óó@ B
)
óóB C
{
òò 	
if
öö 
(
öö 
usuario
öö 
.
öö 
Password
öö  
==
öö! #
null
öö$ (
||
öö) +
usuario
öö, 3
.
öö3 4
Password
öö4 <
==
öö= ?
$str
öö@ B
)
ööB C

ModelState
õõ 
.
õõ 
AddModelError
õõ (
(
õõ( )
$str
õõ) 3
,
õõ3 4
$str
õõ5 P
)
õõP Q
;
õõQ R
if
ùù 
(
ùù 
usuario
ùù 
.
ùù 
DNI
ùù 
!=
ùù 
null
ùù #
&&
ùù$ &
usuario
ùù' .
.
ùù. /
DNI
ùù/ 2
!=
ùù3 5
$str
ùù6 8
&&
ùù9 ;
Regex
ùù< A
.
ùùA B
IsMatch
ùùB I
(
ùùI J
usuario
ùùJ Q
.
ùùQ R
DNI
ùùR U
,
ùùU V
$str
ùùW _
)
ùù_ `
&&
ùùa c
usuario
ùùd k
.
ùùk l
DNI
ùùl o
.
ùùo p
Length
ùùp v
==
ùùw y
$num
ùùz {
)
ùù{ |
{
ûû 
var
üü 
IdUsuarioDB
üü 
=
üü  !
conexion
üü" *
.
üü* +
Usuarios
üü+ 3
.
üü3 4
First
üü4 9
(
üü9 :
a
üü: ;
=>
üü< >
a
üü? @
.
üü@ A
	IdUsuario
üüA J
==
üüK M
id
üüN P
)
üüP Q
;
üüQ R
var
†† 
UsuDNI
†† 
=
†† 
conexion
†† %
.
††% &
Usuarios
††& .
.
††. /
First
††/ 4
(
††4 5
a
††5 6
=>
††7 9
a
††: ;
.
††; <
DNI
††< ?
==
††@ B
IdUsuarioDB
††C N
.
††N O
DNI
††O R
)
††R S
;
††S T
if
°° 
(
°° 
UsuDNI
°° 
.
°° 
DNI
°° 
!=
°° !
usuario
°°" )
.
°°) *
DNI
°°* -
)
°°- .
{
¢¢ 
var
££ 
	usuarioDB
££ !
=
££" #
conexion
££$ ,
.
££, -
Usuarios
££- 5
.
££5 6
Any
££6 9
(
££9 :
t
££: ;
=>
££< >
t
££? @
.
££@ A
DNI
££A D
==
££E G
usuario
££H O
.
££O P
DNI
££P S
)
££S T
;
££T U
if
§§ 
(
§§ 
	usuarioDB
§§ !
)
§§! "
{
•• 

ModelState
¶¶ "
.
¶¶" #
AddModelError
¶¶# 0
(
¶¶0 1
$str
¶¶1 6
,
¶¶6 7
$str
¶¶8 L
)
¶¶L M
;
¶¶M N
}
ßß 
}
®® 
}
©© 
}
´´ 	
public
¨¨ 
void
¨¨ #
validarEditarUsuario3
¨¨ )
(
¨¨) *
Usuario
¨¨* 1
usuario
¨¨2 9
,
¨¨9 :
int
¨¨; >
?
¨¨> ?
id
¨¨@ B
)
¨¨B C
{
≠≠ 	
if
ÆÆ 
(
ÆÆ 
usuario
ÆÆ 
.
ÆÆ 
Correo
ÆÆ 
!=
ÆÆ !
null
ÆÆ" &
&&
ÆÆ' )
Regex
ÆÆ* /
.
ÆÆ/ 0
IsMatch
ÆÆ0 7
(
ÆÆ7 8
usuario
ÆÆ8 ?
.
ÆÆ? @
Correo
ÆÆ@ F
,
ÆÆF G
$strÆÆH ÿ
)ÆÆÿ Ÿ
)ÆÆŸ ⁄
{
ØØ 
var
±± 

UsuarioDBC
±± 
=
±±  
conexion
±±! )
.
±±) *
Usuarios
±±* 2
.
±±2 3
Where
±±3 8
(
±±8 9
a
±±9 :
=>
±±; =
a
±±> ?
.
±±? @
	IdUsuario
±±@ I
==
±±J L
id
±±M O
)
±±O P
.
±±P Q
First
±±Q V
(
±±V W
)
±±W X
;
±±X Y
var
≤≤ 
	UsuCorreo
≤≤ 
=
≤≤ 
conexion
≤≤  (
.
≤≤( )
Usuarios
≤≤) 1
.
≤≤1 2
First
≤≤2 7
(
≤≤7 8
a
≤≤8 9
=>
≤≤: <
a
≤≤= >
.
≤≤> ?
Correo
≤≤? E
==
≤≤F H

UsuarioDBC
≤≤I S
.
≤≤S T
Correo
≤≤T Z
)
≤≤Z [
;
≤≤[ \
if
≥≥ 
(
≥≥ 
	UsuCorreo
≥≥ 
.
≥≥ 
Correo
≥≥ $
!=
≥≥% '
usuario
≥≥( /
.
≥≥/ 0
Correo
≥≥0 6
)
≥≥6 7
{
¥¥ 
var
µµ 
	usuarioDB
µµ !
=
µµ" #
conexion
µµ$ ,
.
µµ, -
Usuarios
µµ- 5
.
µµ5 6
Any
µµ6 9
(
µµ9 :
t
µµ: ;
=>
µµ< >
t
µµ? @
.
µµ@ A
Correo
µµA G
==
µµH J
usuario
µµK R
.
µµR S
Correo
µµS Y
)
µµY Z
;
µµZ [
if
∂∂ 
(
∂∂ 
	usuarioDB
∂∂ !
)
∂∂! "
{
∑∑ 

ModelState
∏∏ "
.
∏∏" #
AddModelError
∏∏# 0
(
∏∏0 1
$str
∏∏1 9
,
∏∏9 :
$str
∏∏; R
)
∏∏R S
;
∏∏S T
}
ππ 
}
∫∫ 
}
ªª 
}
ºº 	
}
ΩΩ 
}ææ Ú
pC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\DB\AppConexionDB.cs
	namespace		 	
PROYECTO_INCABATHS		
 
.		 
DB		 
{

 
public 

class 
AppConexionDB 
: 
	DbContext  )
{ 
public 
IDbSet 
< 
Usuario 
> 
Usuarios '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
public 
IDbSet 
< 
TipoUsuario !
>! "
TipoUsuarios# /
{0 1
get2 5
;5 6
set7 :
;: ;
}< =
public 
IDbSet 
< 
Reserva 
> 
Reservas '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
public 
IDbSet 
< 
DetalleReserva $
>$ %
DetalleReservas& 5
{6 7
get8 ;
;; <
set= @
;@ A
}B C
public 
IDbSet 
< 
Turno 
> 
Turnos #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
IDbSet 
< 
Servicio 
> 
	Servicios  )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
public 
IDbSet 
< 
ModoPago 
> 
	ModoPagos  )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
	protected 
override 
void 
OnModelCreating  /
(/ 0
DbModelBuilder0 >
modelBuilder? K
)K L
{ 	
base 
. 
OnModelCreating  
(  !
modelBuilder! -
)- .
;. /
modelBuilder 
. 
Configurations '
.' (
Add( +
(+ ,
new, /

UsuarioMap0 :
(: ;
); <
)< =
;= >
modelBuilder 
. 
Configurations '
.' (
Add( +
(+ ,
new, /
TipoUsuarioMap0 >
(> ?
)? @
)@ A
;A B
modelBuilder 
. 
Configurations '
.' (
Add( +
(+ ,
new, /

ReservaMap0 :
(: ;
); <
)< =
;= >
modelBuilder 
. 
Configurations '
.' (
Add( +
(+ ,
new, /
DetalleReservaMap0 A
(A B
)B C
)C D
;D E
modelBuilder 
. 
Configurations '
.' (
Add( +
(+ ,
new, /
TurnoMap0 8
(8 9
)9 :
): ;
;; <
modelBuilder 
. 
Configurations '
.' (
Add( +
(+ ,
new, /
ServicioMap0 ;
(; <
)< =
)= >
;> ?
modelBuilder 
. 
Configurations '
.' (
Add( +
(+ ,
new, /
ModoPagoMap0 ;
(; <
)< =
)= >
;> ?
} 	
}   
}!! ≠
yC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\DB\Maps\DetalleReservaMap.cs
	namespace 	
PROYECTO_INCABATHS
 
. 
DB 
.  
Maps  $
{		 
public

 

class

 
DetalleReservaMap

 "
:

# $#
EntityTypeConfiguration

% <
<

< =
DetalleReserva

= K
>

K L
{ 
public 
DetalleReservaMap  
(  !
)! "
{ 	
ToTable 
( 
$str $
)$ %
;% &
HasKey 
( 
o 
=> 
o 
. 
IdDetalleReserva *
)* +
;+ ,
HasRequired 
( 
o 
=> 
o 
. 
Reserva &
)& '
. 
WithMany 
( 
o 
=> 
o 
. 
DetalleReservas ,
), -
. 
HasForeignKey 
( 
o 
=> 
o  !
.! "
	IdReserva" +
)+ ,
;, -
HasRequired 
( 
o 
=> 
o 
. 
Servicio '
)' (
. 
WithMany 
( 
o 
=> 
o 
. 
DetallesReservas ,
), -
. 
HasForeignKey 
( 
o 
=> 
o  
.  !

IdServicio! +
)+ ,
;, -
HasRequired 
( 
o 
=> 
o 
. 
Turno $
)$ %
. 
WithMany 
( 
o 
=> 
o 
. 
DetalleReservas +
)+ ,
. 
HasForeignKey 
( 
o 
=> 
o  
.  !
IdTurno! (
)( )
;) *
} 	
} 
} ù
sC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\DB\Maps\ModoPagoMap.cs
	namespace 	
PROYECTO_INCABATHS
 
. 
DB 
.  
Maps  $
{		 
public

 

class

 
ModoPagoMap

 
:

 #
EntityTypeConfiguration

 6
<

6 7
ModoPago

7 ?
>

? @
{ 
public 
ModoPagoMap 
( 
) 
{ 	
ToTable 
( 
$str 
) 
;  
HasKey 
( 
o 
=> 
o 
. 

IdModoPago $
)$ %
;% &
} 	
} 
} ‚	
rC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\DB\Maps\ReservaMap.cs
	namespace 	
PROYECTO_INCABATHS
 
. 
DB 
.  
Maps  $
{		 
public

 

class

 

ReservaMap

 
:

 #
EntityTypeConfiguration

 5
<

5 6
Reserva

6 =
>

= >
{ 
public 

ReservaMap 
( 
) 
{ 	
ToTable 
( 
$str 
) 
; 
HasKey 
( 
o 
=> 
o 
. 
	IdReserva #
)# $
;$ %
HasRequired 
( 
o 
=> 
o 
. 
Usuario &
)& '
. 
WithMany 
( 
o 
=> 
o 
. 
Reservas %
)% &
. 
HasForeignKey 
( 
o 
=> 
o  !
.! "
	IdUsuario" +
)+ ,
;, -
} 	
} 
} ù
sC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\DB\Maps\ServicioMap.cs
	namespace 	
PROYECTO_INCABATHS
 
. 
DB 
.  
Maps  $
{		 
public

 

class

 
ServicioMap

 
:

 #
EntityTypeConfiguration

 6
<

6 7
Servicio

7 ?
>

? @
{ 
public 
ServicioMap 
( 
) 
{ 	
ToTable 
( 
$str 
) 
;  
HasKey 
( 
o 
=> 
o 
. 

IdServicio $
)$ %
;% &
} 	
} 
} ¨
vC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\DB\Maps\TipoUsuarioMap.cs
	namespace 	
PROYECTO_INCABATHS
 
. 
DB 
.  
Maps  $
{		 
public

 

class

 
TipoUsuarioMap

 
:

  !#
EntityTypeConfiguration

" 9
<

9 :
TipoUsuario

: E
>

E F
{ 
public 
TipoUsuarioMap 
( 
) 
{ 	
ToTable 
( 
$str !
)! "
;" #
HasKey 
( 
o 
=> 
o 
. 
IdTipoUsuario '
)' (
;( )
} 	
} 
} ÿ	
pC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\DB\Maps\TurnoMap.cs
	namespace 	
PROYECTO_INCABATHS
 
. 
DB 
.  
Maps  $
{		 
public

 

class

 
TurnoMap

 
:

 #
EntityTypeConfiguration

 3
<

3 4
Turno

4 9
>

9 :
{ 
public 
TurnoMap 
( 
) 
{ 	
ToTable 
( 
$str 
) 
; 
HasKey 
( 
o 
=> 
o 
. 
IdTurno !
)! "
;" #
HasRequired 
( 
o 
=> 
o 
. 
Servicio '
)' (
. 
WithMany 
( 
o 
=> 
o 
. 
Turnos #
)# $
. 
HasForeignKey 
( 
o 
=> 
o  !
.! "

IdServicio" ,
), -
;- .
} 	
} 
} Í	
rC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\DB\Maps\UsuarioMap.cs
	namespace 	
PROYECTO_INCABATHS
 
. 
DB 
.  
Maps  $
{		 
public

 

class

 

UsuarioMap

 
:

 #
EntityTypeConfiguration

 5
<

5 6
Usuario

6 =
>

= >
{ 
public 

UsuarioMap 
( 
) 
{ 	
ToTable 
( 
$str 
) 
; 
HasKey 
( 
o 
=> 
o 
. 
	IdUsuario #
)# $
;$ %
HasRequired 
( 
o 
=> 
o 
. 
TipoUsuario *
)* +
. 
WithMany 
( 
o 
=> 
o  
.  !
Usuarios! )
)) *
. 
HasForeignKey 
( 
o  
=>! #
o$ %
.% &
IdTipoUsuario& 3
)3 4
;4 5
} 	
} 
} ú	
kC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Global.asax.cs
	namespace		 	
PROYECTO_INCABATHS		
 
{

 
public 

class 
MvcApplication 
:  !
System" (
.( )
Web) ,
., -
HttpApplication- <
{ 
	protected 
void 
Application_Start (
(( )
)) *
{ 	
AreaRegistration 
. 
RegisterAllAreas -
(- .
). /
;/ 0
FilterConfig 
. !
RegisterGlobalFilters .
(. /
GlobalFilters/ <
.< =
Filters= D
)D E
;E F
RouteConfig 
. 
RegisterRoutes &
(& '

RouteTable' 1
.1 2
Routes2 8
)8 9
;9 :
BundleConfig 
. 
RegisterBundles (
(( )
BundleTable) 4
.4 5
Bundles5 <
)< =
;= >
} 	
} 
} ¿	
xC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Interfaces\IAdminService.cs
	namespace 	
PROYECTO_INCABATHS
 
. 

Interfaces '
{		 
public

 

	interface

 
IAdminService

 "
{ 
List 
< 
Usuario 
>  
ObtenerListaUsuarios *
(* +
)+ ,
;, -
List 
< 
Reserva 
> 
ObtenerListReservas )
() *
)* +
;+ ,
List 
< 
TipoUsuario 
> $
ObtenerListaTipoUsuarios 2
(2 3
)3 4
;4 5
List 
< 
Servicio 
> !
ObtenerListaServicios ,
(, -
)- .
;. /
List 
< 
Turno 
> 
ObtenerListaTurnos &
(& '
)' (
;( )
void 
CrearUsuario 
( 
Usuario !
usuario" )
)) *
;* +
} 
} ¬
wC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Interfaces\IAuthService.cs
	namespace 	
PROYECTO_INCABATHS
 
. 

Interfaces '
{		 
public

 

	interface

 
IAuthService

 !
{ 
List 
< 
Usuario 
>  
ObtenerListaUsuarios *
(* +
)+ ,
;, -
void 
GuardarCookie 
( 
string !
Correo" (
)( )
;) *
void 
CerrarSession 
( 
) 
; 
} 
} ö
zC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Interfaces\IReservaService.cs
	namespace 	
PROYECTO_INCABATHS
 
. 

Interfaces '
{		 
public

 

	interface

 
IReservaService

 $
{ 
List 
< 
Reserva 
>  
ObtenerListaReservas *
(* +
)+ ,
;, -
List 
< 
Usuario 
>  
ObtenerListaUsuarios *
(* +
)+ ,
;, -
List 
< 
Servicio 
> !
ObtenerListaServicios ,
(, -
)- .
;. /
void 
CrearReserva 
( 
int 
	idUsuario '
,' (
Reserva) 0
reserva1 8
)8 9
;9 :
List 
< 
DetalleReserva 
> !
ObtenerDetalleReserva 2
(2 3
)3 4
;4 5
List 
< 
Turno 
> 
ObtenerListaTurnos &
(& '
)' (
;( )
void "
EliminarDetalleReserva #
(# $
DetalleReserva$ 2
	ReservaDb3 <
)< =
;= >
void 
EliminarReserva 
( 
Reserva $
	DbReserva% .
). /
;/ 0
} 
} ¡
zC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Interfaces\IServiceSession.cs
	namespace 	
PROYECTO_INCABATHS
 
. 

Interfaces '
{		 
public

 

	interface

 
IServiceSession

 $
{ 
int "
BuscarIdUsuarioSession "
(" #
)# $
;$ %
string &
BuscarNombreUsuarioSession )
() *
)* +
;+ ,
void '
GuardarDatosUsuarioLogueado (
(( )
Usuario) 0
	UsuarioDB1 :
): ;
;; <
bool 
EstaLogueado 
( 
) 
; 
bool )
EstaLogueadoComoAdministrador *
(* +
)+ ,
;, -
bool "
EstaLogueadoComoCajero #
(# $
)$ %
;% &
bool #
EstaLogueadoComoCliente $
($ %
)% &
;& '
} 
} ¸
{C:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Interfaces\IServicioService.cs
	namespace 	
PROYECTO_INCABATHS
 
{		 
public

 

	interface

 
IServicioService

 %
{ 
List 
< 
Servicio 
> !
ObtenerListaServicios 0
(0 1
)1 2
;2 3
Servicio  
ObtenerServicioPorId )
() *
int* -
?- .
id/ 1
)1 2
;2 3
void 
EditarServicio 
(  
int  #
?# $
id% '
,' (
Servicio) 1
servicio2 :
): ;
;; <
void 
GuardarServicio  
(  !
Servicio! )
servicio* 2
)2 3
;3 4
int #
ContarTurnosDelServicio '
(' (
int( +
?+ ,
id- /
)/ 0
;0 1
List 
< 
Turno 
> 
ListaDeTurnos %
(% &
)& '
;' (
Turno 
ObtenerTurnoPorId #
(# $
int$ '
?' (
id) +
)+ ,
;, -
void %
EliminarTurnosDelServicio *
(* +
int+ .
?. /
id0 2
)2 3
;3 4
void 
EliminarServicio !
(! "
int" %
?% &
id' )
)) *
;* +
} 
} Ø
xC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Interfaces\ITurnoService.cs
	namespace 	
PROYECTO_INCABATHS
 
. 

Interfaces '
{		 
public

 

	interface

 
ITurnoService

 "
{ 
List 
< 
Turno 
> 
ObtenerTurnos !
(! "
)" #
;# $
Servicio  
ObtenerServicioPorId %
(% &
int& )
?) *
id+ -
)- .
;. /
void 
GuardarTurno 
( 
int 
? 
id !
,! "
Turno# (
turno) .
). /
;/ 0
void 
EditarTurno 
( 
Turno 
turno $
,$ %
Turno& +
DbTurno, 3
)3 4
;4 5
Turno 
ObtenerTurnoPorId 
(  
int  #
?# $
id% '
)' (
;( )
void 
EliminarTurno 
( 
Turno  
turno! &
)& '
;' (
bool 
Existe 
( 
int 
? 
id 
, 
Turno "
turno1# )
)) *
;* +
} 
} ï
zC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Interfaces\IUsuarioService.cs
	namespace 	
PROYECTO_INCABATHS
 
. 

Interfaces '
{		 
public

 

	interface

 
IUsuarioService

 $
{ 
List 
< 
Usuario 
>  
ObtenerListaUsuarios *
(* +
)+ ,
;, -
List 
< 
TipoUsuario 
> &
ObtenerListaDeTipoUsuarios 4
(4 5
)5 6
;6 7
void 
CrearUsuario 
( 
Usuario !
usuario" )
)) *
;* +
Usuario 
ObtenerUsuarioPorId #
(# $
int$ '
?' (
id) +
)+ ,
;, -
void 
EditarUsuario 
( 
Usuario "
usuario# *
,* +
Usuario, 3
	UsuarioDb4 =
)= >
;> ?
void 
EliminarUsuario 
( 
int  
?  !
id" $
)$ %
;% &
void "
ActualizarDatosUsuario #
(# $
Usuario$ +
usuario, 3
,3 4
Usuario5 <
	UsuarioDb= F
)F G
;G H
void  
CambiarContraUsuario !
(! "
string" (
NuevaPassword) 6
,6 7
Usuario8 ?
	UsuarioDb@ I
)I J
;J K
int "
BuscarIdUsuarioSession "
(" #
)# $
;$ %
int 
Existe 
( 
Usuario 
usuario "
," #
int$ '
usuarioIdDB( 3
)3 4
;4 5
} 
} ¢
wC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str -
)- .
]. /
[		 
assembly		 	
:			 

AssemblyDescription		 
(		 
$str		 !
)		! "
]		" #
[

 
assembly

 	
:

	 
!
AssemblyConfiguration

  
(

  !
$str

! #
)

# $
]

$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str 
) 
] 
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str /
)/ 0
]0 1
[ 
assembly 	
:	 

AssemblyCopyright 
( 
$str 0
)0 1
]1 2
[ 
assembly 	
:	 

AssemblyTrademark 
( 
$str 
)  
]  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
[ 
assembly 	
:	 

Guid 
( 
$str 6
)6 7
]7 8
["" 
assembly"" 	
:""	 

AssemblyVersion"" 
("" 
$str"" $
)""$ %
]""% &
[## 
assembly## 	
:##	 

AssemblyFileVersion## 
(## 
$str## (
)##( )
]##) *ø
vC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Servicios\AdminService.cs
	namespace		 	
PROYECTO_INCABATHS		
 
.		 
	Servicios		 &
{

 
public 

class 
AdminService 
: 
IAdminService ,
{ 
private 
readonly 
AppConexionDB &
conexion' /
;/ 0
public 
AdminService 
( 
) 
{ 	
this 
. 
conexion 
= 
new 
AppConexionDB  -
(- .
). /
;/ 0
} 	
public 
List 
< 
Usuario 
>  
ObtenerListaUsuarios 1
(1 2
)2 3
{ 	
return 
conexion 
. 
Usuarios $
.$ %
ToList% +
(+ ,
), -
;- .
} 	
public 
List 
< 
Reserva 
> 
ObtenerListReservas 0
(0 1
)1 2
{ 	
return 
conexion 
. 
Reservas $
.$ %
ToList% +
(+ ,
), -
;- .
} 	
public 
List 
< 
TipoUsuario 
>  $
ObtenerListaTipoUsuarios! 9
(9 :
): ;
{ 	
return 
conexion 
. 
TipoUsuarios (
.( )
ToList) /
(/ 0
)0 1
;1 2
} 	
public 
List 
< 
Servicio 
> !
ObtenerListaServicios 3
(3 4
)4 5
{ 	
return   
conexion   
.   
	Servicios   %
.  % &
ToList  & ,
(  , -
)  - .
;  . /
}!! 	
public"" 
List"" 
<"" 
Turno"" 
>"" 
ObtenerListaTurnos"" -
(""- .
)"". /
{## 	
return$$ 
conexion$$ 
.$$ 
Turnos$$ "
.$$" #
ToList$$# )
($$) *
)$$* +
;$$+ ,
}%% 	
public&& 
void&& 
CrearUsuario&&  
(&&  !
Usuario&&! (
usuario&&) 0
)&&0 1
{'' 	
conexion(( 
.(( 
Usuarios(( 
.(( 
Add(( !
(((! "
usuario((" )
)(() *
;((* +
usuario)) 
.)) 
Activo_Inactivo)) #
=))$ %
true))& *
;))* +
conexion** 
.** 
SaveChanges**  
(**  !
)**! "
;**" #
}++ 	
},, 
}-- Æ
uC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Servicios\AuthService.cs
	namespace

 	
PROYECTO_INCABATHS


 
.

 
	Servicios

 &
{ 
public 

class 
AuthService 
: 
IAuthService *
{ 
private 
readonly 
AppConexionDB &
conexion' /
;/ 0
public 
AuthService 
( 
) 
{ 	
this 
. 
conexion 
= 
new 
AppConexionDB  -
(- .
). /
;/ 0
} 	
public 
List 
< 
Usuario 
>  
ObtenerListaUsuarios 1
(1 2
)2 3
{ 	
return 
conexion 
. 
Usuarios $
.$ %
ToList% +
(+ ,
), -
;- .
} 	
public 
void 
GuardarCookie !
(! "
string" (
Correo) /
)/ 0
{ 	
FormsAuthentication 
.  
SetAuthCookie  -
(- .
Correo. 4
,4 5
false6 ;
); <
;< =
} 	
public 
void 
CerrarSession !
(! "
)" #
{ 	
FormsAuthentication 
.  
SignOut  '
(' (
)( )
;) *
HttpContext 
. 
Current 
.  
Session  '
.' (
Clear( -
(- .
). /
;/ 0
}   	
}!! 
}"" ‹(
xC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Servicios\ReservaService.cs
	namespace

 	
PROYECTO_INCABATHS


 
.

 
	Servicios

 &
{ 
public 

class 
ReservaService 
:  
IReservaService  /
{ 
private 
readonly 
AppConexionDB &
conexion' /
;/ 0
public 
ReservaService 
( 
) 
{ 	
this 
. 
conexion 
= 
new 
AppConexionDB  -
(- .
). /
;/ 0
} 	
public 
List 
< 
Reserva 
>  
ObtenerListaReservas 1
(1 2
)2 3
{ 	
return 
conexion 
. 
Reservas $
.$ %
Include% ,
(, -
u- .
=>/ 1
u2 3
.3 4
Usuario4 ;
); <
.< =
ToList= C
(C D
)D E
;E F
} 	
public 
List 
< 
Usuario 
>  
ObtenerListaUsuarios 1
(1 2
)2 3
{ 	
return 
conexion 
. 
Usuarios $
.$ %
ToList% +
(+ ,
), -
;- .
} 	
public 
List 
< 
Servicio 
> !
ObtenerListaServicios 3
(3 4
)4 5
{ 	
return 
conexion 
. 
	Servicios %
.% &
ToList& ,
(, -
)- .
;. /
} 	
public 
void 
CrearReserva  
(  !
int! $
	idUsuario% .
,. /
Reserva/ 6
reserva7 >
)> ?
{   	
reserva!! 
.!! 
	IdUsuario!! 
=!! 
	idUsuario!!  )
;!!) *
reserva"" 
."" 

IdModoPago"" 
=""  
$num""! "
;""" #
reserva## 
.## 
Fecha## 
=## 
DateTime## $
.##$ %
Now##% (
;##( )
reserva$$ 
.$$ 
Activo_Inactivo$$ #
=$$$ %
true$$& *
;$$* +
for%% 
(%% 
int%% 
i%% 
=%% 
$num%% 
;%% 
i%% 
<%% 
reserva%%  '
.%%' (
DetalleReservas%%( 7
.%%7 8
Count%%8 =
;%%= >
i%%? @
++%%@ B
)%%B C
{&& 
reserva'' 
.'' 
DetalleReservas'' '
[''' (
i''( )
]'') *
.''* +
Activo_Inactivo''+ :
=''; <
true''= A
;''A B
}(( 
conexion)) 
.)) 
Reservas)) 
.)) 
Add)) !
())! "
reserva))" )
)))) *
;))* +
conexion** 
.** 
SaveChanges**  
(**  !
)**! "
;**" #
}++ 	
public,, 
List,, 
<,, 
DetalleReserva,, "
>,," #!
ObtenerDetalleReserva,,$ 9
(,,9 :
),,: ;
{-- 	
return.. 
conexion.. 
... 
DetalleReservas.. +
...+ ,
Include.., 3
(..3 4
o..4 5
=>..6 8
o..9 :
...: ;
Servicio..; C
)..C D
...D E
Include..E L
(..L M
t..M N
=>..O Q
t..R S
...S T
Turno..T Y
)..Y Z
...Z [
ToList..[ a
(..a b
)..b c
;..c d
}// 	
public00 
List00 
<00 
Turno00 
>00 
ObtenerListaTurnos00 -
(00- .
)00. /
{11 	
return22 
conexion22 
.22 
Turnos22 #
.22# $
ToList22$ *
(22* +
)22+ ,
;22, -
}33 	
public44 
void44 
EliminarReserva44 #
(44# $
Reserva44$ +
	DbReserva44, 5
)445 6
{55 	
	DbReserva66 
.66 
Activo_Inactivo66 %
=66& '
false66( -
;66- .
conexion77 
.77 
SaveChanges77  
(77  !
)77! "
;77" #
}88 	
public99 
void99 "
EliminarDetalleReserva99 *
(99* +
DetalleReserva99+ 9
	ReservaDb99: C
)99C D
{:: 	
	ReservaDb;; 
.;; 
Activo_Inactivo;; %
=;;& '
false;;( -
;;;- .
conexion<< 
.<< 
SaveChanges<<  
(<<  !
)<<! "
;<<" #
}== 	
}>> 
}?? ”2
xC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Servicios\ServiceSession.cs
	namespace		 	
PROYECTO_INCABATHS		
 
.		 
	Servicios		 &
{

 
public 

class 
ServiceSession 
:  
IServiceSession  /
{ 
private 
readonly 
AppConexionDB &
conexion' /
;/ 0
public 
ServiceSession 
( 
) 
{ 	
this 
. 
conexion 
= 
new 
AppConexionDB  -
(- .
). /
;/ 0
} 	
public 
int "
BuscarIdUsuarioSession )
() *
)* +
{ 	
return 
Convert 
. 
ToInt32 "
(" #
HttpContext# .
.. /
Current/ 6
.6 7
Session7 >
[> ?
$str? J
]J K
)K L
;L M
} 	
public 
string &
BuscarNombreUsuarioSession 0
(0 1
)1 2
{ 	
return 
Convert 
. 
ToString #
(# $
HttpContext$ /
./ 0
Current0 7
.7 8
Session8 ?
[? @
$str@ O
]O P
)P Q
;Q R
} 	
public 
void '
GuardarDatosUsuarioLogueado /
(/ 0
Usuario0 7
	UsuarioDB8 A
)A B
{ 	
HttpContext 
. 
Current 
.  
Session  '
[' (
$str( 3
]3 4
=5 6
	UsuarioDB7 @
.@ A
	IdUsuarioA J
;J K
HttpContext 
. 
Current 
.  
Session  '
[' (
$str( 7
]7 8
=9 :
	UsuarioDB; D
.D E
NombreE K
;K L
HttpContext 
. 
Current 
.  
Session  '
[' (
$str( 7
]7 8
=9 :
	UsuarioDB; D
.D E
PerfilE K
;K L
HttpContext 
. 
Current 
.  
Session  '
[' (
$str( 4
]4 5
=6 7
	UsuarioDB8 A
.A B
DNIB E
;E F
HttpContext   
.   
Current   
.    
Session    '
[  ' (
$str  ( <
]  < =
=  > ?
	UsuarioDB  @ I
.  I J
IdTipoUsuario  J W
;  W X
}!! 	
public"" 
bool"" 
EstaLogueado""  
(""  !
)""! "
{## 	
if$$ 
($$ 
HttpContext$$ 
.$$ 
Current$$ #
.$$# $
Session$$$ +
[$$+ ,
$str$$, ;
]$$; <
!=$$= ?
null$$@ D
)$$D E
return%% 
true%% 
;%% 
return'' 
false'' 
;'' 
}(( 	
public** 
bool** )
EstaLogueadoComoAdministrador** 1
(**1 2
)**2 3
{++ 	
if,, 
(,, 
EstaLogueado,, 
(,, 
),, 
),, 
{-- 
int.. 
	UsuarioId.. 
=.. "
BuscarIdUsuarioSession..  6
(..6 7
)..7 8
;..8 9
Usuario// 
usuario// 
=//  !
conexion//" *
.//* +
Usuarios//+ 3
.//3 4
Where//4 9
(//9 :
a//: ;
=>//; =
a//= >
.//> ?
	IdUsuario//? H
==//H J
	UsuarioId//J S
)//S T
.//T U
First//U Z
(//Z [
)//[ \
;//\ ]
if00 
(00 
usuario00 
.00 
IdTipoUsuario00 )
==00* ,
$num00- .
)00. /
return11 
true11 
;11  
}22 
return44 
false44 
;44 
}55 	
public66 
bool66 "
EstaLogueadoComoCajero66 *
(66* +
)66+ ,
{77 	
if88 
(88 
EstaLogueado88 
(88 
)88 
)88 
{99 
int:: 
	UsuarioId:: 
=:: "
BuscarIdUsuarioSession::  6
(::6 7
)::7 8
;::8 9
Usuario;; 
usuario;; 
=;;  !
conexion;;" *
.;;* +
Usuarios;;+ 3
.;;3 4
Where;;4 9
(;;9 :
a;;: ;
=>;;< >
a;;? @
.;;@ A
	IdUsuario;;A J
==;;K M
	UsuarioId;;N W
);;W X
.;;X Y
First;;Y ^
(;;^ _
);;_ `
;;;` a
if<< 
(<< 
usuario<< 
.<< 
IdTipoUsuario<< )
==<<* ,
$num<<- .
)<<. /
return== 
true== 
;==  
}>> 
return@@ 
false@@ 
;@@ 
}AA 	
publicBB 
boolBB #
EstaLogueadoComoClienteBB +
(BB+ ,
)BB, -
{CC 	
ifDD 
(DD 
EstaLogueadoDD 
(DD 
)DD 
)DD 
{EE 
intFF 
	UsuarioIdFF 
=FF "
BuscarIdUsuarioSessionFF  6
(FF6 7
)FF7 8
;FF8 9
UsuarioGG 
usuarioGG 
=GG  !
conexionGG" *
.GG* +
UsuariosGG+ 3
.GG3 4
WhereGG4 9
(GG9 :
aGG: ;
=>GG< >
aGG? @
.GG@ A
	IdUsuarioGGA J
==GGK M
	UsuarioIdGGN W
)GGW X
.GGX Y
FirstGGY ^
(GG^ _
)GG_ `
;GG` a
ifHH 
(HH 
usuarioHH 
.HH 
IdTipoUsuarioHH )
==HH* ,
$numHH- .
)HH. /
returnII 
trueII 
;II  
}JJ 
returnKK 
falseKK 
;KK 
}LL 	
}MM 
}NN ∫1
yC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Servicios\ServicioService.cs
	namespace 	
PROYECTO_INCABATHS
 
. 
	Servicios &
{		 
public 

class 
ServicioService  
:  !
IServicioService! 1
{ 
private 
readonly 
AppConexionDB &
conexion' /
;/ 0
public 
ServicioService 
( 
)  
{ 	
this 
. 
conexion 
= 
new 
AppConexionDB  -
(- .
). /
;/ 0
} 	
public 
List 
< 
Servicio 
> !
ObtenerListaServicios 3
(3 4
)4 5
{ 	
return 
conexion 
. 
	Servicios %
.% &
ToList& ,
(, -
)- .
;. /
} 	
public 
Servicio  
ObtenerServicioPorId ,
(, -
int- 0
?0 1
id2 4
)4 5
{ 	
return 
conexion 
. 
	Servicios %
.% &
Find& *
(* +
id+ -
)- .
;. /
} 	
public 
void 
EditarServicio "
(" #
int# &
?& '
id( *
,* +
Servicio+ 3
servicio4 <
)< =
{ 	
var 
DBCategoria 
=  
ObtenerServicioPorId 2
(2 3
id3 5
)5 6
;6 7
DBCategoria   
.   
Nombre   
=    
servicio  ! )
.  ) *
Nombre  * 0
;  0 1
DBCategoria!! 
.!! 
Precio!! 
=!!  
servicio!!! )
.!!) *
Precio!!* 0
;!!0 1
DBCategoria"" 
."" 
Aforo"" 
="" 
servicio""  (
.""( )
Aforo"") .
;"". /
conexion## 
.## 
SaveChanges##  
(##  !
)##! "
;##" #
}$$ 	
public&& 
void&& 
GuardarServicio&& #
(&&# $
Servicio&&$ ,
servicio&&- 5
)&&5 6
{'' 	
conexion(( 
.(( 
	Servicios(( 
.(( 
Add(( "
(((" #
servicio((# +
)((+ ,
;((, -
servicio)) 
.)) 
Activo_Inactivo)) $
=))% &
true))' +
;))+ ,
conexion** 
.** 
SaveChanges**  
(**  !
)**! "
;**" #
}++ 	
public-- 
int-- #
ContarTurnosDelServicio-- *
(--* +
int--+ .
?--. /
id--0 2
)--2 3
{.. 	
return// 
conexion// 
.// 
Turnos// "
.//" #
Count//# (
(//( )
o//) *
=>//+ -
o//. /
./// 0

IdServicio//0 :
==//; =
id//> @
&&//A C
o//D E
.//E F
Activo_Inactivo//F U
)//U V
;//V W
}00 	
public22 
List22 
<22 
Turno22 
>22 
ListaDeTurnos22 (
(22( )
)22) *
{33 	
return44 
conexion44 
.44 
Turnos44 "
.44" #
ToList44# )
(44) *
)44* +
;44+ ,
}55 	
public66 
Turno66 
ObtenerTurnoPorId66 &
(66& '
int66' *
?66* +
id66, .
)66. /
{77 	
return88 
conexion88 
.88 
Turnos88 "
.88" #
Where88# (
(88( )
o88) *
=>88+ -
o88. /
.88/ 0
IdTurno880 7
==888 :
id88; =
)88= >
.88> ?
First88? D
(88D E
)88E F
;88F G
}99 	
public:: 
void:: %
EliminarTurnosDelServicio:: -
(::- .
int::. 1
?::1 2
id::3 5
)::5 6
{;; 	
var<< 
turnoDb1<< 
=<< 
ListaDeTurnos<< (
(<<( )
)<<) *
.<<* +
Where<<+ 0
(<<0 1
o<<1 2
=><<3 5
o<<6 7
.<<7 8

IdServicio<<8 B
==<<C E
id<<F H
&&<<I K
o<<L M
.<<M N
Activo_Inactivo<<N ]
)<<] ^
.<<^ _
ToList<<_ e
(<<e f
)<<f g
;<<g h
for>> 
(>> 
int>> 
i>> 
=>> 
$num>> 
;>> 
i>> 
<>> 
turnoDb1>>  (
.>>( )
Count>>) .
;>>. /
i>>0 1
++>>1 3
)>>3 4
{?? 
var@@ 
idturno@@ 
=@@ 
turnoDb1@@ &
[@@& '
i@@' (
]@@( )
.@@) *
IdTurno@@* 1
;@@1 2
varAA 
turnoDbAA 
=AA 
ObtenerTurnoPorIdAA /
(AA/ 0
idturnoAA0 7
)AA7 8
;AA8 9
turnoDbBB 
.BB 
Activo_InactivoBB '
=BB( )
falseBB* /
;BB/ 0
conexionCC 
.CC 
SaveChangesCC $
(CC$ %
)CC% &
;CC& '
}DD 
}EE 	
publicFF 
voidFF 
EliminarServicioFF $
(FF$ %
intFF% (
?FF( )
idFF* ,
)FF, -
{GG 	
varHH 

servicioDbHH 
=HH  
ObtenerServicioPorIdHH 1
(HH1 2
idHH2 4
)HH4 5
;HH5 6

servicioDbII 
.II 
Activo_InactivoII &
=II' (
falseII) .
;II. /
conexionJJ 
.JJ 
SaveChangesJJ  
(JJ  !
)JJ! "
;JJ" #
}KK 	
}LL 
}MM ‘+
vC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Servicios\TurnoService.cs
	namespace

 	
PROYECTO_INCABATHS


 
.

 
	Servicios

 &
{ 
public 

class 
TurnoService 
: 
ITurnoService ,
{ 
private 
readonly 
AppConexionDB &
conexion' /
;/ 0
public 
TurnoService 
( 
) 
{ 	
this 
. 
conexion 
= 
new 
AppConexionDB  -
(- .
). /
;/ 0
} 	
public 
List 
< 
Turno 
> 
ObtenerTurnos (
(( )
)) *
{ 	
return 
conexion 
. 
Turnos "
." #
Include# *
(* +
t+ ,
=>- /
t0 1
.1 2
Servicio2 :
): ;
.; <
ToList< B
(B C
)C D
;D E
} 	
public 
Servicio  
ObtenerServicioPorId ,
(, -
int- 0
?0 1
id2 4
)4 5
{ 	
if 
( 
id 
== 
null 
) 
return "
null# '
;' (
Servicio 
servicio 
= 
conexion  (
.( )
	Servicios) 2
.2 3
Where3 8
(8 9
a9 :
=>: <
a< =
.= >

IdServicio> H
==H J
idJ L
)L M
.M N
FirstOrDefaultN \
(\ ]
)] ^
;^ _
return 
servicio 
; 
} 	
public 
void 
GuardarTurno  
(  !
int! $
?$ %
id& (
,( )
Turno) .
turno/ 4
)4 5
{ 	
turno   
.   

IdServicio   
=   
Convert   &
.  & '
ToInt32  ' .
(  . /
id  / 1
)  1 2
;  2 3
conexion"" 
."" 
Turnos"" 
."" 
Add"" 
(""  
turno""  %
)""% &
;""& '
turno## 
.## 
Activo_Inactivo## !
=##" #
true##$ (
;##( )
conexion$$ 
.$$ 
SaveChanges$$  
($$  !
)$$! "
;$$" #
}%% 	
public&& 
void&& 
EditarTurno&& 
(&&  
Turno&&  %
turno&&& +
,&&+ ,
Turno&&, 1
DbTurno&&2 9
)&&9 :
{'' 	
DbTurno(( 
.(( 

HoraInicio(( 
=((  
turno((! &
.((& '

HoraInicio((' 1
;((1 2
DbTurno)) 
.)) 
HoraFin)) 
=)) 
turno)) #
.))# $
HoraFin))$ +
;))+ ,
DbTurno** 
.** 
Fecha** 
=** 
turno** !
.**! "
Fecha**" '
;**' (
conexion++ 
.++ 
SaveChanges++  
(++  !
)++! "
;++" #
},, 	
public-- 
Turno-- 
ObtenerTurnoPorId-- &
(--& '
int--' *
?--* +
id--, .
)--. /
{.. 	
if// 
(// 
id// 
==// 
null// 
)// 
return// "
null//# '
;//' (
return00 
conexion00 
.00 
Turnos00 "
.00" #
Find00# '
(00' (
id00( *
)00* +
;00+ ,
}11 	
public22 
void22 
EliminarTurno22 !
(22! "
Turno22" '
turno22( -
)22- .
{33 	
turno44 
.44 
Activo_Inactivo44 !
=44" #
false44$ )
;44) *
conexion55 
.55 
SaveChanges55  
(55  !
)55! "
;55" #
}66 	
public77 
bool77 
Existe77 
(77 
int77 
?77 
id77  "
,77" #
Turno77$ )
turno177* 0
)770 1
{88 	
var99 
Exist99 
=99 
conexion99  
.99  !
Turnos99! '
.99' (
Any99( +
(99+ ,
a99, -
=>99. 0
a991 2
.992 3

IdServicio993 =
==99> @
id99A C
&&99D F
a99G H
.99H I

HoraInicio99I S
==99T V
turno199W ]
.99] ^

HoraInicio99^ h
&&99i k
a99l m
.99m n
HoraFin99n u
==99v x
turno199y 
.	99 Ä
HoraFin
99Ä á
&&
99à ä
a
99ã å
.
99å ç
Fecha
99ç í
==
99ì ï
turno1
99ñ ú
.
99ú ù
Fecha
99ù ¢
)
99¢ £
;
99£ §
if:: 
(:: 
Exist:: 
):: 
{;; 
return<< 
true<< 
;<< 
}== 
return>> 
false>> 
;>> 
}?? 	
}@@ 
}AA ≈6
xC:\Users\JOSE LUIS\Documents\Visual Studio 2017\Projects\IncaBaths-master\PROYECTO_INCABATHS\Servicios\UsuarioService.cs
	namespace 	
PROYECTO_INCABATHS
 
. 
	Servicios &
{ 
public 

class 
UsuarioService 
:  
IUsuarioService! 0
{ 
private 
readonly 
AppConexionDB &
conexion' /
;/ 0
public 
UsuarioService 
( 
) 
{ 	
this 
. 
conexion 
= 
new 
AppConexionDB  -
(- .
). /
;/ 0
} 	
public 
List 
< 
Usuario 
>  
ObtenerListaUsuarios 1
(1 2
)2 3
{ 	
return 
conexion 
. 
Usuarios $
.$ %
Include% ,
(, -
u- .
=>/ 1
u2 3
.3 4
TipoUsuario4 ?
)? @
.@ A
ToListA G
(G H
)H I
;I J
} 	
public 
List 
< 
TipoUsuario 
>  &
ObtenerListaDeTipoUsuarios! ;
(; <
)< =
{ 	
return 
conexion 
. 
TipoUsuarios (
.( )
ToList) /
(/ 0
)0 1
;1 2
} 	
public 
void 
CrearUsuario  
(  !
Usuario! (
usuario) 0
)0 1
{ 	
conexion 
. 
Usuarios 
. 
Add !
(! "
usuario" )
)) *
;* +
usuario 
. 
Activo_Inactivo #
=$ %
true& *
;* +
conexion   
.   
SaveChanges    
(    !
)  ! "
;  " #
}!! 	
public"" 
Usuario"" 
ObtenerUsuarioPorId"" *
(""* +
int""+ .
?"". /
id""0 2
)""2 3
{## 	
return$$ 
conexion$$ 
.$$ 
Usuarios$$ $
.$$$ %
Find$$% )
($$) *
id$$* ,
)$$, -
;$$- .
}%% 	
public&& 
void&& 
EditarUsuario&& !
(&&! "
Usuario&&" )
usuario&&* 1
,&&1 2
Usuario&&3 :
	UsuarioDb&&; D
)&&D E
{'' 	
	UsuarioDb(( 
.(( 
Nombre(( 
=(( 
usuario(( &
.((& '
Nombre((' -
;((- .
	UsuarioDb)) 
.)) 
IdTipoUsuario)) #
=))$ %
usuario))& -
.))- .
IdTipoUsuario)). ;
;)); <
	UsuarioDb** 
.** 
Password** 
=**  
usuario**! (
.**( )
Password**) 1
;**1 2
	UsuarioDb++ 
.++ 
Celular++ 
=++ 
usuario++  '
.++' (
Celular++( /
;++/ 0
	UsuarioDb,, 
.,, 
Correo,, 
=,, 
usuario,, &
.,,& '
Correo,,' -
;,,- .
	UsuarioDb-- 
.-- 
DNI-- 
=-- 
usuario-- #
.--# $
DNI--$ '
;--' (
	UsuarioDb.. 
... 
	Direccion.. 
=..  !
usuario.." )
...) *
	Direccion..* 3
;..3 4
conexion// 
.// 
SaveChanges//  
(//  !
)//! "
;//" #
}00 	
public11 
void11 
EliminarUsuario11 #
(11# $
int11$ '
?11' (
id11) +
)11+ ,
{22 	
var33 
	UsuarioDb33 
=33 
ObtenerUsuarioPorId33 /
(33/ 0
id330 2
)332 3
;333 4
	UsuarioDb44 
.44 
Activo_Inactivo44 %
=44& '
false44( -
;44- .
conexion55 
.55 
SaveChanges55  
(55  !
)55! "
;55" #
}66 	
public77 
void77 "
ActualizarDatosUsuario77 *
(77* +
Usuario77+ 2
usuario773 :
,77: ;
Usuario77< C
	UsuarioDb77D M
)77M N
{88 	
	UsuarioDb99 
.99 
Nombre99 
=99 
usuario99 &
.99& '
Nombre99' -
;99- .
	UsuarioDb:: 
.:: 
Apellido:: 
=::  
usuario::! (
.::( )
Apellido::) 1
;::1 2
	UsuarioDb;; 
.;; 
DNI;; 
=;; 
usuario;; #
.;;# $
DNI;;$ '
;;;' (
	UsuarioDb<< 
.<< 
	Direccion<< 
=<<  !
usuario<<" )
.<<) *
	Direccion<<* 3
;<<3 4
	UsuarioDb== 
.== 
Celular== 
=== 
usuario==  '
.==' (
Celular==( /
;==/ 0
conexion>> 
.>> 
SaveChanges>>  
(>>  !
)>>! "
;>>" #
}?? 	
public@@ 
void@@  
CambiarContraUsuario@@ (
(@@( )
string@@) /
NuevaPassword@@0 =
,@@= >
Usuario@@> E
	UsuarioDb@@F O
)@@O P
{AA 	
	UsuarioDbBB 
.BB 
PasswordBB 
=BB  
NuevaPasswordBB! .
;BB. /
conexionCC 
.CC 
SaveChangesCC  
(CC  !
)CC! "
;CC" #
}DD 	
publicEE 
intEE "
BuscarIdUsuarioSessionEE )
(EE) *
)EE* +
{FF 	
returnGG 
ConvertGG 
.GG 
ToInt32GG "
(GG" #
HttpContextGG# .
.GG. /
CurrentGG/ 6
.GG6 7
SessionGG7 >
[GG> ?
$strGG? J
]GGJ K
)GGK L
;GGL M
}HH 	
publicII 
intII 
ExisteII 
(II 
UsuarioII !
usuarioII" )
,II) *
intII* -
usuarioIdDBII. 9
)II9 :
{JJ 	
returnKK 
conexionKK 
.KK 
UsuariosKK $
.KK$ %
CountKK% *
(KK* +
uKK+ ,
=>KK- /
uKK0 1
.KK1 2
	IdUsuarioKK2 ;
==KK< >
usuarioIdDBKK? J
&&KKK M
uKKN O
.KKO P
PasswordKKP X
==KKY [
usuarioKK\ c
.KKc d
PasswordKKd l
)KKl m
;KKm n
}LL 	
}MM 
}NN 